<?xml version="1.0" encoding="utf-8"?><testsuites><testsuite name="pytest" errors="0" failures="45" skipped="5" tests="423" time="33.505" timestamp="2026-02-13T00:44:58.249252" hostname="70459d8e9db8"><testcase classname="tests.e2e.test_complete_interview_flow.TestCompleteInterviewFlow" name="test_complete_interview_session_flow" time="0.226"><failure message="app.exceptions.AIServiceError: Failed to create interview session: (psycopg2.errors.ForeignKeyViolation) insert or update on table &quot;interview_sessions&quot; violates foreign key constraint &quot;interview_sessions_user_id_fkey&quot;&#10;DETAIL:  Key (user_id)=(d9ddb46f-9ce6-4754-9249-4d7dab9c922c) is not present in table &quot;users&quot;.&#10;&#10;[SQL: INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, status, total_questions, completed_questions, created_at, updated_at) VALUES (%(id)s::UUID, %(user_id)s::UUID, %(mode)s, %(role)s, %(job_description)s, %(scenario_id)s, %(question_source)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)]&#10;[parameters: {'id': UUID('45df3088-4d96-4cc9-a452-bf0455516c98'), 'user_id': UUID('d9ddb46f-9ce6-4754-9249-4d7dab9c922c'), 'mode': 'interview', 'role': 'Senior Python Developer', 'job_description': 'We are looking for a Senior Python Developer with 5+ years of experience in Django, Flask, and API development. The ideal candidate should have strong debugging skills and experience with database optimization.', 'scenario_id': None, 'question_source': 'generated', 'job_context': '{&quot;title&quot;: &quot;Senior Python Developer&quot;}', 'status': 'active', 'total_questions': 0, 'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 44, 58, 983088), 'updated_at': datetime.datetime(2026, 2, 13, 0, 44, 58, 983089)}]&#10;(Background on this error at: https://sqlalche.me/e/20/gkpj)">self = &lt;sqlalchemy.engine.base.Connection object at 0xffff721ff110&gt;, dialect = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0xffff734ab9d0&gt;
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0xffff721fdd50&gt;, statement = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0xffff71fe8d10&gt;
parameters = [{'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 44, 58, 983088), 'id': UUID('45df3088-4d96-4cc9-a452-bf0455516c98'), 'job_context': '{"title": "Senior Python Developer"}', ...}]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -&gt; CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
&gt;                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0xffff734ab9d0&gt;, cursor = &lt;cursor object at 0xffff72123970; closed: -1&gt;
statement = 'INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, ...e)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)'
parameters = {'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 44, 58, 983088), 'id': UUID('45df3088-4d96-4cc9-a452-bf0455516c98'), 'job_context': '{"title": "Senior Python Developer"}', ...}
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0xffff721fdd50&gt;

    def do_execute(self, cursor, statement, parameters, context=None):
&gt;       cursor.execute(statement, parameters)
E       psycopg2.errors.ForeignKeyViolation: insert or update on table "interview_sessions" violates foreign key constraint "interview_sessions_user_id_fkey"
E       DETAIL:  Key (user_id)=(d9ddb46f-9ce6-4754-9249-4d7dab9c922c) is not present in table "users".

/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py:952: ForeignKeyViolation

The above exception was the direct cause of the following exception:

self = &lt;app.services.session_service.SessionService object at 0xffff729e7090&gt;, user_id = UUID('d9ddb46f-9ce6-4754-9249-4d7dab9c922c'), role = 'Senior Python Developer'
job_description = 'We are looking for a Senior Python Developer with 5+ years of experience in Django, Flask, and API development. The ideal candidate should have strong debugging skills and experience with database optimization.'
title = 'Senior Python Developer', mode = 'interview'

    async def create_session(
        self,
        user_id: Union[int, str],
        role: str,
        job_description: str,
        title: Optional[str] = None,
        mode: str = "interview"
    ) -&gt; InterviewSession:
        """Create a new interview session (works for both sync and async)."""
        try:
            session_data = {
                "id": uuid.uuid4(),
                "user_id": user_id,
                "role": role,
                "job_description": job_description or "",
                "mode": mode,
                "question_source": "generated",
                "status": "active",
                "created_at": datetime.utcnow(),
                "updated_at": datetime.utcnow()
            }
            if title:
                session_data["job_context"] = {"title": title}
    
            session = InterviewSession(**session_data)
            self.db_session.add(session)
            if self.is_async:
                await self.db_session.commit()
                await self.db_session.refresh(session)
            else:
&gt;               self.db_session.commit()

app/services/session_service.py:62: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py:1048: in _emit_insert_statements
    result = connection.execute(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0xffff734ab9d0&gt;, cursor = &lt;cursor object at 0xffff72123970; closed: -1&gt;
statement = 'INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, ...e)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)'
parameters = {'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 44, 58, 983088), 'id': UUID('45df3088-4d96-4cc9-a452-bf0455516c98'), 'job_context': '{"title": "Senior Python Developer"}', ...}
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0xffff721fdd50&gt;

    def do_execute(self, cursor, statement, parameters, context=None):
&gt;       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (psycopg2.errors.ForeignKeyViolation) insert or update on table "interview_sessions" violates foreign key constraint "interview_sessions_user_id_fkey"
E       DETAIL:  Key (user_id)=(d9ddb46f-9ce6-4754-9249-4d7dab9c922c) is not present in table "users".
E       
E       [SQL: INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, status, total_questions, completed_questions, created_at, updated_at) VALUES (%(id)s::UUID, %(user_id)s::UUID, %(mode)s, %(role)s, %(job_description)s, %(scenario_id)s, %(question_source)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)]
E       [parameters: {'id': UUID('45df3088-4d96-4cc9-a452-bf0455516c98'), 'user_id': UUID('d9ddb46f-9ce6-4754-9249-4d7dab9c922c'), 'mode': 'interview', 'role': 'Senior Python Developer', 'job_description': 'We are looking for a Senior Python Developer with 5+ years of experience in Django, Flask, and API development. The ideal candidate should have strong debugging skills and experience with database optimization.', 'scenario_id': None, 'question_source': 'generated', 'job_context': '{"title": "Senior Python Developer"}', 'status': 'active', 'total_questions': 0, 'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 44, 58, 983088), 'updated_at': datetime.datetime(2026, 2, 13, 0, 44, 58, 983089)}]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

self = &lt;tests.e2e.test_complete_interview_flow.TestCompleteInterviewFlow object at 0xffff73507190&gt;, client = &lt;starlette.testclient.TestClient object at 0xffff723e4410&gt;
sample_user = &lt;User(id=d9ddb46f-9ce6-4754-9249-4d7dab9c922c, email=test-06049737@example.com, name=Test User)&gt;, mock_ai_client = &lt;AsyncMock id='281472600424848'&gt;
override_auth = &lt;function override_auth.&lt;locals&gt;._override at 0xffff721d5bc0&gt;, override_ai_client = &lt;function override_ai_client.&lt;locals&gt;._override at 0xffff721d62a0&gt;

    @pytest.mark.e2e
    def test_complete_interview_session_flow(self, client, sample_user, mock_ai_client, override_auth, override_ai_client):
        """Test complete interview session flow from creation to completion."""
        override_auth({"id": sample_user.id, "email": sample_user.email, "is_admin": False})
        override_ai_client(mock_ai_client)
    
        # Step 1: Create interview session
        session_data = {
            "user_id": str(sample_user.id),
            "mode": "interview",
            "role": "Senior Python Developer",
            "job_title": "Senior Python Developer",
            "job_description": "We are looking for a Senior Python Developer with 5+ years of experience in Django, Flask, and API development. The ideal candidate should have strong debugging skills and experience with database optimization."
        }
    
        # Create session
&gt;       create_response = client.post("/api/v1/sessions/", json=session_data)

tests/e2e/test_complete_interview_flow.py:30: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:546: in post
    return super().post(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:1132: in post
    return self.request(
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:445: in request
    return super().request(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:814: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
/usr/local/lib/python3.11/site-packages/httpx/_client.py:901: in send
    response = self._send_handling_auth(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:929: in _send_handling_auth
    response = self._send_handling_redirects(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:966: in _send_handling_redirects
    response = self._send_single_request(request)
/usr/local/lib/python3.11/site-packages/httpx/_client.py:1002: in _send_single_request
    response = transport.handle_request(request)
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:348: in handle_request
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:345: in handle_request
    portal.call(self.app, scope, receive, send)
/usr/local/lib/python3.11/site-packages/anyio/from_thread.py:334: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
/usr/local/lib/python3.11/concurrent/futures/_base.py:456: in result
    return self.__get_result()
/usr/local/lib/python3.11/concurrent/futures/_base.py:401: in __get_result
    raise self._exception
/usr/local/lib/python3.11/site-packages/anyio/from_thread.py:259: in _call_func
    retval = await retval_or_awaitable
/usr/local/lib/python3.11/site-packages/fastapi/applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/applications.py:107: in __call__
    await self.middleware_stack(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/rate_limiting_middleware.py:51: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
app/middleware/rate_limiting_middleware.py:40: in dispatch
    response = await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/main.py:179: in logging_middleware
    return await log_requests(request, call_next)
app/middleware/logging_middleware.py:29: in log_requests
    response = await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/security_middleware.py:23: in dispatch
    response = await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/file_upload_middleware.py:222: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/file_upload_middleware.py:139: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/file_upload_middleware.py:30: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py:87: in __call__
    await self.app(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:119: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:105: in app
    response = await f(request)
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:424: in app
    raw_response = await run_endpoint_function(
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:312: in run_endpoint_function
    return await dependant.call(**values)
app/routers/sessions.py:40: in create_session
    session = await session_service.create_interview_session(
app/services/session_service.py:136: in create_interview_session
    return await self.create_session(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;app.services.session_service.SessionService object at 0xffff729e7090&gt;, user_id = UUID('d9ddb46f-9ce6-4754-9249-4d7dab9c922c'), role = 'Senior Python Developer'
job_description = 'We are looking for a Senior Python Developer with 5+ years of experience in Django, Flask, and API development. The ideal candidate should have strong debugging skills and experience with database optimization.'
title = 'Senior Python Developer', mode = 'interview'

    async def create_session(
        self,
        user_id: Union[int, str],
        role: str,
        job_description: str,
        title: Optional[str] = None,
        mode: str = "interview"
    ) -&gt; InterviewSession:
        """Create a new interview session (works for both sync and async)."""
        try:
            session_data = {
                "id": uuid.uuid4(),
                "user_id": user_id,
                "role": role,
                "job_description": job_description or "",
                "mode": mode,
                "question_source": "generated",
                "status": "active",
                "created_at": datetime.utcnow(),
                "updated_at": datetime.utcnow()
            }
            if title:
                session_data["job_context"] = {"title": title}
    
            session = InterviewSession(**session_data)
            self.db_session.add(session)
            if self.is_async:
                await self.db_session.commit()
                await self.db_session.refresh(session)
            else:
                self.db_session.commit()
                self.db_session.refresh(session)
    
            logger.info(f"Created interview session {session.id} for user {user_id}")
            return session
    
        except Exception as e:
            if self.is_async:
                await self.db_session.rollback()
            else:
                self.db_session.rollback()
            logger.error(f"Error creating session: {e}")
&gt;           raise AIServiceError(f"Failed to create interview session: {e}")
E           app.exceptions.AIServiceError: Failed to create interview session: (psycopg2.errors.ForeignKeyViolation) insert or update on table "interview_sessions" violates foreign key constraint "interview_sessions_user_id_fkey"
E           DETAIL:  Key (user_id)=(d9ddb46f-9ce6-4754-9249-4d7dab9c922c) is not present in table "users".
E           
E           [SQL: INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, status, total_questions, completed_questions, created_at, updated_at) VALUES (%(id)s::UUID, %(user_id)s::UUID, %(mode)s, %(role)s, %(job_description)s, %(scenario_id)s, %(question_source)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)]
E           [parameters: {'id': UUID('45df3088-4d96-4cc9-a452-bf0455516c98'), 'user_id': UUID('d9ddb46f-9ce6-4754-9249-4d7dab9c922c'), 'mode': 'interview', 'role': 'Senior Python Developer', 'job_description': 'We are looking for a Senior Python Developer with 5+ years of experience in Django, Flask, and API development. The ideal candidate should have strong debugging skills and experience with database optimization.', 'scenario_id': None, 'question_source': 'generated', 'job_context': '{"title": "Senior Python Developer"}', 'status': 'active', 'total_questions': 0, 'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 44, 58, 983088), 'updated_at': datetime.datetime(2026, 2, 13, 0, 44, 58, 983089)}]
E           (Background on this error at: https://sqlalche.me/e/20/gkpj)

app/services/session_service.py:74: AIServiceError</failure></testcase><testcase classname="tests.e2e.test_complete_interview_flow.TestCompleteInterviewFlow" name="test_multiple_sessions_per_user" time="0.174"><failure message="app.exceptions.AIServiceError: Failed to create interview session: (psycopg2.errors.ForeignKeyViolation) insert or update on table &quot;interview_sessions&quot; violates foreign key constraint &quot;interview_sessions_user_id_fkey&quot;&#10;DETAIL:  Key (user_id)=(16d20f86-8dd0-47f8-8855-57c75faa2066) is not present in table &quot;users&quot;.&#10;&#10;[SQL: INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, status, total_questions, completed_questions, created_at, updated_at) VALUES (%(id)s::UUID, %(user_id)s::UUID, %(mode)s, %(role)s, %(job_description)s, %(scenario_id)s, %(question_source)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)]&#10;[parameters: {'id': UUID('2986106c-d1d0-438f-b090-3330364c76b2'), 'user_id': UUID('16d20f86-8dd0-47f8-8855-57c75faa2066'), 'mode': 'interview', 'role': 'Python Developer', 'job_description': 'Looking for Python developer with Django experience', 'scenario_id': None, 'question_source': 'generated', 'job_context': '{&quot;title&quot;: &quot;Python Developer&quot;}', 'status': 'active', 'total_questions': 0, 'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 0, 111954), 'updated_at': datetime.datetime(2026, 2, 13, 0, 45, 0, 111955)}]&#10;(Background on this error at: https://sqlalche.me/e/20/gkpj)">self = &lt;sqlalchemy.engine.base.Connection object at 0xffff70278490&gt;, dialect = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0xffff734ab9d0&gt;
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0xffff70278210&gt;, statement = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0xffff71fe8d10&gt;
parameters = [{'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 0, 111954), 'id': UUID('2986106c-d1d0-438f-b090-3330364c76b2'), 'job_context': '{"title": "Python Developer"}', ...}]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -&gt; CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
&gt;                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0xffff734ab9d0&gt;, cursor = &lt;cursor object at 0xffff71f5a3e0; closed: -1&gt;
statement = 'INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, ...e)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)'
parameters = {'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 0, 111954), 'id': UUID('2986106c-d1d0-438f-b090-3330364c76b2'), 'job_context': '{"title": "Python Developer"}', ...}
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0xffff70278210&gt;

    def do_execute(self, cursor, statement, parameters, context=None):
&gt;       cursor.execute(statement, parameters)
E       psycopg2.errors.ForeignKeyViolation: insert or update on table "interview_sessions" violates foreign key constraint "interview_sessions_user_id_fkey"
E       DETAIL:  Key (user_id)=(16d20f86-8dd0-47f8-8855-57c75faa2066) is not present in table "users".

/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py:952: ForeignKeyViolation

The above exception was the direct cause of the following exception:

self = &lt;app.services.session_service.SessionService object at 0xffff70240b90&gt;, user_id = UUID('16d20f86-8dd0-47f8-8855-57c75faa2066'), role = 'Python Developer'
job_description = 'Looking for Python developer with Django experience', title = 'Python Developer', mode = 'interview'

    async def create_session(
        self,
        user_id: Union[int, str],
        role: str,
        job_description: str,
        title: Optional[str] = None,
        mode: str = "interview"
    ) -&gt; InterviewSession:
        """Create a new interview session (works for both sync and async)."""
        try:
            session_data = {
                "id": uuid.uuid4(),
                "user_id": user_id,
                "role": role,
                "job_description": job_description or "",
                "mode": mode,
                "question_source": "generated",
                "status": "active",
                "created_at": datetime.utcnow(),
                "updated_at": datetime.utcnow()
            }
            if title:
                session_data["job_context"] = {"title": title}
    
            session = InterviewSession(**session_data)
            self.db_session.add(session)
            if self.is_async:
                await self.db_session.commit()
                await self.db_session.refresh(session)
            else:
&gt;               self.db_session.commit()

app/services/session_service.py:62: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py:1048: in _emit_insert_statements
    result = connection.execute(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0xffff734ab9d0&gt;, cursor = &lt;cursor object at 0xffff71f5a3e0; closed: -1&gt;
statement = 'INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, ...e)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)'
parameters = {'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 0, 111954), 'id': UUID('2986106c-d1d0-438f-b090-3330364c76b2'), 'job_context': '{"title": "Python Developer"}', ...}
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0xffff70278210&gt;

    def do_execute(self, cursor, statement, parameters, context=None):
&gt;       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (psycopg2.errors.ForeignKeyViolation) insert or update on table "interview_sessions" violates foreign key constraint "interview_sessions_user_id_fkey"
E       DETAIL:  Key (user_id)=(16d20f86-8dd0-47f8-8855-57c75faa2066) is not present in table "users".
E       
E       [SQL: INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, status, total_questions, completed_questions, created_at, updated_at) VALUES (%(id)s::UUID, %(user_id)s::UUID, %(mode)s, %(role)s, %(job_description)s, %(scenario_id)s, %(question_source)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)]
E       [parameters: {'id': UUID('2986106c-d1d0-438f-b090-3330364c76b2'), 'user_id': UUID('16d20f86-8dd0-47f8-8855-57c75faa2066'), 'mode': 'interview', 'role': 'Python Developer', 'job_description': 'Looking for Python developer with Django experience', 'scenario_id': None, 'question_source': 'generated', 'job_context': '{"title": "Python Developer"}', 'status': 'active', 'total_questions': 0, 'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 0, 111954), 'updated_at': datetime.datetime(2026, 2, 13, 0, 45, 0, 111955)}]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

self = &lt;tests.e2e.test_complete_interview_flow.TestCompleteInterviewFlow object at 0xffff72753910&gt;, client = &lt;starlette.testclient.TestClient object at 0xffff723e4410&gt;
sample_user = &lt;User(id=16d20f86-8dd0-47f8-8855-57c75faa2066, email=test-106ae43e@example.com, name=Test User)&gt;, mock_ai_client = &lt;AsyncMock id='281472487108368'&gt;
override_auth = &lt;function override_auth.&lt;locals&gt;._override at 0xffff70275940&gt;, override_ai_client = &lt;function override_ai_client.&lt;locals&gt;._override at 0xffff70275120&gt;

    @pytest.mark.e2e
    def test_multiple_sessions_per_user(self, client, sample_user, mock_ai_client, override_auth, override_ai_client):
        """Test creating and managing multiple sessions for a single user."""
        override_auth({"id": sample_user.id, "email": sample_user.email, "is_admin": False})
        override_ai_client(mock_ai_client)
    
        # Create first session
        session1_data = {
            "user_id": str(sample_user.id),
            "mode": "interview",
            "role": "Python Developer",
            "job_title": "Python Developer",
            "job_description": "Looking for Python developer with Django experience"
        }
    
        # Create first session
&gt;       response1 = client.post("/api/v1/sessions/", json=session1_data)

tests/e2e/test_complete_interview_flow.py:100: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:546: in post
    return super().post(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:1132: in post
    return self.request(
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:445: in request
    return super().request(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:814: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
/usr/local/lib/python3.11/site-packages/httpx/_client.py:901: in send
    response = self._send_handling_auth(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:929: in _send_handling_auth
    response = self._send_handling_redirects(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:966: in _send_handling_redirects
    response = self._send_single_request(request)
/usr/local/lib/python3.11/site-packages/httpx/_client.py:1002: in _send_single_request
    response = transport.handle_request(request)
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:348: in handle_request
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:345: in handle_request
    portal.call(self.app, scope, receive, send)
/usr/local/lib/python3.11/site-packages/anyio/from_thread.py:334: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
/usr/local/lib/python3.11/concurrent/futures/_base.py:456: in result
    return self.__get_result()
/usr/local/lib/python3.11/concurrent/futures/_base.py:401: in __get_result
    raise self._exception
/usr/local/lib/python3.11/site-packages/anyio/from_thread.py:259: in _call_func
    retval = await retval_or_awaitable
/usr/local/lib/python3.11/site-packages/fastapi/applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/applications.py:107: in __call__
    await self.middleware_stack(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/rate_limiting_middleware.py:51: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
app/middleware/rate_limiting_middleware.py:40: in dispatch
    response = await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/main.py:179: in logging_middleware
    return await log_requests(request, call_next)
app/middleware/logging_middleware.py:29: in log_requests
    response = await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/security_middleware.py:23: in dispatch
    response = await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/file_upload_middleware.py:222: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/file_upload_middleware.py:139: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/file_upload_middleware.py:30: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py:87: in __call__
    await self.app(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:119: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:105: in app
    response = await f(request)
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:424: in app
    raw_response = await run_endpoint_function(
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:312: in run_endpoint_function
    return await dependant.call(**values)
app/routers/sessions.py:40: in create_session
    session = await session_service.create_interview_session(
app/services/session_service.py:136: in create_interview_session
    return await self.create_session(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;app.services.session_service.SessionService object at 0xffff70240b90&gt;, user_id = UUID('16d20f86-8dd0-47f8-8855-57c75faa2066'), role = 'Python Developer'
job_description = 'Looking for Python developer with Django experience', title = 'Python Developer', mode = 'interview'

    async def create_session(
        self,
        user_id: Union[int, str],
        role: str,
        job_description: str,
        title: Optional[str] = None,
        mode: str = "interview"
    ) -&gt; InterviewSession:
        """Create a new interview session (works for both sync and async)."""
        try:
            session_data = {
                "id": uuid.uuid4(),
                "user_id": user_id,
                "role": role,
                "job_description": job_description or "",
                "mode": mode,
                "question_source": "generated",
                "status": "active",
                "created_at": datetime.utcnow(),
                "updated_at": datetime.utcnow()
            }
            if title:
                session_data["job_context"] = {"title": title}
    
            session = InterviewSession(**session_data)
            self.db_session.add(session)
            if self.is_async:
                await self.db_session.commit()
                await self.db_session.refresh(session)
            else:
                self.db_session.commit()
                self.db_session.refresh(session)
    
            logger.info(f"Created interview session {session.id} for user {user_id}")
            return session
    
        except Exception as e:
            if self.is_async:
                await self.db_session.rollback()
            else:
                self.db_session.rollback()
            logger.error(f"Error creating session: {e}")
&gt;           raise AIServiceError(f"Failed to create interview session: {e}")
E           app.exceptions.AIServiceError: Failed to create interview session: (psycopg2.errors.ForeignKeyViolation) insert or update on table "interview_sessions" violates foreign key constraint "interview_sessions_user_id_fkey"
E           DETAIL:  Key (user_id)=(16d20f86-8dd0-47f8-8855-57c75faa2066) is not present in table "users".
E           
E           [SQL: INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, status, total_questions, completed_questions, created_at, updated_at) VALUES (%(id)s::UUID, %(user_id)s::UUID, %(mode)s, %(role)s, %(job_description)s, %(scenario_id)s, %(question_source)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)]
E           [parameters: {'id': UUID('2986106c-d1d0-438f-b090-3330364c76b2'), 'user_id': UUID('16d20f86-8dd0-47f8-8855-57c75faa2066'), 'mode': 'interview', 'role': 'Python Developer', 'job_description': 'Looking for Python developer with Django experience', 'scenario_id': None, 'question_source': 'generated', 'job_context': '{"title": "Python Developer"}', 'status': 'active', 'total_questions': 0, 'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 0, 111954), 'updated_at': datetime.datetime(2026, 2, 13, 0, 45, 0, 111955)}]
E           (Background on this error at: https://sqlalche.me/e/20/gkpj)

app/services/session_service.py:74: AIServiceError</failure></testcase><testcase classname="tests.e2e.test_complete_interview_flow.TestCompleteInterviewFlow" name="test_question_bank_integration_flow" time="0.120"><failure message="app.exceptions.AIServiceError: Failed to create interview session: (psycopg2.errors.ForeignKeyViolation) insert or update on table &quot;interview_sessions&quot; violates foreign key constraint &quot;interview_sessions_user_id_fkey&quot;&#10;DETAIL:  Key (user_id)=(9df27201-aae1-42b6-bd9e-46ff3e30efab) is not present in table &quot;users&quot;.&#10;&#10;[SQL: INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, status, total_questions, completed_questions, created_at, updated_at) VALUES (%(id)s::UUID, %(user_id)s::UUID, %(mode)s, %(role)s, %(job_description)s, %(scenario_id)s, %(question_source)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)]&#10;[parameters: {'id': UUID('08173112-0a17-4ba8-85c6-2ef3e6b02894'), 'user_id': UUID('9df27201-aae1-42b6-bd9e-46ff3e30efab'), 'mode': 'interview', 'role': 'Python Developer', 'job_description': 'Looking for Python developer with Django experience', 'scenario_id': None, 'question_source': 'generated', 'job_context': '{&quot;title&quot;: &quot;Python Developer&quot;}', 'status': 'active', 'total_questions': 0, 'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 1, 522677), 'updated_at': datetime.datetime(2026, 2, 13, 0, 45, 1, 522679)}]&#10;(Background on this error at: https://sqlalche.me/e/20/gkpj)">self = &lt;sqlalchemy.engine.base.Connection object at 0xffff7081c4d0&gt;, dialect = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0xffff734ab9d0&gt;
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0xffff7081c690&gt;, statement = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0xffff71fe8d10&gt;
parameters = [{'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 1, 522677), 'id': UUID('08173112-0a17-4ba8-85c6-2ef3e6b02894'), 'job_context': '{"title": "Python Developer"}', ...}]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -&gt; CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
&gt;                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0xffff734ab9d0&gt;, cursor = &lt;cursor object at 0xffff7218b4c0; closed: -1&gt;
statement = 'INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, ...e)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)'
parameters = {'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 1, 522677), 'id': UUID('08173112-0a17-4ba8-85c6-2ef3e6b02894'), 'job_context': '{"title": "Python Developer"}', ...}
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0xffff7081c690&gt;

    def do_execute(self, cursor, statement, parameters, context=None):
&gt;       cursor.execute(statement, parameters)
E       psycopg2.errors.ForeignKeyViolation: insert or update on table "interview_sessions" violates foreign key constraint "interview_sessions_user_id_fkey"
E       DETAIL:  Key (user_id)=(9df27201-aae1-42b6-bd9e-46ff3e30efab) is not present in table "users".

/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py:952: ForeignKeyViolation

The above exception was the direct cause of the following exception:

self = &lt;app.services.session_service.SessionService object at 0xffff708f8190&gt;, user_id = UUID('9df27201-aae1-42b6-bd9e-46ff3e30efab'), role = 'Python Developer'
job_description = 'Looking for Python developer with Django experience', title = 'Python Developer', mode = 'interview'

    async def create_session(
        self,
        user_id: Union[int, str],
        role: str,
        job_description: str,
        title: Optional[str] = None,
        mode: str = "interview"
    ) -&gt; InterviewSession:
        """Create a new interview session (works for both sync and async)."""
        try:
            session_data = {
                "id": uuid.uuid4(),
                "user_id": user_id,
                "role": role,
                "job_description": job_description or "",
                "mode": mode,
                "question_source": "generated",
                "status": "active",
                "created_at": datetime.utcnow(),
                "updated_at": datetime.utcnow()
            }
            if title:
                session_data["job_context"] = {"title": title}
    
            session = InterviewSession(**session_data)
            self.db_session.add(session)
            if self.is_async:
                await self.db_session.commit()
                await self.db_session.refresh(session)
            else:
&gt;               self.db_session.commit()

app/services/session_service.py:62: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py:1048: in _emit_insert_statements
    result = connection.execute(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0xffff734ab9d0&gt;, cursor = &lt;cursor object at 0xffff7218b4c0; closed: -1&gt;
statement = 'INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, ...e)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)'
parameters = {'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 1, 522677), 'id': UUID('08173112-0a17-4ba8-85c6-2ef3e6b02894'), 'job_context': '{"title": "Python Developer"}', ...}
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0xffff7081c690&gt;

    def do_execute(self, cursor, statement, parameters, context=None):
&gt;       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (psycopg2.errors.ForeignKeyViolation) insert or update on table "interview_sessions" violates foreign key constraint "interview_sessions_user_id_fkey"
E       DETAIL:  Key (user_id)=(9df27201-aae1-42b6-bd9e-46ff3e30efab) is not present in table "users".
E       
E       [SQL: INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, status, total_questions, completed_questions, created_at, updated_at) VALUES (%(id)s::UUID, %(user_id)s::UUID, %(mode)s, %(role)s, %(job_description)s, %(scenario_id)s, %(question_source)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)]
E       [parameters: {'id': UUID('08173112-0a17-4ba8-85c6-2ef3e6b02894'), 'user_id': UUID('9df27201-aae1-42b6-bd9e-46ff3e30efab'), 'mode': 'interview', 'role': 'Python Developer', 'job_description': 'Looking for Python developer with Django experience', 'scenario_id': None, 'question_source': 'generated', 'job_context': '{"title": "Python Developer"}', 'status': 'active', 'total_questions': 0, 'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 1, 522677), 'updated_at': datetime.datetime(2026, 2, 13, 0, 45, 1, 522679)}]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

self = &lt;tests.e2e.test_complete_interview_flow.TestCompleteInterviewFlow object at 0xffff72753d50&gt;, client = &lt;starlette.testclient.TestClient object at 0xffff723e4410&gt;
sample_user = &lt;User(id=9df27201-aae1-42b6-bd9e-46ff3e30efab, email=test-4663a5c5@example.com, name=Test User)&gt;, mock_ai_client = &lt;AsyncMock id='281472570092432'&gt;
mock_question_bank_service = &lt;Mock id='281472481460752'&gt;, override_auth = &lt;function override_auth.&lt;locals&gt;._override at 0xffff70277ba0&gt;
override_ai_client = &lt;function override_ai_client.&lt;locals&gt;._override at 0xffff702765c0&gt;

    @pytest.mark.e2e
    def test_question_bank_integration_flow(self, client, sample_user, mock_ai_client, mock_question_bank_service, override_auth, override_ai_client):
        """Test complete flow with question bank integration."""
        override_auth({"id": sample_user.id, "email": sample_user.email, "is_admin": False})
        override_ai_client(mock_ai_client)
    
        # Step 1: Create session (should use question bank)
        session_data = {
            "user_id": str(sample_user.id),
            "mode": "interview",
            "role": "Python Developer",
            "job_title": "Python Developer",
            "job_description": "Looking for Python developer with Django experience"
        }
    
        with patch('app.services.session_service.SessionService', return_value=mock_question_bank_service):
            # Create session
&gt;           create_response = client.post("/api/v1/sessions/", json=session_data)

tests/e2e/test_complete_interview_flow.py:150: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:546: in post
    return super().post(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:1132: in post
    return self.request(
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:445: in request
    return super().request(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:814: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
/usr/local/lib/python3.11/site-packages/httpx/_client.py:901: in send
    response = self._send_handling_auth(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:929: in _send_handling_auth
    response = self._send_handling_redirects(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:966: in _send_handling_redirects
    response = self._send_single_request(request)
/usr/local/lib/python3.11/site-packages/httpx/_client.py:1002: in _send_single_request
    response = transport.handle_request(request)
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:348: in handle_request
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:345: in handle_request
    portal.call(self.app, scope, receive, send)
/usr/local/lib/python3.11/site-packages/anyio/from_thread.py:334: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
/usr/local/lib/python3.11/concurrent/futures/_base.py:456: in result
    return self.__get_result()
/usr/local/lib/python3.11/concurrent/futures/_base.py:401: in __get_result
    raise self._exception
/usr/local/lib/python3.11/site-packages/anyio/from_thread.py:259: in _call_func
    retval = await retval_or_awaitable
/usr/local/lib/python3.11/site-packages/fastapi/applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/applications.py:107: in __call__
    await self.middleware_stack(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/rate_limiting_middleware.py:51: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
app/middleware/rate_limiting_middleware.py:40: in dispatch
    response = await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/main.py:179: in logging_middleware
    return await log_requests(request, call_next)
app/middleware/logging_middleware.py:29: in log_requests
    response = await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/security_middleware.py:23: in dispatch
    response = await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/file_upload_middleware.py:222: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/file_upload_middleware.py:139: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/file_upload_middleware.py:30: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py:87: in __call__
    await self.app(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:119: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:105: in app
    response = await f(request)
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:424: in app
    raw_response = await run_endpoint_function(
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:312: in run_endpoint_function
    return await dependant.call(**values)
app/routers/sessions.py:40: in create_session
    session = await session_service.create_interview_session(
app/services/session_service.py:136: in create_interview_session
    return await self.create_session(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;app.services.session_service.SessionService object at 0xffff708f8190&gt;, user_id = UUID('9df27201-aae1-42b6-bd9e-46ff3e30efab'), role = 'Python Developer'
job_description = 'Looking for Python developer with Django experience', title = 'Python Developer', mode = 'interview'

    async def create_session(
        self,
        user_id: Union[int, str],
        role: str,
        job_description: str,
        title: Optional[str] = None,
        mode: str = "interview"
    ) -&gt; InterviewSession:
        """Create a new interview session (works for both sync and async)."""
        try:
            session_data = {
                "id": uuid.uuid4(),
                "user_id": user_id,
                "role": role,
                "job_description": job_description or "",
                "mode": mode,
                "question_source": "generated",
                "status": "active",
                "created_at": datetime.utcnow(),
                "updated_at": datetime.utcnow()
            }
            if title:
                session_data["job_context"] = {"title": title}
    
            session = InterviewSession(**session_data)
            self.db_session.add(session)
            if self.is_async:
                await self.db_session.commit()
                await self.db_session.refresh(session)
            else:
                self.db_session.commit()
                self.db_session.refresh(session)
    
            logger.info(f"Created interview session {session.id} for user {user_id}")
            return session
    
        except Exception as e:
            if self.is_async:
                await self.db_session.rollback()
            else:
                self.db_session.rollback()
            logger.error(f"Error creating session: {e}")
&gt;           raise AIServiceError(f"Failed to create interview session: {e}")
E           app.exceptions.AIServiceError: Failed to create interview session: (psycopg2.errors.ForeignKeyViolation) insert or update on table "interview_sessions" violates foreign key constraint "interview_sessions_user_id_fkey"
E           DETAIL:  Key (user_id)=(9df27201-aae1-42b6-bd9e-46ff3e30efab) is not present in table "users".
E           
E           [SQL: INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, status, total_questions, completed_questions, created_at, updated_at) VALUES (%(id)s::UUID, %(user_id)s::UUID, %(mode)s, %(role)s, %(job_description)s, %(scenario_id)s, %(question_source)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)]
E           [parameters: {'id': UUID('08173112-0a17-4ba8-85c6-2ef3e6b02894'), 'user_id': UUID('9df27201-aae1-42b6-bd9e-46ff3e30efab'), 'mode': 'interview', 'role': 'Python Developer', 'job_description': 'Looking for Python developer with Django experience', 'scenario_id': None, 'question_source': 'generated', 'job_context': '{"title": "Python Developer"}', 'status': 'active', 'total_questions': 0, 'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 1, 522677), 'updated_at': datetime.datetime(2026, 2, 13, 0, 45, 1, 522679)}]
E           (Background on this error at: https://sqlalche.me/e/20/gkpj)

app/services/session_service.py:74: AIServiceError</failure></testcase><testcase classname="tests.e2e.test_complete_interview_flow.TestCompleteInterviewFlow" name="test_error_recovery_flow" time="0.121"><failure message="app.exceptions.AIServiceError: Failed to create interview session: (psycopg2.errors.ForeignKeyViolation) insert or update on table &quot;interview_sessions&quot; violates foreign key constraint &quot;interview_sessions_user_id_fkey&quot;&#10;DETAIL:  Key (user_id)=(d8ef944e-476a-4d8c-884e-14ea52295699) is not present in table &quot;users&quot;.&#10;&#10;[SQL: INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, status, total_questions, completed_questions, created_at, updated_at) VALUES (%(id)s::UUID, %(user_id)s::UUID, %(mode)s, %(role)s, %(job_description)s, %(scenario_id)s, %(question_source)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)]&#10;[parameters: {'id': UUID('82795ffe-41d7-469a-ba83-6e5e0baa0197'), 'user_id': UUID('d8ef944e-476a-4d8c-884e-14ea52295699'), 'mode': 'interview', 'role': 'Python Developer', 'job_description': 'Looking for Python developer with Django experience', 'scenario_id': None, 'question_source': 'generated', 'job_context': '{&quot;title&quot;: &quot;Python Developer&quot;}', 'status': 'active', 'total_questions': 0, 'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 2, 585311), 'updated_at': datetime.datetime(2026, 2, 13, 0, 45, 2, 585312)}]&#10;(Background on this error at: https://sqlalche.me/e/20/gkpj)">self = &lt;sqlalchemy.engine.base.Connection object at 0xffff70160750&gt;, dialect = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0xffff734ab9d0&gt;
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0xffff70161050&gt;, statement = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0xffff71fe8d10&gt;
parameters = [{'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 2, 585311), 'id': UUID('82795ffe-41d7-469a-ba83-6e5e0baa0197'), 'job_context': '{"title": "Python Developer"}', ...}]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -&gt; CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
&gt;                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0xffff734ab9d0&gt;, cursor = &lt;cursor object at 0xffff71ff2f20; closed: -1&gt;
statement = 'INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, ...e)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)'
parameters = {'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 2, 585311), 'id': UUID('82795ffe-41d7-469a-ba83-6e5e0baa0197'), 'job_context': '{"title": "Python Developer"}', ...}
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0xffff70161050&gt;

    def do_execute(self, cursor, statement, parameters, context=None):
&gt;       cursor.execute(statement, parameters)
E       psycopg2.errors.ForeignKeyViolation: insert or update on table "interview_sessions" violates foreign key constraint "interview_sessions_user_id_fkey"
E       DETAIL:  Key (user_id)=(d8ef944e-476a-4d8c-884e-14ea52295699) is not present in table "users".

/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py:952: ForeignKeyViolation

The above exception was the direct cause of the following exception:

self = &lt;app.services.session_service.SessionService object at 0xffff6adbe150&gt;, user_id = UUID('d8ef944e-476a-4d8c-884e-14ea52295699'), role = 'Python Developer'
job_description = 'Looking for Python developer with Django experience', title = 'Python Developer', mode = 'interview'

    async def create_session(
        self,
        user_id: Union[int, str],
        role: str,
        job_description: str,
        title: Optional[str] = None,
        mode: str = "interview"
    ) -&gt; InterviewSession:
        """Create a new interview session (works for both sync and async)."""
        try:
            session_data = {
                "id": uuid.uuid4(),
                "user_id": user_id,
                "role": role,
                "job_description": job_description or "",
                "mode": mode,
                "question_source": "generated",
                "status": "active",
                "created_at": datetime.utcnow(),
                "updated_at": datetime.utcnow()
            }
            if title:
                session_data["job_context"] = {"title": title}
    
            session = InterviewSession(**session_data)
            self.db_session.add(session)
            if self.is_async:
                await self.db_session.commit()
                await self.db_session.refresh(session)
            else:
&gt;               self.db_session.commit()

app/services/session_service.py:62: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py:1048: in _emit_insert_statements
    result = connection.execute(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0xffff734ab9d0&gt;, cursor = &lt;cursor object at 0xffff71ff2f20; closed: -1&gt;
statement = 'INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, ...e)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)'
parameters = {'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 2, 585311), 'id': UUID('82795ffe-41d7-469a-ba83-6e5e0baa0197'), 'job_context': '{"title": "Python Developer"}', ...}
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0xffff70161050&gt;

    def do_execute(self, cursor, statement, parameters, context=None):
&gt;       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (psycopg2.errors.ForeignKeyViolation) insert or update on table "interview_sessions" violates foreign key constraint "interview_sessions_user_id_fkey"
E       DETAIL:  Key (user_id)=(d8ef944e-476a-4d8c-884e-14ea52295699) is not present in table "users".
E       
E       [SQL: INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, status, total_questions, completed_questions, created_at, updated_at) VALUES (%(id)s::UUID, %(user_id)s::UUID, %(mode)s, %(role)s, %(job_description)s, %(scenario_id)s, %(question_source)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)]
E       [parameters: {'id': UUID('82795ffe-41d7-469a-ba83-6e5e0baa0197'), 'user_id': UUID('d8ef944e-476a-4d8c-884e-14ea52295699'), 'mode': 'interview', 'role': 'Python Developer', 'job_description': 'Looking for Python developer with Django experience', 'scenario_id': None, 'question_source': 'generated', 'job_context': '{"title": "Python Developer"}', 'status': 'active', 'total_questions': 0, 'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 2, 585311), 'updated_at': datetime.datetime(2026, 2, 13, 0, 45, 2, 585312)}]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

self = &lt;tests.e2e.test_complete_interview_flow.TestCompleteInterviewFlow object at 0xffff72778410&gt;, client = &lt;starlette.testclient.TestClient object at 0xffff723e4410&gt;
sample_user = &lt;User(id=d8ef944e-476a-4d8c-884e-14ea52295699, email=test-c0d1dfab@example.com, name=Test User)&gt;, mock_ai_client = &lt;AsyncMock id='281472561862096'&gt;
override_auth = &lt;function override_auth.&lt;locals&gt;._override at 0xffff70275440&gt;, override_ai_client = &lt;function override_ai_client.&lt;locals&gt;._override at 0xffff70276e80&gt;

    @pytest.mark.e2e
    def test_error_recovery_flow(self, client, sample_user, mock_ai_client, override_auth, override_ai_client):
        """Test error recovery and resilience in the interview flow."""
        override_auth({"id": sample_user.id, "email": sample_user.email, "is_admin": False})
        override_ai_client(mock_ai_client)
    
        # Step 1: Create session
        session_data = {
            "user_id": str(sample_user.id),
            "mode": "interview",
            "role": "Python Developer",
            "job_title": "Python Developer",
            "job_description": "Looking for Python developer with Django experience"
        }
    
        # Create session
&gt;       create_response = client.post("/api/v1/sessions/", json=session_data)

tests/e2e/test_complete_interview_flow.py:199: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:546: in post
    return super().post(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:1132: in post
    return self.request(
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:445: in request
    return super().request(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:814: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
/usr/local/lib/python3.11/site-packages/httpx/_client.py:901: in send
    response = self._send_handling_auth(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:929: in _send_handling_auth
    response = self._send_handling_redirects(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:966: in _send_handling_redirects
    response = self._send_single_request(request)
/usr/local/lib/python3.11/site-packages/httpx/_client.py:1002: in _send_single_request
    response = transport.handle_request(request)
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:348: in handle_request
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:345: in handle_request
    portal.call(self.app, scope, receive, send)
/usr/local/lib/python3.11/site-packages/anyio/from_thread.py:334: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
/usr/local/lib/python3.11/concurrent/futures/_base.py:456: in result
    return self.__get_result()
/usr/local/lib/python3.11/concurrent/futures/_base.py:401: in __get_result
    raise self._exception
/usr/local/lib/python3.11/site-packages/anyio/from_thread.py:259: in _call_func
    retval = await retval_or_awaitable
/usr/local/lib/python3.11/site-packages/fastapi/applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/applications.py:107: in __call__
    await self.middleware_stack(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/rate_limiting_middleware.py:51: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
app/middleware/rate_limiting_middleware.py:40: in dispatch
    response = await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/main.py:179: in logging_middleware
    return await log_requests(request, call_next)
app/middleware/logging_middleware.py:29: in log_requests
    response = await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/security_middleware.py:23: in dispatch
    response = await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/file_upload_middleware.py:222: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/file_upload_middleware.py:139: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/file_upload_middleware.py:30: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py:87: in __call__
    await self.app(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:119: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:105: in app
    response = await f(request)
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:424: in app
    raw_response = await run_endpoint_function(
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:312: in run_endpoint_function
    return await dependant.call(**values)
app/routers/sessions.py:40: in create_session
    session = await session_service.create_interview_session(
app/services/session_service.py:136: in create_interview_session
    return await self.create_session(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;app.services.session_service.SessionService object at 0xffff6adbe150&gt;, user_id = UUID('d8ef944e-476a-4d8c-884e-14ea52295699'), role = 'Python Developer'
job_description = 'Looking for Python developer with Django experience', title = 'Python Developer', mode = 'interview'

    async def create_session(
        self,
        user_id: Union[int, str],
        role: str,
        job_description: str,
        title: Optional[str] = None,
        mode: str = "interview"
    ) -&gt; InterviewSession:
        """Create a new interview session (works for both sync and async)."""
        try:
            session_data = {
                "id": uuid.uuid4(),
                "user_id": user_id,
                "role": role,
                "job_description": job_description or "",
                "mode": mode,
                "question_source": "generated",
                "status": "active",
                "created_at": datetime.utcnow(),
                "updated_at": datetime.utcnow()
            }
            if title:
                session_data["job_context"] = {"title": title}
    
            session = InterviewSession(**session_data)
            self.db_session.add(session)
            if self.is_async:
                await self.db_session.commit()
                await self.db_session.refresh(session)
            else:
                self.db_session.commit()
                self.db_session.refresh(session)
    
            logger.info(f"Created interview session {session.id} for user {user_id}")
            return session
    
        except Exception as e:
            if self.is_async:
                await self.db_session.rollback()
            else:
                self.db_session.rollback()
            logger.error(f"Error creating session: {e}")
&gt;           raise AIServiceError(f"Failed to create interview session: {e}")
E           app.exceptions.AIServiceError: Failed to create interview session: (psycopg2.errors.ForeignKeyViolation) insert or update on table "interview_sessions" violates foreign key constraint "interview_sessions_user_id_fkey"
E           DETAIL:  Key (user_id)=(d8ef944e-476a-4d8c-884e-14ea52295699) is not present in table "users".
E           
E           [SQL: INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, status, total_questions, completed_questions, created_at, updated_at) VALUES (%(id)s::UUID, %(user_id)s::UUID, %(mode)s, %(role)s, %(job_description)s, %(scenario_id)s, %(question_source)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)]
E           [parameters: {'id': UUID('82795ffe-41d7-469a-ba83-6e5e0baa0197'), 'user_id': UUID('d8ef944e-476a-4d8c-884e-14ea52295699'), 'mode': 'interview', 'role': 'Python Developer', 'job_description': 'Looking for Python developer with Django experience', 'scenario_id': None, 'question_source': 'generated', 'job_context': '{"title": "Python Developer"}', 'status': 'active', 'total_questions': 0, 'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 2, 585311), 'updated_at': datetime.datetime(2026, 2, 13, 0, 45, 2, 585312)}]
E           (Background on this error at: https://sqlalche.me/e/20/gkpj)

app/services/session_service.py:74: AIServiceError</failure></testcase><testcase classname="tests.e2e.test_complete_interview_flow.TestCompleteInterviewFlow" name="test_concurrent_session_operations" time="0.118"><failure message="app.exceptions.AIServiceError: Failed to create interview session: (psycopg2.errors.ForeignKeyViolation) insert or update on table &quot;interview_sessions&quot; violates foreign key constraint &quot;interview_sessions_user_id_fkey&quot;&#10;DETAIL:  Key (user_id)=(7dcb7e59-65c4-4da8-9434-2214b36b9b40) is not present in table &quot;users&quot;.&#10;&#10;[SQL: INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, status, total_questions, completed_questions, created_at, updated_at) VALUES (%(id)s::UUID, %(user_id)s::UUID, %(mode)s, %(role)s, %(job_description)s, %(scenario_id)s, %(question_source)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)]&#10;[parameters: {'id': UUID('efede34e-3ec5-46d7-ba67-f85f576d924d'), 'user_id': UUID('7dcb7e59-65c4-4da8-9434-2214b36b9b40'), 'mode': 'interview', 'role': 'Python Developer', 'job_description': 'Looking for Python developer with Django experience', 'scenario_id': None, 'question_source': 'generated', 'job_context': '{&quot;title&quot;: &quot;Python Developer&quot;}', 'status': 'active', 'total_questions': 0, 'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 3, 906267), 'updated_at': datetime.datetime(2026, 2, 13, 0, 45, 3, 906267)}]&#10;(Background on this error at: https://sqlalche.me/e/20/gkpj)">self = &lt;sqlalchemy.engine.base.Connection object at 0xffff71dff890&gt;, dialect = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0xffff734ab9d0&gt;
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0xffff71dff650&gt;, statement = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0xffff71fe8d10&gt;
parameters = [{'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 3, 906267), 'id': UUID('efede34e-3ec5-46d7-ba67-f85f576d924d'), 'job_context': '{"title": "Python Developer"}', ...}]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -&gt; CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
&gt;                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0xffff734ab9d0&gt;, cursor = &lt;cursor object at 0xffff71ff2d40; closed: -1&gt;
statement = 'INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, ...e)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)'
parameters = {'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 3, 906267), 'id': UUID('efede34e-3ec5-46d7-ba67-f85f576d924d'), 'job_context': '{"title": "Python Developer"}', ...}
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0xffff71dff650&gt;

    def do_execute(self, cursor, statement, parameters, context=None):
&gt;       cursor.execute(statement, parameters)
E       psycopg2.errors.ForeignKeyViolation: insert or update on table "interview_sessions" violates foreign key constraint "interview_sessions_user_id_fkey"
E       DETAIL:  Key (user_id)=(7dcb7e59-65c4-4da8-9434-2214b36b9b40) is not present in table "users".

/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py:952: ForeignKeyViolation

The above exception was the direct cause of the following exception:

self = &lt;app.services.session_service.SessionService object at 0xffff6b705dd0&gt;, user_id = UUID('7dcb7e59-65c4-4da8-9434-2214b36b9b40'), role = 'Python Developer'
job_description = 'Looking for Python developer with Django experience', title = 'Python Developer', mode = 'interview'

    async def create_session(
        self,
        user_id: Union[int, str],
        role: str,
        job_description: str,
        title: Optional[str] = None,
        mode: str = "interview"
    ) -&gt; InterviewSession:
        """Create a new interview session (works for both sync and async)."""
        try:
            session_data = {
                "id": uuid.uuid4(),
                "user_id": user_id,
                "role": role,
                "job_description": job_description or "",
                "mode": mode,
                "question_source": "generated",
                "status": "active",
                "created_at": datetime.utcnow(),
                "updated_at": datetime.utcnow()
            }
            if title:
                session_data["job_context"] = {"title": title}
    
            session = InterviewSession(**session_data)
            self.db_session.add(session)
            if self.is_async:
                await self.db_session.commit()
                await self.db_session.refresh(session)
            else:
&gt;               self.db_session.commit()

app/services/session_service.py:62: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py:1048: in _emit_insert_statements
    result = connection.execute(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0xffff734ab9d0&gt;, cursor = &lt;cursor object at 0xffff71ff2d40; closed: -1&gt;
statement = 'INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, ...e)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)'
parameters = {'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 3, 906267), 'id': UUID('efede34e-3ec5-46d7-ba67-f85f576d924d'), 'job_context': '{"title": "Python Developer"}', ...}
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0xffff71dff650&gt;

    def do_execute(self, cursor, statement, parameters, context=None):
&gt;       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (psycopg2.errors.ForeignKeyViolation) insert or update on table "interview_sessions" violates foreign key constraint "interview_sessions_user_id_fkey"
E       DETAIL:  Key (user_id)=(7dcb7e59-65c4-4da8-9434-2214b36b9b40) is not present in table "users".
E       
E       [SQL: INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, status, total_questions, completed_questions, created_at, updated_at) VALUES (%(id)s::UUID, %(user_id)s::UUID, %(mode)s, %(role)s, %(job_description)s, %(scenario_id)s, %(question_source)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)]
E       [parameters: {'id': UUID('efede34e-3ec5-46d7-ba67-f85f576d924d'), 'user_id': UUID('7dcb7e59-65c4-4da8-9434-2214b36b9b40'), 'mode': 'interview', 'role': 'Python Developer', 'job_description': 'Looking for Python developer with Django experience', 'scenario_id': None, 'question_source': 'generated', 'job_context': '{"title": "Python Developer"}', 'status': 'active', 'total_questions': 0, 'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 3, 906267), 'updated_at': datetime.datetime(2026, 2, 13, 0, 45, 3, 906267)}]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

self = &lt;tests.e2e.test_complete_interview_flow.TestCompleteInterviewFlow object at 0xffff72778a50&gt;, client = &lt;starlette.testclient.TestClient object at 0xffff723e4410&gt;
sample_user = &lt;User(id=7dcb7e59-65c4-4da8-9434-2214b36b9b40, email=test-87c221e5@example.com, name=Test User)&gt;, mock_ai_client = &lt;AsyncMock id='281472473019984'&gt;
override_auth = &lt;function override_auth.&lt;locals&gt;._override at 0xffff729db1a0&gt;, override_ai_client = &lt;function override_ai_client.&lt;locals&gt;._override at 0xffff729dade0&gt;

    @pytest.mark.e2e
    def test_concurrent_session_operations(self, client, sample_user, mock_ai_client, override_auth, override_ai_client):
        """Test concurrent operations on the same session."""
        override_auth({"id": sample_user.id, "email": sample_user.email, "is_admin": False})
        override_ai_client(mock_ai_client)
    
        # Step 1: Create session
        session_data = {
            "user_id": str(sample_user.id),
            "mode": "interview",
            "role": "Python Developer",
            "job_title": "Python Developer",
            "job_description": "Looking for Python developer with Django experience"
        }
    
        # Create session
&gt;       create_response = client.post("/api/v1/sessions/", json=session_data)

tests/e2e/test_complete_interview_flow.py:257: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:546: in post
    return super().post(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:1132: in post
    return self.request(
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:445: in request
    return super().request(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:814: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
/usr/local/lib/python3.11/site-packages/httpx/_client.py:901: in send
    response = self._send_handling_auth(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:929: in _send_handling_auth
    response = self._send_handling_redirects(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:966: in _send_handling_redirects
    response = self._send_single_request(request)
/usr/local/lib/python3.11/site-packages/httpx/_client.py:1002: in _send_single_request
    response = transport.handle_request(request)
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:348: in handle_request
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:345: in handle_request
    portal.call(self.app, scope, receive, send)
/usr/local/lib/python3.11/site-packages/anyio/from_thread.py:334: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
/usr/local/lib/python3.11/concurrent/futures/_base.py:456: in result
    return self.__get_result()
/usr/local/lib/python3.11/concurrent/futures/_base.py:401: in __get_result
    raise self._exception
/usr/local/lib/python3.11/site-packages/anyio/from_thread.py:259: in _call_func
    retval = await retval_or_awaitable
/usr/local/lib/python3.11/site-packages/fastapi/applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/applications.py:107: in __call__
    await self.middleware_stack(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/rate_limiting_middleware.py:51: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
app/middleware/rate_limiting_middleware.py:40: in dispatch
    response = await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/main.py:179: in logging_middleware
    return await log_requests(request, call_next)
app/middleware/logging_middleware.py:29: in log_requests
    response = await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/security_middleware.py:23: in dispatch
    response = await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/file_upload_middleware.py:222: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/file_upload_middleware.py:139: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/file_upload_middleware.py:30: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py:87: in __call__
    await self.app(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:119: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:105: in app
    response = await f(request)
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:424: in app
    raw_response = await run_endpoint_function(
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:312: in run_endpoint_function
    return await dependant.call(**values)
app/routers/sessions.py:40: in create_session
    session = await session_service.create_interview_session(
app/services/session_service.py:136: in create_interview_session
    return await self.create_session(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;app.services.session_service.SessionService object at 0xffff6b705dd0&gt;, user_id = UUID('7dcb7e59-65c4-4da8-9434-2214b36b9b40'), role = 'Python Developer'
job_description = 'Looking for Python developer with Django experience', title = 'Python Developer', mode = 'interview'

    async def create_session(
        self,
        user_id: Union[int, str],
        role: str,
        job_description: str,
        title: Optional[str] = None,
        mode: str = "interview"
    ) -&gt; InterviewSession:
        """Create a new interview session (works for both sync and async)."""
        try:
            session_data = {
                "id": uuid.uuid4(),
                "user_id": user_id,
                "role": role,
                "job_description": job_description or "",
                "mode": mode,
                "question_source": "generated",
                "status": "active",
                "created_at": datetime.utcnow(),
                "updated_at": datetime.utcnow()
            }
            if title:
                session_data["job_context"] = {"title": title}
    
            session = InterviewSession(**session_data)
            self.db_session.add(session)
            if self.is_async:
                await self.db_session.commit()
                await self.db_session.refresh(session)
            else:
                self.db_session.commit()
                self.db_session.refresh(session)
    
            logger.info(f"Created interview session {session.id} for user {user_id}")
            return session
    
        except Exception as e:
            if self.is_async:
                await self.db_session.rollback()
            else:
                self.db_session.rollback()
            logger.error(f"Error creating session: {e}")
&gt;           raise AIServiceError(f"Failed to create interview session: {e}")
E           app.exceptions.AIServiceError: Failed to create interview session: (psycopg2.errors.ForeignKeyViolation) insert or update on table "interview_sessions" violates foreign key constraint "interview_sessions_user_id_fkey"
E           DETAIL:  Key (user_id)=(7dcb7e59-65c4-4da8-9434-2214b36b9b40) is not present in table "users".
E           
E           [SQL: INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, status, total_questions, completed_questions, created_at, updated_at) VALUES (%(id)s::UUID, %(user_id)s::UUID, %(mode)s, %(role)s, %(job_description)s, %(scenario_id)s, %(question_source)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)]
E           [parameters: {'id': UUID('efede34e-3ec5-46d7-ba67-f85f576d924d'), 'user_id': UUID('7dcb7e59-65c4-4da8-9434-2214b36b9b40'), 'mode': 'interview', 'role': 'Python Developer', 'job_description': 'Looking for Python developer with Django experience', 'scenario_id': None, 'question_source': 'generated', 'job_context': '{"title": "Python Developer"}', 'status': 'active', 'total_questions': 0, 'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 3, 906267), 'updated_at': datetime.datetime(2026, 2, 13, 0, 45, 3, 906267)}]
E           (Background on this error at: https://sqlalche.me/e/20/gkpj)

app/services/session_service.py:74: AIServiceError</failure></testcase><testcase classname="tests.e2e.test_complete_interview_flow.TestCompleteInterviewFlow" name="test_session_lifecycle_management" time="0.162"><failure message="app.exceptions.AIServiceError: Failed to create interview session: (psycopg2.errors.ForeignKeyViolation) insert or update on table &quot;interview_sessions&quot; violates foreign key constraint &quot;interview_sessions_user_id_fkey&quot;&#10;DETAIL:  Key (user_id)=(f0cc9e03-8b18-450b-af26-dfde47eb47b9) is not present in table &quot;users&quot;.&#10;&#10;[SQL: INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, status, total_questions, completed_questions, created_at, updated_at) VALUES (%(id)s::UUID, %(user_id)s::UUID, %(mode)s, %(role)s, %(job_description)s, %(scenario_id)s, %(question_source)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)]&#10;[parameters: {'id': UUID('03b3f274-34dd-4ae7-a869-a2b751189889'), 'user_id': UUID('f0cc9e03-8b18-450b-af26-dfde47eb47b9'), 'mode': 'interview', 'role': 'Python Developer', 'job_description': 'Looking for Python developer with Django experience', 'scenario_id': None, 'question_source': 'generated', 'job_context': '{&quot;title&quot;: &quot;Python Developer&quot;}', 'status': 'active', 'total_questions': 0, 'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 5, 8695), 'updated_at': datetime.datetime(2026, 2, 13, 0, 45, 5, 8696)}]&#10;(Background on this error at: https://sqlalche.me/e/20/gkpj)">self = &lt;sqlalchemy.engine.base.Connection object at 0xffff709fcc50&gt;, dialect = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0xffff734ab9d0&gt;
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0xffff709fc9d0&gt;, statement = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0xffff71fe8d10&gt;
parameters = [{'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 5, 8695), 'id': UUID('03b3f274-34dd-4ae7-a869-a2b751189889'), 'job_context': '{"title": "Python Developer"}', ...}]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -&gt; CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
&gt;                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0xffff734ab9d0&gt;, cursor = &lt;cursor object at 0xffff71f5b880; closed: -1&gt;
statement = 'INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, ...e)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)'
parameters = {'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 5, 8695), 'id': UUID('03b3f274-34dd-4ae7-a869-a2b751189889'), 'job_context': '{"title": "Python Developer"}', ...}
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0xffff709fc9d0&gt;

    def do_execute(self, cursor, statement, parameters, context=None):
&gt;       cursor.execute(statement, parameters)
E       psycopg2.errors.ForeignKeyViolation: insert or update on table "interview_sessions" violates foreign key constraint "interview_sessions_user_id_fkey"
E       DETAIL:  Key (user_id)=(f0cc9e03-8b18-450b-af26-dfde47eb47b9) is not present in table "users".

/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py:952: ForeignKeyViolation

The above exception was the direct cause of the following exception:

self = &lt;app.services.session_service.SessionService object at 0xffff6b407050&gt;, user_id = UUID('f0cc9e03-8b18-450b-af26-dfde47eb47b9'), role = 'Python Developer'
job_description = 'Looking for Python developer with Django experience', title = 'Python Developer', mode = 'interview'

    async def create_session(
        self,
        user_id: Union[int, str],
        role: str,
        job_description: str,
        title: Optional[str] = None,
        mode: str = "interview"
    ) -&gt; InterviewSession:
        """Create a new interview session (works for both sync and async)."""
        try:
            session_data = {
                "id": uuid.uuid4(),
                "user_id": user_id,
                "role": role,
                "job_description": job_description or "",
                "mode": mode,
                "question_source": "generated",
                "status": "active",
                "created_at": datetime.utcnow(),
                "updated_at": datetime.utcnow()
            }
            if title:
                session_data["job_context"] = {"title": title}
    
            session = InterviewSession(**session_data)
            self.db_session.add(session)
            if self.is_async:
                await self.db_session.commit()
                await self.db_session.refresh(session)
            else:
&gt;               self.db_session.commit()

app/services/session_service.py:62: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py:1048: in _emit_insert_statements
    result = connection.execute(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0xffff734ab9d0&gt;, cursor = &lt;cursor object at 0xffff71f5b880; closed: -1&gt;
statement = 'INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, ...e)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)'
parameters = {'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 5, 8695), 'id': UUID('03b3f274-34dd-4ae7-a869-a2b751189889'), 'job_context': '{"title": "Python Developer"}', ...}
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0xffff709fc9d0&gt;

    def do_execute(self, cursor, statement, parameters, context=None):
&gt;       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (psycopg2.errors.ForeignKeyViolation) insert or update on table "interview_sessions" violates foreign key constraint "interview_sessions_user_id_fkey"
E       DETAIL:  Key (user_id)=(f0cc9e03-8b18-450b-af26-dfde47eb47b9) is not present in table "users".
E       
E       [SQL: INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, status, total_questions, completed_questions, created_at, updated_at) VALUES (%(id)s::UUID, %(user_id)s::UUID, %(mode)s, %(role)s, %(job_description)s, %(scenario_id)s, %(question_source)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)]
E       [parameters: {'id': UUID('03b3f274-34dd-4ae7-a869-a2b751189889'), 'user_id': UUID('f0cc9e03-8b18-450b-af26-dfde47eb47b9'), 'mode': 'interview', 'role': 'Python Developer', 'job_description': 'Looking for Python developer with Django experience', 'scenario_id': None, 'question_source': 'generated', 'job_context': '{"title": "Python Developer"}', 'status': 'active', 'total_questions': 0, 'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 5, 8695), 'updated_at': datetime.datetime(2026, 2, 13, 0, 45, 5, 8696)}]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

self = &lt;tests.e2e.test_complete_interview_flow.TestCompleteInterviewFlow object at 0xffff72779090&gt;, client = &lt;starlette.testclient.TestClient object at 0xffff723e4410&gt;
sample_user = &lt;User(id=f0cc9e03-8b18-450b-af26-dfde47eb47b9, email=test-675346ec@example.com, name=Test User)&gt;, mock_ai_client = &lt;AsyncMock id='281472599373328'&gt;
override_auth = &lt;function override_auth.&lt;locals&gt;._override at 0xffff70277d80&gt;, override_ai_client = &lt;function override_ai_client.&lt;locals&gt;._override at 0xffff70274ae0&gt;

    @pytest.mark.e2e
    def test_session_lifecycle_management(self, client, sample_user, mock_ai_client, override_auth, override_ai_client):
        """Test complete session lifecycle from creation to deletion."""
        override_auth({"id": sample_user.id, "email": sample_user.email, "is_admin": False})
        override_ai_client(mock_ai_client)
    
        # Step 1: Create session
        session_data = {
            "user_id": str(sample_user.id),
            "mode": "interview",
            "role": "Python Developer",
            "job_title": "Python Developer",
            "job_description": "Looking for Python developer with Django experience"
        }
    
        # Create session
&gt;       create_response = client.post("/api/v1/sessions/", json=session_data)

tests/e2e/test_complete_interview_flow.py:298: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:546: in post
    return super().post(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:1132: in post
    return self.request(
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:445: in request
    return super().request(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:814: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
/usr/local/lib/python3.11/site-packages/httpx/_client.py:901: in send
    response = self._send_handling_auth(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:929: in _send_handling_auth
    response = self._send_handling_redirects(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:966: in _send_handling_redirects
    response = self._send_single_request(request)
/usr/local/lib/python3.11/site-packages/httpx/_client.py:1002: in _send_single_request
    response = transport.handle_request(request)
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:348: in handle_request
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:345: in handle_request
    portal.call(self.app, scope, receive, send)
/usr/local/lib/python3.11/site-packages/anyio/from_thread.py:334: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
/usr/local/lib/python3.11/concurrent/futures/_base.py:456: in result
    return self.__get_result()
/usr/local/lib/python3.11/concurrent/futures/_base.py:401: in __get_result
    raise self._exception
/usr/local/lib/python3.11/site-packages/anyio/from_thread.py:259: in _call_func
    retval = await retval_or_awaitable
/usr/local/lib/python3.11/site-packages/fastapi/applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/applications.py:107: in __call__
    await self.middleware_stack(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/rate_limiting_middleware.py:51: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
app/middleware/rate_limiting_middleware.py:40: in dispatch
    response = await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/main.py:179: in logging_middleware
    return await log_requests(request, call_next)
app/middleware/logging_middleware.py:29: in log_requests
    response = await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/security_middleware.py:23: in dispatch
    response = await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/file_upload_middleware.py:222: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/file_upload_middleware.py:139: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/file_upload_middleware.py:30: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py:87: in __call__
    await self.app(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:119: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:105: in app
    response = await f(request)
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:424: in app
    raw_response = await run_endpoint_function(
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:312: in run_endpoint_function
    return await dependant.call(**values)
app/routers/sessions.py:40: in create_session
    session = await session_service.create_interview_session(
app/services/session_service.py:136: in create_interview_session
    return await self.create_session(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;app.services.session_service.SessionService object at 0xffff6b407050&gt;, user_id = UUID('f0cc9e03-8b18-450b-af26-dfde47eb47b9'), role = 'Python Developer'
job_description = 'Looking for Python developer with Django experience', title = 'Python Developer', mode = 'interview'

    async def create_session(
        self,
        user_id: Union[int, str],
        role: str,
        job_description: str,
        title: Optional[str] = None,
        mode: str = "interview"
    ) -&gt; InterviewSession:
        """Create a new interview session (works for both sync and async)."""
        try:
            session_data = {
                "id": uuid.uuid4(),
                "user_id": user_id,
                "role": role,
                "job_description": job_description or "",
                "mode": mode,
                "question_source": "generated",
                "status": "active",
                "created_at": datetime.utcnow(),
                "updated_at": datetime.utcnow()
            }
            if title:
                session_data["job_context"] = {"title": title}
    
            session = InterviewSession(**session_data)
            self.db_session.add(session)
            if self.is_async:
                await self.db_session.commit()
                await self.db_session.refresh(session)
            else:
                self.db_session.commit()
                self.db_session.refresh(session)
    
            logger.info(f"Created interview session {session.id} for user {user_id}")
            return session
    
        except Exception as e:
            if self.is_async:
                await self.db_session.rollback()
            else:
                self.db_session.rollback()
            logger.error(f"Error creating session: {e}")
&gt;           raise AIServiceError(f"Failed to create interview session: {e}")
E           app.exceptions.AIServiceError: Failed to create interview session: (psycopg2.errors.ForeignKeyViolation) insert or update on table "interview_sessions" violates foreign key constraint "interview_sessions_user_id_fkey"
E           DETAIL:  Key (user_id)=(f0cc9e03-8b18-450b-af26-dfde47eb47b9) is not present in table "users".
E           
E           [SQL: INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, status, total_questions, completed_questions, created_at, updated_at) VALUES (%(id)s::UUID, %(user_id)s::UUID, %(mode)s, %(role)s, %(job_description)s, %(scenario_id)s, %(question_source)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)]
E           [parameters: {'id': UUID('03b3f274-34dd-4ae7-a869-a2b751189889'), 'user_id': UUID('f0cc9e03-8b18-450b-af26-dfde47eb47b9'), 'mode': 'interview', 'role': 'Python Developer', 'job_description': 'Looking for Python developer with Django experience', 'scenario_id': None, 'question_source': 'generated', 'job_context': '{"title": "Python Developer"}', 'status': 'active', 'total_questions': 0, 'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 5, 8695), 'updated_at': datetime.datetime(2026, 2, 13, 0, 45, 5, 8696)}]
E           (Background on this error at: https://sqlalche.me/e/20/gkpj)

app/services/session_service.py:74: AIServiceError</failure></testcase><testcase classname="tests.e2e.test_complete_interview_flow.TestCompleteInterviewFlow" name="test_data_consistency_across_operations" time="0.119"><failure message="app.exceptions.AIServiceError: Failed to create interview session: (psycopg2.errors.ForeignKeyViolation) insert or update on table &quot;interview_sessions&quot; violates foreign key constraint &quot;interview_sessions_user_id_fkey&quot;&#10;DETAIL:  Key (user_id)=(af759445-cea6-43b2-b457-f2f4476f09fa) is not present in table &quot;users&quot;.&#10;&#10;[SQL: INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, status, total_questions, completed_questions, created_at, updated_at) VALUES (%(id)s::UUID, %(user_id)s::UUID, %(mode)s, %(role)s, %(job_description)s, %(scenario_id)s, %(question_source)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)]&#10;[parameters: {'id': UUID('46c32a7a-27cd-4b7f-82f4-50900c258b41'), 'user_id': UUID('af759445-cea6-43b2-b457-f2f4476f09fa'), 'mode': 'interview', 'role': 'Python Developer', 'job_description': 'Looking for Python developer with Django experience', 'scenario_id': None, 'question_source': 'generated', 'job_context': '{&quot;title&quot;: &quot;Python Developer&quot;}', 'status': 'active', 'total_questions': 0, 'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 6, 221620), 'updated_at': datetime.datetime(2026, 2, 13, 0, 45, 6, 221621)}]&#10;(Background on this error at: https://sqlalche.me/e/20/gkpj)">self = &lt;sqlalchemy.engine.base.Connection object at 0xffff7054f9d0&gt;, dialect = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0xffff734ab9d0&gt;
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0xffff7054fc10&gt;, statement = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0xffff71fe8d10&gt;
parameters = [{'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 6, 221620), 'id': UUID('46c32a7a-27cd-4b7f-82f4-50900c258b41'), 'job_context': '{"title": "Python Developer"}', ...}]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -&gt; CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
&gt;                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0xffff734ab9d0&gt;, cursor = &lt;cursor object at 0xffff7218b790; closed: -1&gt;
statement = 'INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, ...e)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)'
parameters = {'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 6, 221620), 'id': UUID('46c32a7a-27cd-4b7f-82f4-50900c258b41'), 'job_context': '{"title": "Python Developer"}', ...}
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0xffff7054fc10&gt;

    def do_execute(self, cursor, statement, parameters, context=None):
&gt;       cursor.execute(statement, parameters)
E       psycopg2.errors.ForeignKeyViolation: insert or update on table "interview_sessions" violates foreign key constraint "interview_sessions_user_id_fkey"
E       DETAIL:  Key (user_id)=(af759445-cea6-43b2-b457-f2f4476f09fa) is not present in table "users".

/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py:952: ForeignKeyViolation

The above exception was the direct cause of the following exception:

self = &lt;app.services.session_service.SessionService object at 0xffff713ad7d0&gt;, user_id = UUID('af759445-cea6-43b2-b457-f2f4476f09fa'), role = 'Python Developer'
job_description = 'Looking for Python developer with Django experience', title = 'Python Developer', mode = 'interview'

    async def create_session(
        self,
        user_id: Union[int, str],
        role: str,
        job_description: str,
        title: Optional[str] = None,
        mode: str = "interview"
    ) -&gt; InterviewSession:
        """Create a new interview session (works for both sync and async)."""
        try:
            session_data = {
                "id": uuid.uuid4(),
                "user_id": user_id,
                "role": role,
                "job_description": job_description or "",
                "mode": mode,
                "question_source": "generated",
                "status": "active",
                "created_at": datetime.utcnow(),
                "updated_at": datetime.utcnow()
            }
            if title:
                session_data["job_context"] = {"title": title}
    
            session = InterviewSession(**session_data)
            self.db_session.add(session)
            if self.is_async:
                await self.db_session.commit()
                await self.db_session.refresh(session)
            else:
&gt;               self.db_session.commit()

app/services/session_service.py:62: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py:1048: in _emit_insert_statements
    result = connection.execute(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0xffff734ab9d0&gt;, cursor = &lt;cursor object at 0xffff7218b790; closed: -1&gt;
statement = 'INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, ...e)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)'
parameters = {'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 6, 221620), 'id': UUID('46c32a7a-27cd-4b7f-82f4-50900c258b41'), 'job_context': '{"title": "Python Developer"}', ...}
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0xffff7054fc10&gt;

    def do_execute(self, cursor, statement, parameters, context=None):
&gt;       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (psycopg2.errors.ForeignKeyViolation) insert or update on table "interview_sessions" violates foreign key constraint "interview_sessions_user_id_fkey"
E       DETAIL:  Key (user_id)=(af759445-cea6-43b2-b457-f2f4476f09fa) is not present in table "users".
E       
E       [SQL: INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, status, total_questions, completed_questions, created_at, updated_at) VALUES (%(id)s::UUID, %(user_id)s::UUID, %(mode)s, %(role)s, %(job_description)s, %(scenario_id)s, %(question_source)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)]
E       [parameters: {'id': UUID('46c32a7a-27cd-4b7f-82f4-50900c258b41'), 'user_id': UUID('af759445-cea6-43b2-b457-f2f4476f09fa'), 'mode': 'interview', 'role': 'Python Developer', 'job_description': 'Looking for Python developer with Django experience', 'scenario_id': None, 'question_source': 'generated', 'job_context': '{"title": "Python Developer"}', 'status': 'active', 'total_questions': 0, 'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 6, 221620), 'updated_at': datetime.datetime(2026, 2, 13, 0, 45, 6, 221621)}]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

self = &lt;tests.e2e.test_complete_interview_flow.TestCompleteInterviewFlow object at 0xffff727796d0&gt;, client = &lt;starlette.testclient.TestClient object at 0xffff723e4410&gt;
sample_user = &lt;User(id=af759445-cea6-43b2-b457-f2f4476f09fa, email=test-2a60c8da@example.com, name=Test User)&gt;, mock_ai_client = &lt;AsyncMock id='281472474338512'&gt;
override_auth = &lt;function override_auth.&lt;locals&gt;._override at 0xffff729da520&gt;, override_ai_client = &lt;function override_ai_client.&lt;locals&gt;._override at 0xffff729dafc0&gt;

    @pytest.mark.e2e
    def test_data_consistency_across_operations(self, client, sample_user, mock_ai_client, override_auth, override_ai_client):
        """Test data consistency across multiple operations."""
        override_auth({"id": sample_user.id, "email": sample_user.email, "is_admin": False})
        override_ai_client(mock_ai_client)
    
        # Step 1: Create session
        session_data = {
            "user_id": str(sample_user.id),
            "mode": "interview",
            "role": "Python Developer",
            "job_title": "Python Developer",
            "job_description": "Looking for Python developer with Django experience"
        }
    
        # Create session
&gt;       create_response = client.post("/api/v1/sessions/", json=session_data)

tests/e2e/test_complete_interview_flow.py:346: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:546: in post
    return super().post(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:1132: in post
    return self.request(
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:445: in request
    return super().request(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:814: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
/usr/local/lib/python3.11/site-packages/httpx/_client.py:901: in send
    response = self._send_handling_auth(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:929: in _send_handling_auth
    response = self._send_handling_redirects(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:966: in _send_handling_redirects
    response = self._send_single_request(request)
/usr/local/lib/python3.11/site-packages/httpx/_client.py:1002: in _send_single_request
    response = transport.handle_request(request)
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:348: in handle_request
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:345: in handle_request
    portal.call(self.app, scope, receive, send)
/usr/local/lib/python3.11/site-packages/anyio/from_thread.py:334: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
/usr/local/lib/python3.11/concurrent/futures/_base.py:456: in result
    return self.__get_result()
/usr/local/lib/python3.11/concurrent/futures/_base.py:401: in __get_result
    raise self._exception
/usr/local/lib/python3.11/site-packages/anyio/from_thread.py:259: in _call_func
    retval = await retval_or_awaitable
/usr/local/lib/python3.11/site-packages/fastapi/applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/applications.py:107: in __call__
    await self.middleware_stack(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/rate_limiting_middleware.py:51: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
app/middleware/rate_limiting_middleware.py:40: in dispatch
    response = await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/main.py:179: in logging_middleware
    return await log_requests(request, call_next)
app/middleware/logging_middleware.py:29: in log_requests
    response = await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/security_middleware.py:23: in dispatch
    response = await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/file_upload_middleware.py:222: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/file_upload_middleware.py:139: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/file_upload_middleware.py:30: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py:87: in __call__
    await self.app(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:119: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:105: in app
    response = await f(request)
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:424: in app
    raw_response = await run_endpoint_function(
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:312: in run_endpoint_function
    return await dependant.call(**values)
app/routers/sessions.py:40: in create_session
    session = await session_service.create_interview_session(
app/services/session_service.py:136: in create_interview_session
    return await self.create_session(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;app.services.session_service.SessionService object at 0xffff713ad7d0&gt;, user_id = UUID('af759445-cea6-43b2-b457-f2f4476f09fa'), role = 'Python Developer'
job_description = 'Looking for Python developer with Django experience', title = 'Python Developer', mode = 'interview'

    async def create_session(
        self,
        user_id: Union[int, str],
        role: str,
        job_description: str,
        title: Optional[str] = None,
        mode: str = "interview"
    ) -&gt; InterviewSession:
        """Create a new interview session (works for both sync and async)."""
        try:
            session_data = {
                "id": uuid.uuid4(),
                "user_id": user_id,
                "role": role,
                "job_description": job_description or "",
                "mode": mode,
                "question_source": "generated",
                "status": "active",
                "created_at": datetime.utcnow(),
                "updated_at": datetime.utcnow()
            }
            if title:
                session_data["job_context"] = {"title": title}
    
            session = InterviewSession(**session_data)
            self.db_session.add(session)
            if self.is_async:
                await self.db_session.commit()
                await self.db_session.refresh(session)
            else:
                self.db_session.commit()
                self.db_session.refresh(session)
    
            logger.info(f"Created interview session {session.id} for user {user_id}")
            return session
    
        except Exception as e:
            if self.is_async:
                await self.db_session.rollback()
            else:
                self.db_session.rollback()
            logger.error(f"Error creating session: {e}")
&gt;           raise AIServiceError(f"Failed to create interview session: {e}")
E           app.exceptions.AIServiceError: Failed to create interview session: (psycopg2.errors.ForeignKeyViolation) insert or update on table "interview_sessions" violates foreign key constraint "interview_sessions_user_id_fkey"
E           DETAIL:  Key (user_id)=(af759445-cea6-43b2-b457-f2f4476f09fa) is not present in table "users".
E           
E           [SQL: INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, status, total_questions, completed_questions, created_at, updated_at) VALUES (%(id)s::UUID, %(user_id)s::UUID, %(mode)s, %(role)s, %(job_description)s, %(scenario_id)s, %(question_source)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)]
E           [parameters: {'id': UUID('46c32a7a-27cd-4b7f-82f4-50900c258b41'), 'user_id': UUID('af759445-cea6-43b2-b457-f2f4476f09fa'), 'mode': 'interview', 'role': 'Python Developer', 'job_description': 'Looking for Python developer with Django experience', 'scenario_id': None, 'question_source': 'generated', 'job_context': '{"title": "Python Developer"}', 'status': 'active', 'total_questions': 0, 'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 6, 221620), 'updated_at': datetime.datetime(2026, 2, 13, 0, 45, 6, 221621)}]
E           (Background on this error at: https://sqlalche.me/e/20/gkpj)

app/services/session_service.py:74: AIServiceError</failure></testcase><testcase classname="tests.e2e.test_complete_interview_flow.TestCompleteInterviewFlow" name="test_performance_under_load" time="0.194"><failure message="app.exceptions.AIServiceError: Failed to create interview session: (psycopg2.errors.ForeignKeyViolation) insert or update on table &quot;interview_sessions&quot; violates foreign key constraint &quot;interview_sessions_user_id_fkey&quot;&#10;DETAIL:  Key (user_id)=(e47da9c6-0e2a-4c32-84df-47982f25cf5d) is not present in table &quot;users&quot;.&#10;&#10;[SQL: INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, status, total_questions, completed_questions, created_at, updated_at) VALUES (%(id)s::UUID, %(user_id)s::UUID, %(mode)s, %(role)s, %(job_description)s, %(scenario_id)s, %(question_source)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)]&#10;[parameters: {'id': UUID('4e09a55b-ab07-4b1c-90dd-b3f113aaed0d'), 'user_id': UUID('e47da9c6-0e2a-4c32-84df-47982f25cf5d'), 'mode': 'interview', 'role': 'Python Developer', 'job_description': 'Looking for Python developer with Django experience', 'scenario_id': None, 'question_source': 'generated', 'job_context': '{&quot;title&quot;: &quot;Python Developer&quot;}', 'status': 'active', 'total_questions': 0, 'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 7, 416567), 'updated_at': datetime.datetime(2026, 2, 13, 0, 45, 7, 416569)}]&#10;(Background on this error at: https://sqlalche.me/e/20/gkpj)">self = &lt;sqlalchemy.engine.base.Connection object at 0xffff70867c90&gt;, dialect = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0xffff734ab9d0&gt;
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0xffff70867ed0&gt;, statement = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0xffff71fe8d10&gt;
parameters = [{'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 7, 416567), 'id': UUID('4e09a55b-ab07-4b1c-90dd-b3f113aaed0d'), 'job_context': '{"title": "Python Developer"}', ...}]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -&gt; CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
&gt;                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0xffff734ab9d0&gt;, cursor = &lt;cursor object at 0xffff71f5b010; closed: -1&gt;
statement = 'INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, ...e)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)'
parameters = {'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 7, 416567), 'id': UUID('4e09a55b-ab07-4b1c-90dd-b3f113aaed0d'), 'job_context': '{"title": "Python Developer"}', ...}
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0xffff70867ed0&gt;

    def do_execute(self, cursor, statement, parameters, context=None):
&gt;       cursor.execute(statement, parameters)
E       psycopg2.errors.ForeignKeyViolation: insert or update on table "interview_sessions" violates foreign key constraint "interview_sessions_user_id_fkey"
E       DETAIL:  Key (user_id)=(e47da9c6-0e2a-4c32-84df-47982f25cf5d) is not present in table "users".

/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py:952: ForeignKeyViolation

The above exception was the direct cause of the following exception:

self = &lt;app.services.session_service.SessionService object at 0xffff70800310&gt;, user_id = UUID('e47da9c6-0e2a-4c32-84df-47982f25cf5d'), role = 'Python Developer'
job_description = 'Looking for Python developer with Django experience', title = 'Python Developer', mode = 'interview'

    async def create_session(
        self,
        user_id: Union[int, str],
        role: str,
        job_description: str,
        title: Optional[str] = None,
        mode: str = "interview"
    ) -&gt; InterviewSession:
        """Create a new interview session (works for both sync and async)."""
        try:
            session_data = {
                "id": uuid.uuid4(),
                "user_id": user_id,
                "role": role,
                "job_description": job_description or "",
                "mode": mode,
                "question_source": "generated",
                "status": "active",
                "created_at": datetime.utcnow(),
                "updated_at": datetime.utcnow()
            }
            if title:
                session_data["job_context"] = {"title": title}
    
            session = InterviewSession(**session_data)
            self.db_session.add(session)
            if self.is_async:
                await self.db_session.commit()
                await self.db_session.refresh(session)
            else:
&gt;               self.db_session.commit()

app/services/session_service.py:62: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py:1048: in _emit_insert_statements
    result = connection.execute(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0xffff734ab9d0&gt;, cursor = &lt;cursor object at 0xffff71f5b010; closed: -1&gt;
statement = 'INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, ...e)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)'
parameters = {'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 7, 416567), 'id': UUID('4e09a55b-ab07-4b1c-90dd-b3f113aaed0d'), 'job_context': '{"title": "Python Developer"}', ...}
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0xffff70867ed0&gt;

    def do_execute(self, cursor, statement, parameters, context=None):
&gt;       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (psycopg2.errors.ForeignKeyViolation) insert or update on table "interview_sessions" violates foreign key constraint "interview_sessions_user_id_fkey"
E       DETAIL:  Key (user_id)=(e47da9c6-0e2a-4c32-84df-47982f25cf5d) is not present in table "users".
E       
E       [SQL: INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, status, total_questions, completed_questions, created_at, updated_at) VALUES (%(id)s::UUID, %(user_id)s::UUID, %(mode)s, %(role)s, %(job_description)s, %(scenario_id)s, %(question_source)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)]
E       [parameters: {'id': UUID('4e09a55b-ab07-4b1c-90dd-b3f113aaed0d'), 'user_id': UUID('e47da9c6-0e2a-4c32-84df-47982f25cf5d'), 'mode': 'interview', 'role': 'Python Developer', 'job_description': 'Looking for Python developer with Django experience', 'scenario_id': None, 'question_source': 'generated', 'job_context': '{"title": "Python Developer"}', 'status': 'active', 'total_questions': 0, 'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 7, 416567), 'updated_at': datetime.datetime(2026, 2, 13, 0, 45, 7, 416569)}]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

self = &lt;tests.e2e.test_complete_interview_flow.TestCompleteInterviewFlow object at 0xffff72779d10&gt;, client = &lt;starlette.testclient.TestClient object at 0xffff723e4410&gt;
sample_user = &lt;User(id=e47da9c6-0e2a-4c32-84df-47982f25cf5d, email=test-b4574b52@example.com, name=Test User)&gt;, mock_ai_client = &lt;AsyncMock id='281472475714832'&gt;
override_auth = &lt;function override_auth.&lt;locals&gt;._override at 0xffff70276340&gt;, override_ai_client = &lt;function override_ai_client.&lt;locals&gt;._override at 0xffff70275b20&gt;

    @pytest.mark.e2e
    def test_performance_under_load(self, client, sample_user, mock_ai_client, override_auth, override_ai_client):
        """Test system performance under multiple concurrent requests."""
        override_auth({"id": sample_user.id, "email": sample_user.email, "is_admin": False})
        override_ai_client(mock_ai_client)
    
        # Step 1: Create multiple sessions concurrently
        session_data = {
            "user_id": str(sample_user.id),
            "mode": "interview",
            "role": "Python Developer",
            "job_title": "Python Developer",
            "job_description": "Looking for Python developer with Django experience"
        }
    
        # Create 5 sessions
        sessions = []
        for i in range(5):
&gt;           create_response = client.post("/api/v1/sessions/", json=session_data)

tests/e2e/test_complete_interview_flow.py:404: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:546: in post
    return super().post(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:1132: in post
    return self.request(
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:445: in request
    return super().request(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:814: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
/usr/local/lib/python3.11/site-packages/httpx/_client.py:901: in send
    response = self._send_handling_auth(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:929: in _send_handling_auth
    response = self._send_handling_redirects(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:966: in _send_handling_redirects
    response = self._send_single_request(request)
/usr/local/lib/python3.11/site-packages/httpx/_client.py:1002: in _send_single_request
    response = transport.handle_request(request)
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:348: in handle_request
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:345: in handle_request
    portal.call(self.app, scope, receive, send)
/usr/local/lib/python3.11/site-packages/anyio/from_thread.py:334: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
/usr/local/lib/python3.11/concurrent/futures/_base.py:456: in result
    return self.__get_result()
/usr/local/lib/python3.11/concurrent/futures/_base.py:401: in __get_result
    raise self._exception
/usr/local/lib/python3.11/site-packages/anyio/from_thread.py:259: in _call_func
    retval = await retval_or_awaitable
/usr/local/lib/python3.11/site-packages/fastapi/applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/applications.py:107: in __call__
    await self.middleware_stack(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/rate_limiting_middleware.py:51: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
app/middleware/rate_limiting_middleware.py:40: in dispatch
    response = await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/main.py:179: in logging_middleware
    return await log_requests(request, call_next)
app/middleware/logging_middleware.py:29: in log_requests
    response = await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/security_middleware.py:23: in dispatch
    response = await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/file_upload_middleware.py:222: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/file_upload_middleware.py:139: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/file_upload_middleware.py:30: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py:87: in __call__
    await self.app(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:119: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:105: in app
    response = await f(request)
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:424: in app
    raw_response = await run_endpoint_function(
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:312: in run_endpoint_function
    return await dependant.call(**values)
app/routers/sessions.py:40: in create_session
    session = await session_service.create_interview_session(
app/services/session_service.py:136: in create_interview_session
    return await self.create_session(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;app.services.session_service.SessionService object at 0xffff70800310&gt;, user_id = UUID('e47da9c6-0e2a-4c32-84df-47982f25cf5d'), role = 'Python Developer'
job_description = 'Looking for Python developer with Django experience', title = 'Python Developer', mode = 'interview'

    async def create_session(
        self,
        user_id: Union[int, str],
        role: str,
        job_description: str,
        title: Optional[str] = None,
        mode: str = "interview"
    ) -&gt; InterviewSession:
        """Create a new interview session (works for both sync and async)."""
        try:
            session_data = {
                "id": uuid.uuid4(),
                "user_id": user_id,
                "role": role,
                "job_description": job_description or "",
                "mode": mode,
                "question_source": "generated",
                "status": "active",
                "created_at": datetime.utcnow(),
                "updated_at": datetime.utcnow()
            }
            if title:
                session_data["job_context"] = {"title": title}
    
            session = InterviewSession(**session_data)
            self.db_session.add(session)
            if self.is_async:
                await self.db_session.commit()
                await self.db_session.refresh(session)
            else:
                self.db_session.commit()
                self.db_session.refresh(session)
    
            logger.info(f"Created interview session {session.id} for user {user_id}")
            return session
    
        except Exception as e:
            if self.is_async:
                await self.db_session.rollback()
            else:
                self.db_session.rollback()
            logger.error(f"Error creating session: {e}")
&gt;           raise AIServiceError(f"Failed to create interview session: {e}")
E           app.exceptions.AIServiceError: Failed to create interview session: (psycopg2.errors.ForeignKeyViolation) insert or update on table "interview_sessions" violates foreign key constraint "interview_sessions_user_id_fkey"
E           DETAIL:  Key (user_id)=(e47da9c6-0e2a-4c32-84df-47982f25cf5d) is not present in table "users".
E           
E           [SQL: INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, status, total_questions, completed_questions, created_at, updated_at) VALUES (%(id)s::UUID, %(user_id)s::UUID, %(mode)s, %(role)s, %(job_description)s, %(scenario_id)s, %(question_source)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)]
E           [parameters: {'id': UUID('4e09a55b-ab07-4b1c-90dd-b3f113aaed0d'), 'user_id': UUID('e47da9c6-0e2a-4c32-84df-47982f25cf5d'), 'mode': 'interview', 'role': 'Python Developer', 'job_description': 'Looking for Python developer with Django experience', 'scenario_id': None, 'question_source': 'generated', 'job_context': '{"title": "Python Developer"}', 'status': 'active', 'total_questions': 0, 'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 7, 416567), 'updated_at': datetime.datetime(2026, 2, 13, 0, 45, 7, 416569)}]
E           (Background on this error at: https://sqlalche.me/e/20/gkpj)

app/services/session_service.py:74: AIServiceError</failure></testcase><testcase classname="tests.integration.test_admin_endpoints" name="test_admin_services_status_success" time="0.013" /><testcase classname="tests.integration.test_admin_endpoints" name="test_admin_services_status_no_ai_service" time="0.012" /><testcase classname="tests.integration.test_admin_endpoints" name="test_admin_services_test_success" time="0.010" /><testcase classname="tests.integration.test_admin_endpoints" name="test_admin_services_test_no_ai_service" time="0.011" /><testcase classname="tests.integration.test_admin_endpoints" name="test_admin_health_endpoint" time="0.009" /><testcase classname="tests.integration.test_admin_endpoints" name="test_admin_config_endpoint" time="0.010" /><testcase classname="tests.integration.test_admin_endpoints" name="test_admin_stats_endpoint" time="0.008" /><testcase classname="tests.integration.test_admin_endpoints" name="test_admin_services_status_exception_handling" time="0.011" /><testcase classname="tests.integration.test_admin_endpoints" name="test_admin_services_test_exception_handling" time="0.010" /><testcase classname="tests.integration.test_admin_endpoints" name="test_admin_config_exception_handling" time="0.007" /><testcase classname="tests.integration.test_admin_endpoints" name="test_admin_stats_exception_handling" time="0.008" /><testcase classname="tests.integration.test_admin_endpoints" name="test_admin_error_response_format" time="0.008" /><testcase classname="tests.integration.test_admin_endpoints" name="test_admin_endpoints_use_http_exceptions" time="0.031" /><testcase classname="tests.integration.test_answer_audio_file_persistence.TestAnswerAudioFilePersistenceIntegration" name="test_analyze_answer_with_audio_file_id" time="0.150"><failure message="assert 404 == 200&#10; +  where 404 = &lt;Response [404 Not Found]&gt;.status_code">self = &lt;tests.integration.test_answer_audio_file_persistence.TestAnswerAudioFilePersistenceIntegration object at 0xffff72784190&gt;, client = &lt;starlette.testclient.TestClient object at 0xffff6b99fcd0&gt;
db_session = &lt;sqlalchemy.orm.session.Session object at 0xffff706bf0d0&gt;, sample_user = &lt;User(id=72bd2283-2305-4214-9e4e-5567fc9e2084, email=test-72516f8c@example.com, name=Test User)&gt;
mock_current_user = {'email': 'test-72516f8c@example.com', 'id': '72bd2283-2305-4214-9e4e-5567fc9e2084'}
sample_question_with_session = (&lt;Question(id=0c9e0bd4-cf27-40d5-bb7b-0b7e225d7f56, category=python, difficulty=easy)&gt;, &lt;InterviewSession(id=d1ff8889-4a05-47f9-8854-a8296984bc70, user_id=72bd2283-2305-4214-9e4e-5567fc9e2084, role=Software Engineer, status=active)&gt;)
mock_ai_client = &lt;AsyncMock id='281472567129680'&gt;, override_auth = &lt;function override_auth.&lt;locals&gt;._override at 0xffff6bdc53a0&gt;
override_ai_client = &lt;function override_ai_client.&lt;locals&gt;._override at 0xffff6bdc58a0&gt;

    @pytest.mark.integration
    def test_analyze_answer_with_audio_file_id(
        self, client: TestClient, db_session: Session,
        sample_user, mock_current_user, sample_question_with_session, mock_ai_client,
        override_auth, override_ai_client
    ):
        """Test analyze_answer endpoint stores audio_file_id."""
        sample_question, session = sample_question_with_session
    
        override_auth(mock_current_user)
        override_ai_client(mock_ai_client)
    
        # Arrange
        audio_file_id = "test_audio_file_123"
        request_data = {
            "jobDescription": "Software Engineer position",
            "question": "What is your experience?",
            "answer": "I have 5 years of experience",
            "audio_file_id": audio_file_id
        }
    
        # Mock AI client response
        mock_ai_client.analyze_answer = AsyncMock(return_value={
            "analysis": "Good answer",
            "score": {"clarity": 8, "confidence": 7},
            "suggestions": []
        })
    
        # Act
        response = client.post(
            f"/api/v1/analyze-answer?question_id={sample_question.id}",
            json=request_data
        )
    
        # Assert
&gt;       assert response.status_code == 200
E       assert 404 == 200
E        +  where 404 = &lt;Response [404 Not Found]&gt;.status_code

tests/integration/test_answer_audio_file_persistence.py:85: AssertionError</failure></testcase><testcase classname="tests.integration.test_answer_audio_file_persistence.TestAnswerAudioFilePersistenceIntegration" name="test_analyze_answer_without_audio_file_id" time="0.127"><failure message="assert 500 == 200&#10; +  where 500 = &lt;Response [500 Internal Server Error]&gt;.status_code">self = &lt;tests.integration.test_answer_audio_file_persistence.TestAnswerAudioFilePersistenceIntegration object at 0xffff72785250&gt;, client = &lt;starlette.testclient.TestClient object at 0xffff6bf56d90&gt;
db_session = &lt;sqlalchemy.orm.session.Session object at 0xffff6adb6210&gt;, sample_user = &lt;User(id=b1b47cd6-7bb9-44e6-a053-4febb1748f29, email=test-3bf5c94a@example.com, name=Test User)&gt;
mock_current_user = {'email': 'test-3bf5c94a@example.com', 'id': 'b1b47cd6-7bb9-44e6-a053-4febb1748f29'}
sample_question_with_session = (&lt;Question(id=5c98f8ec-f129-4c9c-a524-9e1438c035e5, category=python, difficulty=easy)&gt;, &lt;InterviewSession(id=6e54e06a-a9c2-405f-a8c4-9ef62e2504a3, user_id=b1b47cd6-7bb9-44e6-a053-4febb1748f29, role=Software Engineer, status=active)&gt;)
mock_ai_client = &lt;AsyncMock id='281472490107856'&gt;, override_auth = &lt;function override_auth.&lt;locals&gt;._override at 0xffff6bdc6e80&gt;
override_ai_client = &lt;function override_ai_client.&lt;locals&gt;._override at 0xffff6bdc6a20&gt;

    @pytest.mark.integration
    def test_analyze_answer_without_audio_file_id(
        self, client: TestClient, db_session: Session,
        sample_user, mock_current_user, sample_question_with_session, mock_ai_client,
        override_auth, override_ai_client
    ):
        """Test analyze_answer endpoint works without audio_file_id (backward compatibility)."""
        sample_question, session = sample_question_with_session
    
        override_auth(mock_current_user)
        override_ai_client(mock_ai_client)
    
        # Arrange
        request_data = {
            "jobDescription": "Software Engineer position",
            "question": "What is your experience?",
            "answer": "I have 5 years of experience"
            # No audio_file_id
        }
    
        # Mock AI client response
        mock_ai_client.analyze_answer = AsyncMock(return_value={
            "analysis": "Good answer",
            "score": {"clarity": 8, "confidence": 7},
            "suggestions": []
        })
    
        # Act
        response = client.post(
            f"/api/v1/analyze-answer?question_id={sample_question.id}",
            json=request_data
        )
    
        # Assert
&gt;       assert response.status_code == 200
E       assert 500 == 200
E        +  where 500 = &lt;Response [500 Internal Server Error]&gt;.status_code

tests/integration/test_answer_audio_file_persistence.py:139: AssertionError</failure></testcase><testcase classname="tests.integration.test_answer_audio_file_persistence.TestAnswerAudioFilePersistenceIntegration" name="test_add_answer_to_question_with_audio_file_id" time="0.132"><failure message="fastapi.exceptions.ResponseValidationError: 2 validation errors:&#10;  {'type': 'string_type', 'loc': ('response', 'id'), 'msg': 'Input should be a valid string', 'input': UUID('f4545b3b-7261-401f-b6d3-0866720a31e7')}&#10;  {'type': 'string_type', 'loc': ('response', 'created_at'), 'msg': 'Input should be a valid string', 'input': datetime.datetime(2026, 2, 13, 0, 45, 8, 837487, tzinfo=datetime.timezone.utc)}&#10;&#10;  File &quot;/app/app/routers/sessions.py&quot;, line 115, in add_answer_to_question&#10;    POST /api/v1/sessions/questions/{question_id}/answers">+ Exception Group Traceback (most recent call last):
  |   File "/usr/local/lib/python3.11/site-packages/starlette/_utils.py", line 81, in collapse_excgroups
  |     yield
  |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 192, in __call__
  |     async with anyio.create_task_group() as task_group:
  |   File "/usr/local/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 783, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/usr/local/lib/python3.11/site-packages/_pytest/runner.py", line 341, in from_call
    |     result: Optional[TResult] = func()
    |                                 ^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/_pytest/runner.py", line 262, in &lt;lambda&gt;
    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise
    |             ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/_pytest/runner.py", line 177, in pytest_runtest_call
    |     raise e
    |   File "/usr/local/lib/python3.11/site-packages/_pytest/runner.py", line 169, in pytest_runtest_call
    |     item.runtest()
    |   File "/usr/local/lib/python3.11/site-packages/_pytest/python.py", line 1792, in runtest
    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/_pytest/python.py", line 194, in pytest_pyfunc_call
    |     result = testfunction(**testargs)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/tests/integration/test_answer_audio_file_persistence.py", line 177, in test_add_answer_to_question_with_audio_file_id
    |     response = client.post(
    |                ^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/testclient.py", line 546, in post
    |     return super().post(
    |            ^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1132, in post
    |     return self.request(
    |            ^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/testclient.py", line 445, in request
    |     return super().request(
    |            ^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 814, in request
    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 901, in send
    |     response = self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 929, in _send_handling_auth
    |     response = self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 966, in _send_handling_redirects
    |     response = self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1002, in _send_single_request
    |     response = transport.handle_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/testclient.py", line 348, in handle_request
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/testclient.py", line 345, in handle_request
    |     portal.call(self.app, scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/anyio/from_thread.py", line 334, in call
    |     return cast(T_Retval, self.start_task_soon(func, *args).result())
    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/concurrent/futures/_base.py", line 456, in result
    |     return self.__get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    |     raise self._exception
    |   File "/usr/local/lib/python3.11/site-packages/anyio/from_thread.py", line 259, in _call_func
    |     retval = await retval_or_awaitable
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1134, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 107, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 186, in __call__
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |   File "/usr/local/lib/python3.11/contextlib.py", line 158, in __exit__
    |     self.gen.throw(typ, value, traceback)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_utils.py", line 87, in collapse_excgroups
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/app/middleware/rate_limiting_middleware.py", line 51, in dispatch
    |     return await call_next(request)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/app/app/middleware/rate_limiting_middleware.py", line 40, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |   File "/usr/local/lib/python3.11/contextlib.py", line 158, in __exit__
    |     self.gen.throw(typ, value, traceback)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_utils.py", line 87, in collapse_excgroups
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/app/main.py", line 179, in logging_middleware
    |     return await log_requests(request, call_next)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/app/middleware/logging_middleware.py", line 29, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |   File "/usr/local/lib/python3.11/contextlib.py", line 158, in __exit__
    |     self.gen.throw(typ, value, traceback)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_utils.py", line 87, in collapse_excgroups
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/app/middleware/security_middleware.py", line 23, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |   File "/usr/local/lib/python3.11/contextlib.py", line 158, in __exit__
    |     self.gen.throw(typ, value, traceback)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_utils.py", line 87, in collapse_excgroups
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/app/middleware/file_upload_middleware.py", line 222, in dispatch
    |     return await call_next(request)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |   File "/usr/local/lib/python3.11/contextlib.py", line 158, in __exit__
    |     self.gen.throw(typ, value, traceback)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_utils.py", line 87, in collapse_excgroups
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/app/middleware/file_upload_middleware.py", line 139, in dispatch
    |     return await call_next(request)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |   File "/usr/local/lib/python3.11/contextlib.py", line 158, in __exit__
    |     self.gen.throw(typ, value, traceback)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_utils.py", line 87, in collapse_excgroups
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/app/middleware/file_upload_middleware.py", line 30, in dispatch
    |     return await call_next(request)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 87, in __call__
    |     await self.app(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 119, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 105, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 446, in app
    |     content = await serialize_response(
    |               ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 284, in serialize_response
    |     raise ResponseValidationError(
    | fastapi.exceptions.ResponseValidationError: 2 validation errors:
    |   {'type': 'string_type', 'loc': ('response', 'id'), 'msg': 'Input should be a valid string', 'input': UUID('f4545b3b-7261-401f-b6d3-0866720a31e7')}
    |   {'type': 'string_type', 'loc': ('response', 'created_at'), 'msg': 'Input should be a valid string', 'input': datetime.datetime(2026, 2, 13, 0, 45, 8, 837487, tzinfo=datetime.timezone.utc)}
    | 
    |   File "/app/app/routers/sessions.py", line 115, in add_answer_to_question
    |     POST /api/v1/sessions/questions/{question_id}/answers
    +------------------------------------

The above exception was the direct cause of the following exception:

self = &lt;tests.integration.test_answer_audio_file_persistence.TestAnswerAudioFilePersistenceIntegration object at 0xffff72785590&gt;, client = &lt;starlette.testclient.TestClient object at 0xffff6bf57d50&gt;
db_session = &lt;sqlalchemy.orm.session.Session object at 0xffff6adb4c50&gt;, sample_user = &lt;User(id=f962b62f-d9c4-4bb1-bd04-ef89dd5904fe, email=test-16ead9d9@example.com, name=Test User)&gt;
mock_current_user = {'email': 'test-16ead9d9@example.com', 'id': 'f962b62f-d9c4-4bb1-bd04-ef89dd5904fe'}
sample_question = &lt;Question(id=5b79415f-8e98-43b1-84cc-d5f989b4ec70, category=python, difficulty=easy)&gt;
sample_interview_session = &lt;InterviewSession(id=fc45ca35-ce03-4fc1-9f02-e7868e517809, user_id=f962b62f-d9c4-4bb1-bd04-ef89dd5904fe, role=Python Developer, status=active)&gt;
override_auth = &lt;function override_auth.&lt;locals&gt;._override at 0xffff71f4c2c0&gt;

    @pytest.mark.integration
    def test_add_answer_to_question_with_audio_file_id(
        self, client: TestClient, db_session: Session,
        sample_user, mock_current_user, sample_question, sample_interview_session,
        override_auth
    ):
        """Test add_answer_to_question endpoint stores audio_file_id."""
        override_auth(mock_current_user)
    
        # Arrange
        audio_file_id = "test_audio_file_456"
    
        # Create session question first
        from app.database.models import SessionQuestion
        session_question = SessionQuestion(
            session_id=sample_interview_session.id,
            question_id=sample_question.id,
            question_order=1
        )
        db_session.add(session_question)
        db_session.commit()
    
        request_data = {
            "answer_text": "I have extensive Python experience",
            "audio_file_id": audio_file_id
        }
    
        # Act
&gt;       response = client.post(
            f"/api/v1/sessions/questions/{sample_question.id}/answers",
            json=request_data
        )

tests/integration/test_answer_audio_file_persistence.py:177: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:546: in post
    return super().post(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:1132: in post
    return self.request(
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:445: in request
    return super().request(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:814: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
/usr/local/lib/python3.11/site-packages/httpx/_client.py:901: in send
    response = self._send_handling_auth(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:929: in _send_handling_auth
    response = self._send_handling_redirects(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:966: in _send_handling_redirects
    response = self._send_single_request(request)
/usr/local/lib/python3.11/site-packages/httpx/_client.py:1002: in _send_single_request
    response = transport.handle_request(request)
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:348: in handle_request
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:345: in handle_request
    portal.call(self.app, scope, receive, send)
/usr/local/lib/python3.11/site-packages/anyio/from_thread.py:334: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
/usr/local/lib/python3.11/concurrent/futures/_base.py:456: in result
    return self.__get_result()
/usr/local/lib/python3.11/concurrent/futures/_base.py:401: in __get_result
    raise self._exception
/usr/local/lib/python3.11/site-packages/anyio/from_thread.py:259: in _call_func
    retval = await retval_or_awaitable
/usr/local/lib/python3.11/site-packages/fastapi/applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/applications.py:107: in __call__
    await self.middleware_stack(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/rate_limiting_middleware.py:51: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
app/middleware/rate_limiting_middleware.py:40: in dispatch
    response = await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/main.py:179: in logging_middleware
    return await log_requests(request, call_next)
app/middleware/logging_middleware.py:29: in log_requests
    response = await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/security_middleware.py:23: in dispatch
    response = await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/file_upload_middleware.py:222: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/file_upload_middleware.py:139: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/file_upload_middleware.py:30: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py:87: in __call__
    await self.app(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:119: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:105: in app
    response = await f(request)
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:446: in app
    content = await serialize_response(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    async def serialize_response(
        *,
        field: ModelField | None = None,
        response_content: Any,
        include: IncEx | None = None,
        exclude: IncEx | None = None,
        by_alias: bool = True,
        exclude_unset: bool = False,
        exclude_defaults: bool = False,
        exclude_none: bool = False,
        is_coroutine: bool = True,
        endpoint_ctx: EndpointContext | None = None,
    ) -&gt; Any:
        if field:
            if is_coroutine:
                value, errors = field.validate(response_content, {}, loc=("response",))
            else:
                value, errors = await run_in_threadpool(
                    field.validate, response_content, {}, loc=("response",)
                )
            if errors:
                ctx = endpoint_ctx or EndpointContext()
&gt;               raise ResponseValidationError(
                    errors=errors,
                    body=response_content,
                    endpoint_ctx=ctx,
                )
E               fastapi.exceptions.ResponseValidationError: 2 validation errors:
E                 {'type': 'string_type', 'loc': ('response', 'id'), 'msg': 'Input should be a valid string', 'input': UUID('f4545b3b-7261-401f-b6d3-0866720a31e7')}
E                 {'type': 'string_type', 'loc': ('response', 'created_at'), 'msg': 'Input should be a valid string', 'input': datetime.datetime(2026, 2, 13, 0, 45, 8, 837487, tzinfo=datetime.timezone.utc)}
E               
E                 File "/app/app/routers/sessions.py", line 115, in add_answer_to_question
E                   POST /api/v1/sessions/questions/{question_id}/answers

/usr/local/lib/python3.11/site-packages/fastapi/routing.py:284: ResponseValidationError</failure></testcase><testcase classname="tests.integration.test_answer_audio_file_persistence.TestAnswerAudioFilePersistenceIntegration" name="test_get_question_answers_includes_audio_file_id" time="0.122"><failure message="assert 404 == 200&#10; +  where 404 = &lt;Response [404 Not Found]&gt;.status_code">self = &lt;tests.integration.test_answer_audio_file_persistence.TestAnswerAudioFilePersistenceIntegration object at 0xffff72785950&gt;, client = &lt;starlette.testclient.TestClient object at 0xffff6b518ed0&gt;
db_session = &lt;sqlalchemy.orm.session.Session object at 0xffff6bc1c390&gt;, sample_user = &lt;User(id=dd07a89b-d552-4625-9828-9141ce841fed, email=test-9b681c0c@example.com, name=Test User)&gt;
mock_current_user = {'email': 'test-9b681c0c@example.com', 'id': 'dd07a89b-d552-4625-9828-9141ce841fed'}
sample_question = &lt;Question(id=d17171f7-9a3b-44bb-8dbc-9b4417d55a02, category=python, difficulty=easy)&gt;
sample_interview_session = &lt;InterviewSession(id=d0b98b49-f3e8-432d-a829-5e40a8a4635e, user_id=dd07a89b-d552-4625-9828-9141ce841fed, role=Python Developer, status=active)&gt;
override_auth = &lt;function override_auth.&lt;locals&gt;._override at 0xffff6bf3cf40&gt;

    @pytest.mark.integration
    def test_get_question_answers_includes_audio_file_id(
        self, client: TestClient, db_session: Session,
        sample_user, mock_current_user, sample_question, sample_interview_session,
        override_auth
    ):
        """Test get_question_answers endpoint returns audio_file_id."""
        override_auth(mock_current_user)
    
        # Arrange
        audio_file_id = "test_audio_file_789"
    
        # Create answer with audio_file_id
        answer = Answer(
            question_id=sample_question.id,
            answer_text="Test answer",
            audio_file_id=audio_file_id
        )
        db_session.add(answer)
        db_session.commit()
    
        # Act
        response = client.get(
            f"/api/v1/sessions/questions/{sample_question.id}/answers"
        )
    
        # Assert
&gt;       assert response.status_code == 200
E       assert 404 == 200
E        +  where 404 = &lt;Response [404 Not Found]&gt;.status_code

tests/integration/test_answer_audio_file_persistence.py:225: AssertionError</failure></testcase><testcase classname="tests.integration.test_answer_audio_file_persistence.TestAnswerAudioFilePersistenceIntegration" name="test_deterministic_audio_file_id_persistence" time="0.142"><failure message="assert 404 == 200&#10; +  where 404 = &lt;Response [404 Not Found]&gt;.status_code">self = &lt;tests.integration.test_answer_audio_file_persistence.TestAnswerAudioFilePersistenceIntegration object at 0xffff72785d50&gt;, client = &lt;starlette.testclient.TestClient object at 0xffff71330bd0&gt;
db_session = &lt;sqlalchemy.orm.session.Session object at 0xffff71332610&gt;, sample_user = &lt;User(id=d42080ab-3731-409c-8b2e-5371bdc519d1, email=test-423be1aa@example.com, name=Test User)&gt;
mock_current_user = {'email': 'test-423be1aa@example.com', 'id': 'd42080ab-3731-409c-8b2e-5371bdc519d1'}
sample_question = &lt;Question(id=bb0b108b-b253-4176-85fe-42cfe81af4c4, category=python, difficulty=easy)&gt;
sample_interview_session = &lt;InterviewSession(id=be76198f-65d8-45a9-a3f4-bf1971a1bd5b, user_id=d42080ab-3731-409c-8b2e-5371bdc519d1, role=Python Developer, status=active)&gt;
mock_ai_client = &lt;AsyncMock id='281472474896272'&gt;, override_auth = &lt;function override_auth.&lt;locals&gt;._override at 0xffff6bf3e8e0&gt;
override_ai_client = &lt;function override_ai_client.&lt;locals&gt;._override at 0xffff6bf3e480&gt;

    @pytest.mark.integration
    def test_deterministic_audio_file_id_persistence(
        self, client: TestClient, db_session: Session,
        sample_user, mock_current_user, sample_question, sample_interview_session, mock_ai_client,
        override_auth, override_ai_client
    ):
        """Test that same question uses same audio file ID (deterministic)."""
        override_auth(mock_current_user)
        override_ai_client(mock_ai_client)
    
        # Arrange
        audio_file_id = "deterministic_audio_123"
    
        # Create session question
        from app.database.models import SessionQuestion
        session_question = SessionQuestion(
            session_id=sample_interview_session.id,
            question_id=sample_question.id,
            question_order=1
        )
        db_session.add(session_question)
        db_session.commit()
    
        # First answer with audio_file_id
        request_data = {
            "jobDescription": "Software Engineer",
            "question": "Test question",
            "answer": "First answer",
            "audio_file_id": audio_file_id
        }
    
        mock_ai_client.analyze_answer = AsyncMock(return_value={
            "analysis": "Good",
            "score": {"clarity": 8},
            "suggestions": []
        })
    
        # Act - Submit first answer
        response1 = client.post(
            f"/api/v1/analyze-answer?question_id={sample_question.id}",
            json=request_data
        )
    
&gt;       assert response1.status_code == 200
E       assert 404 == 200
E        +  where 404 = &lt;Response [404 Not Found]&gt;.status_code

tests/integration/test_answer_audio_file_persistence.py:274: AssertionError</failure></testcase><testcase classname="tests.integration.test_api_endpoints" name="test_health_endpoint_detailed" time="0.010" /><testcase classname="tests.integration.test_api_endpoints" name="test_ready_endpoint_detailed" time="0.007" /><testcase classname="tests.integration.test_api_endpoints" name="test_sessions_endpoints_require_auth" time="0.009" /><testcase classname="tests.integration.test_api_endpoints" name="test_interview_endpoints_require_auth" time="0.011" /><testcase classname="tests.integration.test_api_endpoints" name="test_admin_endpoints_exist" time="0.007" /><testcase classname="tests.integration.test_api_endpoints" name="test_api_documentation_accessible" time="0.466" /><testcase classname="tests.integration.test_auth" name="test_user_registration" time="0.011"><failure message="assert 400 == 201&#10; +  where 400 = &lt;Response [400 Bad Request]&gt;.status_code">client = &lt;starlette.testclient.TestClient object at 0xffff6bce9c50&gt;, db_session = &lt;sqlalchemy.orm.session.Session object at 0xffff6bceb050&gt;

    def test_user_registration(client: TestClient, db_session: Session):
        """Test user registration endpoint."""
        user_data = {
            "email": "register-test@example.com",
            "password": "TestPassword123",
            "name": "Test User"
        }
    
        response = client.post("/api/v1/auth/register", json=user_data)
    
&gt;       assert response.status_code == 201
E       assert 400 == 201
E        +  where 400 = &lt;Response [400 Bad Request]&gt;.status_code

tests/integration/test_auth.py:20: AssertionError</failure></testcase><testcase classname="tests.integration.test_auth" name="test_user_registration_duplicate_email" time="0.011"><failure message="assert 400 == 201&#10; +  where 400 = &lt;Response [400 Bad Request]&gt;.status_code">client = &lt;starlette.testclient.TestClient object at 0xffff723331d0&gt;, db_session = &lt;sqlalchemy.orm.session.Session object at 0xffff6bce9290&gt;

    def test_user_registration_duplicate_email(client: TestClient, db_session: Session):
        """Test user registration with duplicate email."""
        user_data = {
            "email": "duplicate-test@example.com",
            "password": "TestPassword123",
            "name": "Test User"
        }
    
        # Register first user
        response1 = client.post("/api/v1/auth/register", json=user_data)
&gt;       assert response1.status_code == 201
E       assert 400 == 201
E        +  where 400 = &lt;Response [400 Bad Request]&gt;.status_code

tests/integration/test_auth.py:39: AssertionError</failure></testcase><testcase classname="tests.integration.test_auth" name="test_user_registration_invalid_password" time="0.012" /><testcase classname="tests.integration.test_auth" name="test_user_login_success" time="0.012"><failure message="assert 400 == 201&#10; +  where 400 = &lt;Response [400 Bad Request]&gt;.status_code">client = &lt;starlette.testclient.TestClient object at 0xffff7047cd50&gt;, db_session = &lt;sqlalchemy.orm.session.Session object at 0xffff71ea4210&gt;

    def test_user_login_success(client: TestClient, db_session: Session):
        """Test successful user login."""
        # First register a user
        user_data = {
            "email": "login-test@example.com",
            "password": "TestPassword123",
            "name": "Test User"
        }
    
        register_response = client.post("/api/v1/auth/register", json=user_data)
&gt;       assert register_response.status_code == 201
E       assert 400 == 201
E        +  where 400 = &lt;Response [400 Bad Request]&gt;.status_code

tests/integration/test_auth.py:69: AssertionError</failure></testcase><testcase classname="tests.integration.test_auth" name="test_user_login_invalid_credentials" time="0.013" /><testcase classname="tests.integration.test_auth" name="test_password_change" time="0.011"><failure message="assert 400 == 201&#10; +  where 400 = &lt;Response [400 Bad Request]&gt;.status_code">client = &lt;starlette.testclient.TestClient object at 0xffff71e799d0&gt;, db_session = &lt;sqlalchemy.orm.session.Session object at 0xffff70105090&gt;

    def test_password_change(client: TestClient, db_session: Session):
        """Test password change functionality."""
        # First register and login
        user_data = {
            "email": "passchange-test@example.com",
            "password": "TestPassword123",
            "name": "Test User"
        }
    
        register_response = client.post("/api/v1/auth/register", json=user_data)
&gt;       assert register_response.status_code == 201
E       assert 400 == 201
E        +  where 400 = &lt;Response [400 Bad Request]&gt;.status_code

tests/integration/test_auth.py:109: AssertionError</failure></testcase><testcase classname="tests.integration.test_auth" name="test_get_current_user" time="0.011"><failure message="assert 400 == 201&#10; +  where 400 = &lt;Response [400 Bad Request]&gt;.status_code">client = &lt;starlette.testclient.TestClient object at 0xffff6b509f50&gt;, db_session = &lt;sqlalchemy.orm.session.Session object at 0xffff6b508e50&gt;

    def test_get_current_user(client: TestClient, db_session: Session):
        """Test getting current user information."""
        # First register and login
        user_data = {
            "email": "me-test@example.com",
            "password": "TestPassword123",
            "name": "Test User"
        }
    
        register_response = client.post("/api/v1/auth/register", json=user_data)
&gt;       assert register_response.status_code == 201
E       assert 400 == 201
E        +  where 400 = &lt;Response [400 Bad Request]&gt;.status_code

tests/integration/test_auth.py:142: AssertionError</failure></testcase><testcase classname="tests.integration.test_auth" name="test_get_current_user_no_token" time="0.010" /><testcase classname="tests.integration.test_auth" name="test_auth_status_authenticated" time="0.011"><failure message="assert 400 == 201&#10; +  where 400 = &lt;Response [400 Bad Request]&gt;.status_code">client = &lt;starlette.testclient.TestClient object at 0xffff6b925190&gt;, db_session = &lt;sqlalchemy.orm.session.Session object at 0xffff6b924ed0&gt;

    def test_auth_status_authenticated(client: TestClient, db_session: Session):
        """Test authentication status when authenticated."""
        # First register and login
        user_data = {
            "email": "status-test@example.com",
            "password": "TestPassword123",
            "name": "Test User"
        }
    
        register_response = client.post("/api/v1/auth/register", json=user_data)
&gt;       assert register_response.status_code == 201
E       assert 400 == 201
E        +  where 400 = &lt;Response [400 Bad Request]&gt;.status_code

tests/integration/test_auth.py:179: AssertionError</failure></testcase><testcase classname="tests.integration.test_auth" name="test_auth_status_not_authenticated" time="0.010"><failure message="assert 401 == 200&#10; +  where 401 = &lt;Response [401 Unauthorized]&gt;.status_code">client = &lt;starlette.testclient.TestClient object at 0xffff6bfa8a90&gt;, db_session = &lt;sqlalchemy.orm.session.Session object at 0xffff6bfaa450&gt;

    def test_auth_status_not_authenticated(client: TestClient, db_session: Session):
        """Test authentication status when not authenticated."""
        response = client.get("/api/v1/auth/status")
&gt;       assert response.status_code == 200
E       assert 401 == 200
E        +  where 401 = &lt;Response [401 Unauthorized]&gt;.status_code

tests/integration/test_auth.py:204: AssertionError</failure></testcase><testcase classname="tests.integration.test_auth" name="test_protected_endpoint_without_auth" time="0.010" /><testcase classname="tests.integration.test_auth" name="test_protected_endpoint_with_auth" time="0.011"><failure message="assert 400 == 201&#10; +  where 400 = &lt;Response [400 Bad Request]&gt;.status_code">client = &lt;starlette.testclient.TestClient object at 0xffff6b6d1d10&gt;, db_session = &lt;sqlalchemy.orm.session.Session object at 0xffff7081fb50&gt;

    def test_protected_endpoint_with_auth(client: TestClient, db_session: Session):
        """Test that protected endpoints work with authentication."""
        # First register and login
        user_data = {
            "email": "protected-test@example.com",
            "password": "TestPassword123",
            "name": "Test User"
        }
    
        register_response = client.post("/api/v1/auth/register", json=user_data)
&gt;       assert register_response.status_code == 201
E       assert 400 == 201
E        +  where 400 = &lt;Response [400 Bad Request]&gt;.status_code

tests/integration/test_auth.py:230: AssertionError</failure></testcase><testcase classname="tests.integration.test_auth" name="test_auth_service_password_hashing" time="0.701" /><testcase classname="tests.integration.test_auth" name="test_auth_service_token_creation" time="0.006" /><testcase classname="tests.integration.test_auth" name="test_auth_service_user_creation" time="0.240" /><testcase classname="tests.integration.test_dashboard_endpoints.TestDashboardEndpoints" name="test_get_dashboard_overview_success" time="0.125" /><testcase classname="tests.integration.test_dashboard_endpoints.TestDashboardEndpoints" name="test_get_dashboard_overview_unauthorized" time="0.115" /><testcase classname="tests.integration.test_dashboard_endpoints.TestDashboardEndpoints" name="test_get_dashboard_overview_admin_access" time="0.117" /><testcase classname="tests.integration.test_dashboard_endpoints.TestDashboardEndpoints" name="test_get_user_progress_success" time="0.116" /><testcase classname="tests.integration.test_dashboard_endpoints.TestDashboardEndpoints" name="test_get_analytics_data_success" time="0.118" /><testcase classname="tests.integration.test_dashboard_endpoints.TestDashboardEndpoints" name="test_get_performance_metrics_success" time="0.119" /><testcase classname="tests.integration.test_dashboard_endpoints.TestDashboardEndpoints" name="test_get_performance_trends_success" time="0.114" /><testcase classname="tests.integration.test_dashboard_endpoints.TestDashboardEndpoints" name="test_get_user_insights_success" time="0.112" /><testcase classname="tests.integration.test_dashboard_endpoints.TestDashboardEndpoints" name="test_dashboard_endpoints_require_auth" time="0.128" /><testcase classname="tests.integration.test_dashboard_endpoints.TestDashboardEndpoints" name="test_dashboard_endpoints_with_invalid_days" time="0.111" /><testcase classname="tests.integration.test_dashboard_endpoints.TestDashboardEndpoints" name="test_dashboard_endpoints_with_no_data" time="0.116" /><testcase classname="tests.integration.test_files_endpoints.TestFilesAPIEndpoints" name="test_upload_audio_file" time="0.111"><skipped type="pytest.skip" message="Authentication not available">/app/tests/integration/test_files_endpoints.py:66: Authentication not available</skipped></testcase><testcase classname="tests.integration.test_files_endpoints.TestFilesAPIEndpoints" name="test_download_file" time="0.116"><skipped type="pytest.skip" message="Authentication not available">/app/tests/integration/test_files_endpoints.py:97: Authentication not available</skipped></testcase><testcase classname="tests.integration.test_files_endpoints.TestFilesAPIEndpoints" name="test_get_file_info_with_metadata" time="0.110"><skipped type="pytest.skip" message="Authentication not available">/app/tests/integration/test_files_endpoints.py:125: Authentication not available</skipped></testcase><testcase classname="tests.integration.test_files_endpoints.TestFilesAPIEndpoints" name="test_list_audio_files" time="0.117"><skipped type="pytest.skip" message="Authentication not available">/app/tests/integration/test_files_endpoints.py:156: Authentication not available</skipped></testcase><testcase classname="tests.integration.test_files_endpoints.TestFilesAPIEndpoints" name="test_delete_file" time="0.132"><skipped type="pytest.skip" message="Authentication not available">/app/tests/integration/test_files_endpoints.py:184: Authentication not available</skipped></testcase><testcase classname="tests.integration.test_files_endpoints.TestFilesAPIVoicePersistence" name="test_save_retrieve_download_voice_file" time="0.005" /><testcase classname="tests.integration.test_files_endpoints.TestFilesAPIVoicePersistence" name="test_voice_file_metadata_persistence" time="0.004" /><testcase classname="tests.integration.test_interview_endpoints.TestInterviewEndpoints" name="test_parse_job_description_success" time="0.104" /><testcase classname="tests.integration.test_interview_endpoints.TestInterviewEndpoints" name="test_parse_job_description_missing_fields" time="0.009" /><testcase classname="tests.integration.test_interview_endpoints.TestInterviewEndpoints" name="test_parse_job_description_empty_fields" time="0.008" /><testcase classname="tests.integration.test_interview_endpoints.TestInterviewEndpoints" name="test_analyze_answer_success" time="0.157"><failure message="assert 500 == 200&#10; +  where 500 = &lt;Response [500 Internal Server Error]&gt;.status_code">self = &lt;tests.integration.test_interview_endpoints.TestInterviewEndpoints object at 0xffff727cbad0&gt;, client = &lt;starlette.testclient.TestClient object at 0xffff6bfd5cd0&gt;
sample_analyze_request = {'answer': 'Python is a high-level programming language known for its simplicity and readability.', 'jobDescription': 'Looking for a Python developer with 5+ years of experience.', 'question': 'What is Python?', 'service': 'openai'}
mock_ai_client = &lt;AsyncMock id='281472493508304'&gt;, override_auth = &lt;function override_auth.&lt;locals&gt;._override at 0xffff70523560&gt;
override_ai_client = &lt;function override_ai_client.&lt;locals&gt;._override at 0xffff705709a0&gt;, sample_user = &lt;User(id=d6fa2db9-67e0-4318-8bbe-904f6ac3b02b, email=test-07163d10@example.com, name=Test User)&gt;
sample_interview_session = &lt;InterviewSession(id=d6632a13-c9ea-4c4d-b9a2-7089f9dc7ac9, user_id=d6fa2db9-67e0-4318-8bbe-904f6ac3b02b, role=Python Developer, status=active)&gt;
sample_session_question = &lt;SessionQuestion(id=d3b34f3a-4db9-431d-ab58-402c6cc4d21f, session_id=d6632a13-c9ea-4c4d-b9a2-7089f9dc7ac9, question_id=17d87d26-bac0-41e9-a567-f9a88f3c4e5c, order=1)&gt;
sample_question = &lt;Question(id=17d87d26-bac0-41e9-a567-f9a88f3c4e5c, category=python, difficulty=easy)&gt;

    @pytest.mark.integration
    def test_analyze_answer_success(
        self, client, sample_analyze_request, mock_ai_client, override_auth, override_ai_client,
        sample_user, sample_interview_session, sample_session_question, sample_question
    ):
        """Test successful answer analysis.
    
        Requires full session setup: sample_question linked to sample_interview_session
        for the user. The analyze endpoint validates question access via DB.
        """
        # Arrange
        override_auth({"id": sample_user.id, "email": sample_user.email, "is_admin": False})
        override_ai_client(mock_ai_client)
        # Act
        response = client.post(
            f"/api/v1/analyze-answer?question_id={sample_question.id}",
            json=sample_analyze_request
        )
        # Assert
&gt;       assert response.status_code == 200
E       assert 500 == 200
E        +  where 500 = &lt;Response [500 Internal Server Error]&gt;.status_code

tests/integration/test_interview_endpoints.py:79: AssertionError</failure></testcase><testcase classname="tests.integration.test_interview_endpoints.TestInterviewEndpoints" name="test_analyze_answer_missing_fields" time="0.027" /><testcase classname="tests.integration.test_interview_endpoints.TestInterviewEndpoints" name="test_analyze_answer_empty_answer" time="0.011" /><testcase classname="tests.integration.test_interview_endpoints.TestInterviewEndpoints" name="test_health_check" time="0.016" /><testcase classname="tests.integration.test_interview_endpoints.TestInterviewEndpoints" name="test_parse_job_description_with_preferred_service" time="0.098" /><testcase classname="tests.integration.test_interview_endpoints.TestInterviewEndpoints" name="test_analyze_answer_with_preferred_service" time="0.147"><failure message="assert 500 == 200&#10; +  where 500 = &lt;Response [500 Internal Server Error]&gt;.status_code">self = &lt;tests.integration.test_interview_endpoints.TestInterviewEndpoints object at 0xffff727c3750&gt;, client = &lt;starlette.testclient.TestClient object at 0xffff7086ef50&gt;
sample_analyze_request = {'answer': 'Python is a high-level programming language known for its simplicity and readability.', 'jobDescription': ... a Python developer with 5+ years of experience.', 'preferredService': 'anthropic', 'question': 'What is Python?', ...}
mock_ai_client = &lt;AsyncMock id='281472569630160'&gt;, override_auth = &lt;function override_auth.&lt;locals&gt;._override at 0xffff7059cb80&gt;
override_ai_client = &lt;function override_ai_client.&lt;locals&gt;._override at 0xffff7059d300&gt;, sample_user = &lt;User(id=d7e462fc-2fe2-4d3b-af52-8ecfaac8a43a, email=test-7c509ebf@example.com, name=Test User)&gt;
sample_question = &lt;Question(id=0e1a89c9-3870-489a-bfce-048ea60e87f6, category=python, difficulty=easy)&gt;
sample_interview_session = &lt;InterviewSession(id=6cb729c2-bbaa-449b-86ec-7b0ad67845cf, user_id=d7e462fc-2fe2-4d3b-af52-8ecfaac8a43a, role=Python Developer, status=active)&gt;
sample_session_question = &lt;SessionQuestion(id=e92d77ed-727d-4053-9732-4c9a472ec1c9, session_id=6cb729c2-bbaa-449b-86ec-7b0ad67845cf, question_id=0e1a89c9-3870-489a-bfce-048ea60e87f6, order=1)&gt;

    @pytest.mark.integration
    def test_analyze_answer_with_preferred_service(
        self, client, sample_analyze_request, mock_ai_client, override_auth, override_ai_client,
        sample_user, sample_question, sample_interview_session, sample_session_question
    ):
        """Test answer analysis with preferred service."""
        # Arrange
        override_auth({"id": sample_user.id, "email": sample_user.email, "is_admin": False})
        override_ai_client(mock_ai_client)
        sample_analyze_request["preferredService"] = "anthropic"
        # Act
        response = client.post(
            f"/api/v1/analyze-answer?question_id={sample_question.id}",
            json=sample_analyze_request
        )
        # Assert
&gt;       assert response.status_code == 200
E       assert 500 == 200
E        +  where 500 = &lt;Response [500 Internal Server Error]&gt;.status_code

tests/integration/test_interview_endpoints.py:166: AssertionError</failure></testcase><testcase classname="tests.integration.test_interview_endpoints.TestInterviewEndpoints" name="test_parse_job_description_large_input" time="0.096" /><testcase classname="tests.integration.test_interview_endpoints.TestInterviewEndpoints" name="test_analyze_answer_large_input" time="0.129"><failure message="assert 500 == 200&#10; +  where 500 = &lt;Response [500 Internal Server Error]&gt;.status_code">self = &lt;tests.integration.test_interview_endpoints.TestInterviewEndpoints object at 0xffff727d9dd0&gt;, client = &lt;starlette.testclient.TestClient object at 0xffff71f5fe50&gt;
mock_ai_client = &lt;AsyncMock id='281472570901904'&gt;, override_auth = &lt;function override_auth.&lt;locals&gt;._override at 0xffff7059c4a0&gt;
override_ai_client = &lt;function override_ai_client.&lt;locals&gt;._override at 0xffff7059c400&gt;, sample_user = &lt;User(id=032a7fb2-d29b-4823-853f-2f492b8dedb3, email=test-f45deb83@example.com, name=Test User)&gt;
sample_question = &lt;Question(id=50f04ddc-1fe2-4501-ae59-929dae4cb1d7, category=python, difficulty=easy)&gt;
sample_interview_session = &lt;InterviewSession(id=d79e8464-8eef-4321-aaa7-f92079715e5f, user_id=032a7fb2-d29b-4823-853f-2f492b8dedb3, role=Python Developer, status=active)&gt;
sample_session_question = &lt;SessionQuestion(id=6be6fd8b-e9d3-45c3-8e53-587c6900fc5e, session_id=d79e8464-8eef-4321-aaa7-f92079715e5f, question_id=50f04ddc-1fe2-4501-ae59-929dae4cb1d7, order=1)&gt;

    @pytest.mark.integration
    def test_analyze_answer_large_input(
        self, client, mock_ai_client, override_auth, override_ai_client,
        sample_user, sample_question, sample_interview_session, sample_session_question
    ):
        """Test answer analysis with large input."""
        # Arrange
        override_auth({"id": sample_user.id, "email": sample_user.email, "is_admin": False})
        override_ai_client(mock_ai_client)
        large_request = {
            "jobDescription": "We are looking for a Senior Python Developer with extensive experience.",
            "question": "What is your experience with Python web frameworks?",
            "answer": "I have extensive experience with Python web frameworks including Django, Flask, FastAPI, and Pyramid. I've worked on large-scale applications with millions of users, implemented complex business logic, optimized database queries, and designed RESTful APIs. " * 5  # Large answer
        }
        # Act
        response = client.post(
            f"/api/v1/analyze-answer?question_id={sample_question.id}",
            json=large_request
        )
        # Assert
&gt;       assert response.status_code == 200
E       assert 500 == 200
E        +  where 500 = &lt;Response [500 Internal Server Error]&gt;.status_code

tests/integration/test_interview_endpoints.py:209: AssertionError</failure></testcase><testcase classname="tests.integration.test_interview_endpoints.TestInterviewEndpoints" name="test_parse_job_description_special_characters" time="0.083" /><testcase classname="tests.integration.test_interview_endpoints.TestInterviewEndpoints" name="test_analyze_answer_special_characters" time="0.126"><failure message="assert 500 == 200&#10; +  where 500 = &lt;Response [500 Internal Server Error]&gt;.status_code">self = &lt;tests.integration.test_interview_endpoints.TestInterviewEndpoints object at 0xffff727da450&gt;, client = &lt;starlette.testclient.TestClient object at 0xffff7052efd0&gt;
mock_ai_client = &lt;AsyncMock id='281472566228560'&gt;, override_auth = &lt;function override_auth.&lt;locals&gt;._override at 0xffff7059fd80&gt;
override_ai_client = &lt;function override_ai_client.&lt;locals&gt;._override at 0xffff7059cf40&gt;, sample_user = &lt;User(id=74474579-fe88-4597-8d3b-56b4090695fb, email=test-184a3f28@example.com, name=Test User)&gt;
sample_question = &lt;Question(id=547ea36e-16b5-4a95-bb2f-5c88071ff575, category=python, difficulty=easy)&gt;
sample_interview_session = &lt;InterviewSession(id=204e1856-72ea-480d-97c3-601359190e3a, user_id=74474579-fe88-4597-8d3b-56b4090695fb, role=Python Developer, status=active)&gt;
sample_session_question = &lt;SessionQuestion(id=0f420092-4dc6-4a5a-8c20-bfda1e561605, session_id=204e1856-72ea-480d-97c3-601359190e3a, question_id=547ea36e-16b5-4a95-bb2f-5c88071ff575, order=1)&gt;

    @pytest.mark.integration
    def test_analyze_answer_special_characters(
        self, client, mock_ai_client, override_auth, override_ai_client,
        sample_user, sample_question, sample_interview_session, sample_session_question
    ):
        """Test answer analysis with special characters."""
        # Arrange
        override_auth({"id": sample_user.id, "email": sample_user.email, "is_admin": False})
        override_ai_client(mock_ai_client)
        special_request = {
            "jobDescription": "We're looking for a Python Developer with 5+ years of experience.",
            "question": "What's your experience with Python web frameworks?",
            "answer": "I've worked with Django, Flask, and FastAPI. I've built APIs that handle 10k+ requests/second and used PostgreSQL, Redis, and Docker. I'm familiar with AWS services like EC2, S3, and RDS."
        }
        # Act
        response = client.post(
            f"/api/v1/analyze-answer?question_id={sample_question.id}",
            json=special_request
        )
        # Assert
&gt;       assert response.status_code == 200
E       assert 500 == 200
E        +  where 500 = &lt;Response [500 Internal Server Error]&gt;.status_code

tests/integration/test_interview_endpoints.py:252: AssertionError</failure></testcase><testcase classname="tests.integration.test_interview_endpoints.TestInterviewEndpoints" name="test_parse_job_description_unicode" time="0.086" /><testcase classname="tests.integration.test_interview_endpoints.TestInterviewEndpoints" name="test_analyze_answer_unicode" time="0.125"><failure message="assert 500 == 200&#10; +  where 500 = &lt;Response [500 Internal Server Error]&gt;.status_code">self = &lt;tests.integration.test_interview_endpoints.TestInterviewEndpoints object at 0xffff727db090&gt;, client = &lt;starlette.testclient.TestClient object at 0xffff720294d0&gt;
mock_ai_client = &lt;AsyncMock id='281472568196240'&gt;, override_auth = &lt;function override_auth.&lt;locals&gt;._override at 0xffff7059c540&gt;
override_ai_client = &lt;function override_ai_client.&lt;locals&gt;._override at 0xffff7063eb60&gt;, sample_user = &lt;User(id=99ed266d-1251-4310-9acd-3e5ee39e8e54, email=test-22c8c366@example.com, name=Test User)&gt;
sample_question = &lt;Question(id=b12f7f5c-2811-427f-9d32-952a11601acf, category=python, difficulty=easy)&gt;
sample_interview_session = &lt;InterviewSession(id=d8564b96-b700-4755-9aed-2497bfa7c987, user_id=99ed266d-1251-4310-9acd-3e5ee39e8e54, role=Python Developer, status=active)&gt;
sample_session_question = &lt;SessionQuestion(id=cdff5627-e81c-4028-b6d3-108745649513, session_id=d8564b96-b700-4755-9aed-2497bfa7c987, question_id=b12f7f5c-2811-427f-9d32-952a11601acf, order=1)&gt;

    @pytest.mark.integration
    def test_analyze_answer_unicode(
        self, client, mock_ai_client, override_auth, override_ai_client,
        sample_user, sample_question, sample_interview_session, sample_session_question
    ):
        """Test answer analysis with unicode characters."""
        # Arrange
        override_auth({"id": sample_user.id, "email": sample_user.email, "is_admin": False})
        override_ai_client(mock_ai_client)
        unicode_request = {
            "jobDescription": "We're looking for a Python Developer with experience in web development.",
            "question": "What's your experience with Python web frameworks?",
            "answer": "I have 5 years of experience with Django and Flask. I've built several web applications and APIs. I'm passionate about clean code and best practices! #x1F4BB"
        }
        # Act
        response = client.post(
            f"/api/v1/analyze-answer?question_id={sample_question.id}",
            json=unicode_request
        )
        # Assert
&gt;       assert response.status_code == 200
E       assert 500 == 200
E        +  where 500 = &lt;Response [500 Internal Server Error]&gt;.status_code

tests/integration/test_interview_endpoints.py:295: AssertionError</failure></testcase><testcase classname="tests.integration.test_interview_endpoints.TestInterviewEndpoints" name="test_parse_job_description_malformed_json" time="0.008" /><testcase classname="tests.integration.test_interview_endpoints.TestInterviewEndpoints" name="test_analyze_answer_malformed_json" time="0.011" /><testcase classname="tests.integration.test_interview_endpoints.TestInterviewEndpoints" name="test_parse_job_description_wrong_content_type" time="0.010" /><testcase classname="tests.integration.test_interview_endpoints.TestInterviewEndpoints" name="test_analyze_answer_wrong_content_type" time="0.012" /><testcase classname="tests.integration.test_interview_endpoints.TestInterviewEndpoints" name="test_parse_job_description_ai_service_error" time="0.019" /><testcase classname="tests.integration.test_interview_endpoints.TestInterviewEndpoints" name="test_analyze_answer_ai_service_error" time="0.128"><failure message="assert 404 == 500&#10; +  where 404 = &lt;Response [404 Not Found]&gt;.status_code">self = &lt;tests.integration.test_interview_endpoints.TestInterviewEndpoints object at 0xffff727ed9d0&gt;, client = &lt;starlette.testclient.TestClient object at 0xffff705dd4d0&gt;
sample_analyze_request = {'answer': 'Python is a high-level programming language known for its simplicity and readability.', 'jobDescription': 'Looking for a Python developer with 5+ years of experience.', 'question': 'What is Python?', 'service': 'openai'}
override_auth = &lt;function override_auth.&lt;locals&gt;._override at 0xffff7063e480&gt;, override_ai_client = &lt;function override_ai_client.&lt;locals&gt;._override at 0xffff7063eca0&gt;
sample_user = &lt;User(id=13703c30-6f7c-4825-863d-fd88e04775ba, email=test-fdce6898@example.com, name=Test User)&gt;
sample_question = &lt;Question(id=651c6882-d2c4-4695-9734-16781cfa81c9, category=python, difficulty=easy)&gt;
sample_interview_session = &lt;InterviewSession(id=fcf1beff-aec7-40ed-8758-cb9dc1cd4254, user_id=13703c30-6f7c-4825-863d-fd88e04775ba, role=Python Developer, status=active)&gt;
sample_session_question = &lt;SessionQuestion(id=a7b3d8ea-a331-4713-aaac-7ddd3b842c4a, session_id=fcf1beff-aec7-40ed-8758-cb9dc1cd4254, question_id=651c6882-d2c4-4695-9734-16781cfa81c9, order=1)&gt;

    @pytest.mark.integration
    def test_analyze_answer_ai_service_error(
        self, client, sample_analyze_request, override_auth, override_ai_client,
        sample_user, sample_question, sample_interview_session, sample_session_question
    ):
        """Test answer analysis when AI service fails."""
        # Arrange
        mock_ai_client = AsyncMock()
        mock_ai_client.analyze_answer = AsyncMock(side_effect=Exception("AI service error"))
        override_auth({"id": sample_user.id, "email": sample_user.email, "is_admin": False})
        override_ai_client(mock_ai_client)
        # Act
        response = client.post(
            f"/api/v1/analyze-answer?question_id={sample_question.id}",
            json=sample_analyze_request
        )
        # Assert
&gt;       assert response.status_code == 500
E       assert 404 == 500
E        +  where 404 = &lt;Response [404 Not Found]&gt;.status_code

tests/integration/test_interview_endpoints.py:399: AssertionError</failure></testcase><testcase classname="tests.integration.test_interview_endpoints.TestInterviewEndpoints" name="test_get_services_ai_service_error" time="0.008" /><testcase classname="tests.integration.test_question_bank_endpoints.TestQuestionBankEndpoints" name="test_create_question_success" time="0.116"><failure message="assert 500 == 201&#10; +  where 500 = &lt;Response [500 Internal Server Error]&gt;.status_code">self = &lt;tests.integration.test_question_bank_endpoints.TestQuestionBankEndpoints object at 0xffff727eda10&gt;, client = &lt;starlette.testclient.TestClient object at 0xffff71d47810&gt;
admin_user = &lt;User(id=1f470152-6c45-4720-befc-3234c41b23dd, email=admin-ec9eaf6e@example.com, name=Admin User)&gt;
override_admin_auth = &lt;function override_admin_auth.&lt;locals&gt;._override at 0xffff702a8860&gt;, db_session = &lt;sqlalchemy.orm.session.Session object at 0xffff71d45250&gt;

    @pytest.mark.integration
    def test_create_question_success(self, client, admin_user, override_admin_auth, db_session):
        """Test successful question creation."""
        override_admin_auth({"id": admin_user.id, "email": admin_user.email, "is_admin": True, "role": "admin"})
        question_data = {
            "question_text": "What is Python?",
            "category": "technical",
            "difficulty_level": "medium",
            "compatible_roles": ["Python Developer"],
            "required_skills": ["Python"],
            "industry_tags": ["tech"]
        }
    
        response = client.post("/api/v1/questions", json=question_data)
    
&gt;       assert response.status_code == 201
E       assert 500 == 201
E        +  where 500 = &lt;Response [500 Internal Server Error]&gt;.status_code

tests/integration/test_question_bank_endpoints.py:31: AssertionError</failure></testcase><testcase classname="tests.integration.test_question_bank_endpoints.TestQuestionBankEndpoints" name="test_create_question_unauthorized" time="0.009" /><testcase classname="tests.integration.test_question_bank_endpoints.TestQuestionBankEndpoints" name="test_create_question_duplicate" time="0.118"><failure message="assert 500 == 201&#10; +  where 500 = &lt;Response [500 Internal Server Error]&gt;.status_code">self = &lt;tests.integration.test_question_bank_endpoints.TestQuestionBankEndpoints object at 0xffff727f4310&gt;, client = &lt;starlette.testclient.TestClient object at 0xffff703dced0&gt;
admin_user = &lt;User(id=708277cb-164f-4f3b-852c-9fbf9d1de791, email=admin-fbad1b1f@example.com, name=Admin User)&gt;
override_admin_auth = &lt;function override_admin_auth.&lt;locals&gt;._override at 0xffff702a8ae0&gt;, db_session = &lt;sqlalchemy.orm.session.Session object at 0xffff703303d0&gt;

    @pytest.mark.integration
    def test_create_question_duplicate(self, client, admin_user, override_admin_auth, db_session):
        """Test creating duplicate question."""
        override_admin_auth({"id": admin_user.id, "email": admin_user.email, "is_admin": True, "role": "admin"})
        question_data = {
            "question_text": "What is Python?",
            "category": "technical"
        }
    
        # Create first question
        response1 = client.post("/api/v1/questions", json=question_data)
&gt;       assert response1.status_code == 201
E       assert 500 == 201
E        +  where 500 = &lt;Response [500 Internal Server Error]&gt;.status_code

tests/integration/test_question_bank_endpoints.py:61: AssertionError</failure></testcase><testcase classname="tests.integration.test_question_bank_endpoints.TestQuestionBankEndpoints" name="test_get_questions" time="0.013" /><testcase classname="tests.integration.test_question_bank_endpoints.TestQuestionBankEndpoints" name="test_get_questions_with_filters" time="0.011" /><testcase classname="tests.integration.test_question_bank_endpoints.TestQuestionBankEndpoints" name="test_get_question_by_id" time="0.014" /><testcase classname="tests.integration.test_question_bank_endpoints.TestQuestionBankEndpoints" name="test_get_question_not_found" time="0.010" /><testcase classname="tests.integration.test_question_bank_endpoints.TestQuestionBankEndpoints" name="test_update_question" time="0.121" /><testcase classname="tests.integration.test_question_bank_endpoints.TestQuestionBankEndpoints" name="test_delete_question" time="0.121" /><testcase classname="tests.integration.test_question_bank_endpoints.TestQuestionBankEndpoints" name="test_search_questions" time="0.015" /><testcase classname="tests.integration.test_question_bank_endpoints.TestQuestionBankEndpoints" name="test_get_question_suggestions" time="0.015" /><testcase classname="tests.integration.test_question_bank_endpoints.TestQuestionBankEndpoints" name="test_get_question_performance" time="0.013" /><testcase classname="tests.integration.test_question_bank_endpoints.TestQuestionBankEndpoints" name="test_get_usage_stats" time="0.015" /><testcase classname="tests.integration.test_question_bank_endpoints.TestQuestionBankEndpoints" name="test_get_system_overview" time="0.025" /><testcase classname="tests.integration.test_question_bank_endpoints.TestQuestionBankEndpoints" name="test_bulk_import_questions" time="0.117" /><testcase classname="tests.integration.test_question_bank_endpoints.TestQuestionBankEndpoints" name="test_quality_check" time="0.117" /><testcase classname="tests.integration.test_scoring_conversion.TestScoreConversion" name="test_convert_legacy_scores_to_100_point" time="0.001" /><testcase classname="tests.integration.test_scoring_conversion.TestScoreConversion" name="test_convert_with_enhanced_rubric" time="0.000" /><testcase classname="tests.integration.test_scoring_conversion.TestScoreConversion" name="test_convert_without_enhanced_rubric_fallback" time="0.000" /><testcase classname="tests.integration.test_scoring_conversion.TestScoreConversion" name="test_convert_zero_scores" time="0.000" /><testcase classname="tests.integration.test_scoring_conversion.TestLegacyToEnhancedConversion" name="test_create_rubric_from_high_scores" time="0.000" /><testcase classname="tests.integration.test_scoring_conversion.TestLegacyToEnhancedConversion" name="test_create_rubric_from_low_scores" time="0.000" /><testcase classname="tests.integration.test_scoring_conversion.TestLegacyToEnhancedConversion" name="test_create_rubric_category_limits" time="0.001" /><testcase classname="tests.integration.test_scoring_conversion.TestEnhancedRubricParsing" name="test_parse_rubric_from_response" time="0.000" /><testcase classname="tests.integration.test_scoring_conversion.TestEnhancedRubricParsing" name="test_parse_rubric_missing_data" time="0.000" /><testcase classname="tests.integration.test_scoring_endpoints.TestScoringAnalyzeEndpoint" name="test_analyze_answer_success" time="0.014" /><testcase classname="tests.integration.test_scoring_endpoints.TestScoringAnalyzeEndpoint" name="test_analyze_answer_with_enhanced_rubric" time="0.055" /><testcase classname="tests.integration.test_scoring_endpoints.TestScoringAnalyzeEndpoint" name="test_analyze_answer_ai_service_unavailable" time="0.016" /><testcase classname="tests.integration.test_scoring_endpoints.TestScoringAnalyzeEndpoint" name="test_analyze_answer_ai_service_error" time="0.013" /><testcase classname="tests.integration.test_scoring_endpoints.TestScoringAnalyzeEndpoint" name="test_analyze_answer_unauthorized" time="0.011"><failure message="assert (500 == 401 or 500 == 403)&#10; +  where 500 = &lt;Response [500 Internal Server Error]&gt;.status_code&#10; +  and   500 = &lt;Response [500 Internal Server Error]&gt;.status_code">self = &lt;tests.integration.test_scoring_endpoints.TestScoringAnalyzeEndpoint object at 0xffff72619b50&gt;, client = &lt;starlette.testclient.TestClient object at 0xffff708dee50&gt;
sample_analysis_request = {'job_description': 'We are looking for a Python developer with experience in web frameworks.', 'question': 'What is P...icity and readability. It's widely used in web development, data science, and automation.", 'role': 'Python Developer'}

    @pytest.mark.integration
    @pytest.mark.ai
    def test_analyze_answer_unauthorized(self, client, sample_analysis_request):
        """Test analysis endpoint without authentication."""
        response = client.post(
            "/api/v1/scoring/analyze",
            json=sample_analysis_request
        )
    
&gt;       assert response.status_code == 401 or response.status_code == 403
E       assert (500 == 401 or 500 == 403)
E        +  where 500 = &lt;Response [500 Internal Server Error]&gt;.status_code
E        +  and   500 = &lt;Response [500 Internal Server Error]&gt;.status_code

tests/integration/test_scoring_endpoints.py:250: AssertionError</failure></testcase><testcase classname="tests.integration.test_scoring_endpoints.TestScoringAnalyzeEndpoint" name="test_analyze_answer_validation_error" time="0.012" /><testcase classname="tests.integration.test_scoring_endpoints.TestScoringStatusEndpoint" name="test_get_scoring_status" time="0.010" /><testcase classname="tests.integration.test_scoring_endpoints.TestScoringAgentsEndpoint" name="test_list_available_agents" time="0.008" /><testcase classname="tests.integration.test_scoring_endpoints.TestScoringConfigurationEndpoint" name="test_get_scoring_configuration" time="0.008" /><testcase classname="tests.integration.test_scoring_endpoints.TestScoringMetricsEndpoint" name="test_get_performance_metrics" time="0.008" /><testcase classname="tests.integration.test_session_endpoints.TestSessionEndpoints" name="test_create_session_success" time="0.120"><failure message="fastapi.exceptions.ResponseValidationError: 4 validation errors:&#10;  {'type': 'string_type', 'loc': ('response', 'id'), 'msg': 'Input should be a valid string', 'input': UUID('d783698c-95f2-44c5-a84c-8b6649243995')}&#10;  {'type': 'string_type', 'loc': ('response', 'user_id'), 'msg': 'Input should be a valid string', 'input': UUID('0d63ea1a-bf60-453b-929f-cdfa25c7932f')}&#10;  {'type': 'string_type', 'loc': ('response', 'created_at'), 'msg': 'Input should be a valid string', 'input': datetime.datetime(2026, 2, 13, 0, 45, 15, 908517, tzinfo=datetime.timezone.utc)}&#10;  {'type': 'string_type', 'loc': ('response', 'updated_at'), 'msg': 'Input should be a valid string', 'input': datetime.datetime(2026, 2, 13, 0, 45, 15, 908518, tzinfo=datetime.timezone.utc)}&#10;&#10;  File &quot;/app/app/routers/sessions.py&quot;, line 22, in create_session&#10;    POST /api/v1/sessions/">+ Exception Group Traceback (most recent call last):
  |   File "/usr/local/lib/python3.11/site-packages/starlette/_utils.py", line 81, in collapse_excgroups
  |     yield
  |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 192, in __call__
  |     async with anyio.create_task_group() as task_group:
  |   File "/usr/local/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 783, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/usr/local/lib/python3.11/site-packages/_pytest/runner.py", line 341, in from_call
    |     result: Optional[TResult] = func()
    |                                 ^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/_pytest/runner.py", line 262, in &lt;lambda&gt;
    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise
    |             ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/_pytest/runner.py", line 177, in pytest_runtest_call
    |     raise e
    |   File "/usr/local/lib/python3.11/site-packages/_pytest/runner.py", line 169, in pytest_runtest_call
    |     item.runtest()
    |   File "/usr/local/lib/python3.11/site-packages/_pytest/python.py", line 1792, in runtest
    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/_pytest/python.py", line 194, in pytest_pyfunc_call
    |     result = testfunction(**testargs)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/tests/integration/test_session_endpoints.py", line 30, in test_create_session_success
    |     response = client.post("/api/v1/sessions/", json=session_data)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/testclient.py", line 546, in post
    |     return super().post(
    |            ^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1132, in post
    |     return self.request(
    |            ^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/testclient.py", line 445, in request
    |     return super().request(
    |            ^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 814, in request
    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 901, in send
    |     response = self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 929, in _send_handling_auth
    |     response = self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 966, in _send_handling_redirects
    |     response = self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1002, in _send_single_request
    |     response = transport.handle_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/testclient.py", line 348, in handle_request
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/testclient.py", line 345, in handle_request
    |     portal.call(self.app, scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/anyio/from_thread.py", line 334, in call
    |     return cast(T_Retval, self.start_task_soon(func, *args).result())
    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/concurrent/futures/_base.py", line 456, in result
    |     return self.__get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    |     raise self._exception
    |   File "/usr/local/lib/python3.11/site-packages/anyio/from_thread.py", line 259, in _call_func
    |     retval = await retval_or_awaitable
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1134, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 107, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 186, in __call__
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |   File "/usr/local/lib/python3.11/contextlib.py", line 158, in __exit__
    |     self.gen.throw(typ, value, traceback)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_utils.py", line 87, in collapse_excgroups
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/app/middleware/rate_limiting_middleware.py", line 51, in dispatch
    |     return await call_next(request)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/app/app/middleware/rate_limiting_middleware.py", line 40, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |   File "/usr/local/lib/python3.11/contextlib.py", line 158, in __exit__
    |     self.gen.throw(typ, value, traceback)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_utils.py", line 87, in collapse_excgroups
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/app/main.py", line 179, in logging_middleware
    |     return await log_requests(request, call_next)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/app/middleware/logging_middleware.py", line 29, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |   File "/usr/local/lib/python3.11/contextlib.py", line 158, in __exit__
    |     self.gen.throw(typ, value, traceback)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_utils.py", line 87, in collapse_excgroups
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/app/middleware/security_middleware.py", line 23, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |   File "/usr/local/lib/python3.11/contextlib.py", line 158, in __exit__
    |     self.gen.throw(typ, value, traceback)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_utils.py", line 87, in collapse_excgroups
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/app/middleware/file_upload_middleware.py", line 222, in dispatch
    |     return await call_next(request)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |   File "/usr/local/lib/python3.11/contextlib.py", line 158, in __exit__
    |     self.gen.throw(typ, value, traceback)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_utils.py", line 87, in collapse_excgroups
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/app/middleware/file_upload_middleware.py", line 139, in dispatch
    |     return await call_next(request)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |   File "/usr/local/lib/python3.11/contextlib.py", line 158, in __exit__
    |     self.gen.throw(typ, value, traceback)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_utils.py", line 87, in collapse_excgroups
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/app/middleware/file_upload_middleware.py", line 30, in dispatch
    |     return await call_next(request)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 87, in __call__
    |     await self.app(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 119, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 105, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 446, in app
    |     content = await serialize_response(
    |               ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 284, in serialize_response
    |     raise ResponseValidationError(
    | fastapi.exceptions.ResponseValidationError: 4 validation errors:
    |   {'type': 'string_type', 'loc': ('response', 'id'), 'msg': 'Input should be a valid string', 'input': UUID('d783698c-95f2-44c5-a84c-8b6649243995')}
    |   {'type': 'string_type', 'loc': ('response', 'user_id'), 'msg': 'Input should be a valid string', 'input': UUID('0d63ea1a-bf60-453b-929f-cdfa25c7932f')}
    |   {'type': 'string_type', 'loc': ('response', 'created_at'), 'msg': 'Input should be a valid string', 'input': datetime.datetime(2026, 2, 13, 0, 45, 15, 908517, tzinfo=datetime.timezone.utc)}
    |   {'type': 'string_type', 'loc': ('response', 'updated_at'), 'msg': 'Input should be a valid string', 'input': datetime.datetime(2026, 2, 13, 0, 45, 15, 908518, tzinfo=datetime.timezone.utc)}
    | 
    |   File "/app/app/routers/sessions.py", line 22, in create_session
    |     POST /api/v1/sessions/
    +------------------------------------

The above exception was the direct cause of the following exception:

self = &lt;tests.integration.test_session_endpoints.TestSessionEndpoints object at 0xffff724f9ed0&gt;, client = &lt;starlette.testclient.TestClient object at 0xffff71e19f50&gt;
sample_user = &lt;User(id=0d63ea1a-bf60-453b-929f-cdfa25c7932f, email=test-d1e8197a@example.com, name=Test User)&gt;, override_auth = &lt;function override_auth.&lt;locals&gt;._override at 0xffff709c8680&gt;
override_ai_client = &lt;function override_ai_client.&lt;locals&gt;._override at 0xffff709c8fe0&gt;, mock_ai_client = &lt;AsyncMock id='281472571252048'&gt;

    @pytest.mark.integration
    def test_create_session_success(
        self, client, sample_user, override_auth, override_ai_client, mock_ai_client
    ):
        """Test successful session creation."""
        override_auth({"id": str(sample_user.id), "email": sample_user.email, "is_admin": False})
        override_ai_client(mock_ai_client)
    
        session_data = {
            "user_id": str(sample_user.id),
            "mode": "interview",
            "role": "Python Developer",
            "job_title": "Python Developer",
            "job_description": "Looking for Python developer with Django experience"
        }
    
&gt;       response = client.post("/api/v1/sessions/", json=session_data)

tests/integration/test_session_endpoints.py:30: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:546: in post
    return super().post(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:1132: in post
    return self.request(
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:445: in request
    return super().request(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:814: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
/usr/local/lib/python3.11/site-packages/httpx/_client.py:901: in send
    response = self._send_handling_auth(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:929: in _send_handling_auth
    response = self._send_handling_redirects(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:966: in _send_handling_redirects
    response = self._send_single_request(request)
/usr/local/lib/python3.11/site-packages/httpx/_client.py:1002: in _send_single_request
    response = transport.handle_request(request)
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:348: in handle_request
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:345: in handle_request
    portal.call(self.app, scope, receive, send)
/usr/local/lib/python3.11/site-packages/anyio/from_thread.py:334: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
/usr/local/lib/python3.11/concurrent/futures/_base.py:456: in result
    return self.__get_result()
/usr/local/lib/python3.11/concurrent/futures/_base.py:401: in __get_result
    raise self._exception
/usr/local/lib/python3.11/site-packages/anyio/from_thread.py:259: in _call_func
    retval = await retval_or_awaitable
/usr/local/lib/python3.11/site-packages/fastapi/applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/applications.py:107: in __call__
    await self.middleware_stack(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/rate_limiting_middleware.py:51: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
app/middleware/rate_limiting_middleware.py:40: in dispatch
    response = await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/main.py:179: in logging_middleware
    return await log_requests(request, call_next)
app/middleware/logging_middleware.py:29: in log_requests
    response = await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/security_middleware.py:23: in dispatch
    response = await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/file_upload_middleware.py:222: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/file_upload_middleware.py:139: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/file_upload_middleware.py:30: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py:87: in __call__
    await self.app(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:119: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:105: in app
    response = await f(request)
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:446: in app
    content = await serialize_response(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    async def serialize_response(
        *,
        field: ModelField | None = None,
        response_content: Any,
        include: IncEx | None = None,
        exclude: IncEx | None = None,
        by_alias: bool = True,
        exclude_unset: bool = False,
        exclude_defaults: bool = False,
        exclude_none: bool = False,
        is_coroutine: bool = True,
        endpoint_ctx: EndpointContext | None = None,
    ) -&gt; Any:
        if field:
            if is_coroutine:
                value, errors = field.validate(response_content, {}, loc=("response",))
            else:
                value, errors = await run_in_threadpool(
                    field.validate, response_content, {}, loc=("response",)
                )
            if errors:
                ctx = endpoint_ctx or EndpointContext()
&gt;               raise ResponseValidationError(
                    errors=errors,
                    body=response_content,
                    endpoint_ctx=ctx,
                )
E               fastapi.exceptions.ResponseValidationError: 4 validation errors:
E                 {'type': 'string_type', 'loc': ('response', 'id'), 'msg': 'Input should be a valid string', 'input': UUID('d783698c-95f2-44c5-a84c-8b6649243995')}
E                 {'type': 'string_type', 'loc': ('response', 'user_id'), 'msg': 'Input should be a valid string', 'input': UUID('0d63ea1a-bf60-453b-929f-cdfa25c7932f')}
E                 {'type': 'string_type', 'loc': ('response', 'created_at'), 'msg': 'Input should be a valid string', 'input': datetime.datetime(2026, 2, 13, 0, 45, 15, 908517, tzinfo=datetime.timezone.utc)}
E                 {'type': 'string_type', 'loc': ('response', 'updated_at'), 'msg': 'Input should be a valid string', 'input': datetime.datetime(2026, 2, 13, 0, 45, 15, 908518, tzinfo=datetime.timezone.utc)}
E               
E                 File "/app/app/routers/sessions.py", line 22, in create_session
E                   POST /api/v1/sessions/

/usr/local/lib/python3.11/site-packages/fastapi/routing.py:284: ResponseValidationError</failure></testcase><testcase classname="tests.integration.test_session_endpoints.TestSessionEndpoints" name="test_create_session_missing_user_id" time="0.008" /><testcase classname="tests.integration.test_session_endpoints.TestSessionEndpoints" name="test_create_session_invalid_user_id" time="0.015"><failure message="app.exceptions.AIServiceError: Failed to create interview session: (psycopg2.errors.ForeignKeyViolation) insert or update on table &quot;interview_sessions&quot; violates foreign key constraint &quot;interview_sessions_user_id_fkey&quot;&#10;DETAIL:  Key (user_id)=(00000000-0000-0000-0000-000000000001) is not present in table &quot;users&quot;.&#10;&#10;[SQL: INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, status, total_questions, completed_questions, created_at, updated_at) VALUES (%(id)s::UUID, %(user_id)s::UUID, %(mode)s, %(role)s, %(job_description)s, %(scenario_id)s, %(question_source)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)]&#10;[parameters: {'id': UUID('53e2f14a-c1e9-4a5f-8d9b-f9707e8fbc4d'), 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'interview', 'role': 'Python Developer', 'job_description': 'Looking for Python developer', 'scenario_id': None, 'question_source': 'generated', 'job_context': '{&quot;title&quot;: &quot;Python Developer&quot;}', 'status': 'active', 'total_questions': 0, 'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 16, 412128), 'updated_at': datetime.datetime(2026, 2, 13, 0, 45, 16, 412129)}]&#10;(Background on this error at: https://sqlalche.me/e/20/gkpj)">self = &lt;sqlalchemy.engine.base.Connection object at 0xffff6b5edd50&gt;, dialect = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0xffff726f1190&gt;
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0xffff6b7bcc50&gt;, statement = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0xffff704b3410&gt;
parameters = [{'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 16, 412128), 'id': UUID('53e2f14a-c1e9-4a5f-8d9b-f9707e8fbc4d'), 'job_context': '{"title": "Python Developer"}', ...}]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -&gt; CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
&gt;                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0xffff726f1190&gt;, cursor = &lt;cursor object at 0xffff72120130; closed: -1&gt;
statement = 'INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, ...e)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)'
parameters = {'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 16, 412128), 'id': UUID('53e2f14a-c1e9-4a5f-8d9b-f9707e8fbc4d'), 'job_context': '{"title": "Python Developer"}', ...}
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0xffff6b7bcc50&gt;

    def do_execute(self, cursor, statement, parameters, context=None):
&gt;       cursor.execute(statement, parameters)
E       psycopg2.errors.ForeignKeyViolation: insert or update on table "interview_sessions" violates foreign key constraint "interview_sessions_user_id_fkey"
E       DETAIL:  Key (user_id)=(00000000-0000-0000-0000-000000000001) is not present in table "users".

/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py:952: ForeignKeyViolation

The above exception was the direct cause of the following exception:

self = &lt;app.services.session_service.SessionService object at 0xffff6b5ed290&gt;, user_id = '00000000-0000-0000-0000-000000000001', role = 'Python Developer'
job_description = 'Looking for Python developer', title = 'Python Developer', mode = 'interview'

    async def create_session(
        self,
        user_id: Union[int, str],
        role: str,
        job_description: str,
        title: Optional[str] = None,
        mode: str = "interview"
    ) -&gt; InterviewSession:
        """Create a new interview session (works for both sync and async)."""
        try:
            session_data = {
                "id": uuid.uuid4(),
                "user_id": user_id,
                "role": role,
                "job_description": job_description or "",
                "mode": mode,
                "question_source": "generated",
                "status": "active",
                "created_at": datetime.utcnow(),
                "updated_at": datetime.utcnow()
            }
            if title:
                session_data["job_context"] = {"title": title}
    
            session = InterviewSession(**session_data)
            self.db_session.add(session)
            if self.is_async:
                await self.db_session.commit()
                await self.db_session.refresh(session)
            else:
&gt;               self.db_session.commit()

app/services/session_service.py:62: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py:1048: in _emit_insert_statements
    result = connection.execute(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0xffff726f1190&gt;, cursor = &lt;cursor object at 0xffff72120130; closed: -1&gt;
statement = 'INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, ...e)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)'
parameters = {'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 16, 412128), 'id': UUID('53e2f14a-c1e9-4a5f-8d9b-f9707e8fbc4d'), 'job_context': '{"title": "Python Developer"}', ...}
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0xffff6b7bcc50&gt;

    def do_execute(self, cursor, statement, parameters, context=None):
&gt;       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (psycopg2.errors.ForeignKeyViolation) insert or update on table "interview_sessions" violates foreign key constraint "interview_sessions_user_id_fkey"
E       DETAIL:  Key (user_id)=(00000000-0000-0000-0000-000000000001) is not present in table "users".
E       
E       [SQL: INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, status, total_questions, completed_questions, created_at, updated_at) VALUES (%(id)s::UUID, %(user_id)s::UUID, %(mode)s, %(role)s, %(job_description)s, %(scenario_id)s, %(question_source)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)]
E       [parameters: {'id': UUID('53e2f14a-c1e9-4a5f-8d9b-f9707e8fbc4d'), 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'interview', 'role': 'Python Developer', 'job_description': 'Looking for Python developer', 'scenario_id': None, 'question_source': 'generated', 'job_context': '{"title": "Python Developer"}', 'status': 'active', 'total_questions': 0, 'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 16, 412128), 'updated_at': datetime.datetime(2026, 2, 13, 0, 45, 16, 412129)}]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

self = &lt;tests.integration.test_session_endpoints.TestSessionEndpoints object at 0xffff724fb010&gt;, client = &lt;starlette.testclient.TestClient object at 0xffff6b5ef4d0&gt;
override_auth = &lt;function override_auth.&lt;locals&gt;._override at 0xffff7063da80&gt;

    @pytest.mark.integration
    def test_create_session_invalid_user_id(self, client, override_auth):
        """Test session creation with invalid user_id."""
        override_auth({"id": "00000000-0000-0000-0000-000000000001", "email": "test@example.com", "is_admin": False})
    
        session_data = {
            "user_id": "invalid-uuid",
            "mode": "interview",
            "role": "Python Developer",
            "job_title": "Python Developer",
            "job_description": "Looking for Python developer"
        }
    
&gt;       response = client.post("/api/v1/sessions/", json=session_data)

tests/integration/test_session_endpoints.py:81: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:546: in post
    return super().post(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:1132: in post
    return self.request(
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:445: in request
    return super().request(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:814: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
/usr/local/lib/python3.11/site-packages/httpx/_client.py:901: in send
    response = self._send_handling_auth(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:929: in _send_handling_auth
    response = self._send_handling_redirects(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:966: in _send_handling_redirects
    response = self._send_single_request(request)
/usr/local/lib/python3.11/site-packages/httpx/_client.py:1002: in _send_single_request
    response = transport.handle_request(request)
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:348: in handle_request
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:345: in handle_request
    portal.call(self.app, scope, receive, send)
/usr/local/lib/python3.11/site-packages/anyio/from_thread.py:334: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
/usr/local/lib/python3.11/concurrent/futures/_base.py:456: in result
    return self.__get_result()
/usr/local/lib/python3.11/concurrent/futures/_base.py:401: in __get_result
    raise self._exception
/usr/local/lib/python3.11/site-packages/anyio/from_thread.py:259: in _call_func
    retval = await retval_or_awaitable
/usr/local/lib/python3.11/site-packages/fastapi/applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/applications.py:107: in __call__
    await self.middleware_stack(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/rate_limiting_middleware.py:51: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
app/middleware/rate_limiting_middleware.py:40: in dispatch
    response = await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/main.py:179: in logging_middleware
    return await log_requests(request, call_next)
app/middleware/logging_middleware.py:29: in log_requests
    response = await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/security_middleware.py:23: in dispatch
    response = await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/file_upload_middleware.py:222: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/file_upload_middleware.py:139: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/file_upload_middleware.py:30: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py:87: in __call__
    await self.app(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:119: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:105: in app
    response = await f(request)
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:424: in app
    raw_response = await run_endpoint_function(
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:312: in run_endpoint_function
    return await dependant.call(**values)
app/routers/sessions.py:40: in create_session
    session = await session_service.create_interview_session(
app/services/session_service.py:136: in create_interview_session
    return await self.create_session(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;app.services.session_service.SessionService object at 0xffff6b5ed290&gt;, user_id = '00000000-0000-0000-0000-000000000001', role = 'Python Developer'
job_description = 'Looking for Python developer', title = 'Python Developer', mode = 'interview'

    async def create_session(
        self,
        user_id: Union[int, str],
        role: str,
        job_description: str,
        title: Optional[str] = None,
        mode: str = "interview"
    ) -&gt; InterviewSession:
        """Create a new interview session (works for both sync and async)."""
        try:
            session_data = {
                "id": uuid.uuid4(),
                "user_id": user_id,
                "role": role,
                "job_description": job_description or "",
                "mode": mode,
                "question_source": "generated",
                "status": "active",
                "created_at": datetime.utcnow(),
                "updated_at": datetime.utcnow()
            }
            if title:
                session_data["job_context"] = {"title": title}
    
            session = InterviewSession(**session_data)
            self.db_session.add(session)
            if self.is_async:
                await self.db_session.commit()
                await self.db_session.refresh(session)
            else:
                self.db_session.commit()
                self.db_session.refresh(session)
    
            logger.info(f"Created interview session {session.id} for user {user_id}")
            return session
    
        except Exception as e:
            if self.is_async:
                await self.db_session.rollback()
            else:
                self.db_session.rollback()
            logger.error(f"Error creating session: {e}")
&gt;           raise AIServiceError(f"Failed to create interview session: {e}")
E           app.exceptions.AIServiceError: Failed to create interview session: (psycopg2.errors.ForeignKeyViolation) insert or update on table "interview_sessions" violates foreign key constraint "interview_sessions_user_id_fkey"
E           DETAIL:  Key (user_id)=(00000000-0000-0000-0000-000000000001) is not present in table "users".
E           
E           [SQL: INSERT INTO interview_sessions (id, user_id, mode, role, job_description, scenario_id, question_source, job_context, status, total_questions, completed_questions, created_at, updated_at) VALUES (%(id)s::UUID, %(user_id)s::UUID, %(mode)s, %(role)s, %(job_description)s, %(scenario_id)s, %(question_source)s, %(job_context)s::JSONB, %(status)s, %(total_questions)s, %(completed_questions)s, %(created_at)s, %(updated_at)s)]
E           [parameters: {'id': UUID('53e2f14a-c1e9-4a5f-8d9b-f9707e8fbc4d'), 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'interview', 'role': 'Python Developer', 'job_description': 'Looking for Python developer', 'scenario_id': None, 'question_source': 'generated', 'job_context': '{"title": "Python Developer"}', 'status': 'active', 'total_questions': 0, 'completed_questions': 0, 'created_at': datetime.datetime(2026, 2, 13, 0, 45, 16, 412128), 'updated_at': datetime.datetime(2026, 2, 13, 0, 45, 16, 412129)}]
E           (Background on this error at: https://sqlalche.me/e/20/gkpj)

app/services/session_service.py:74: AIServiceError</failure></testcase><testcase classname="tests.integration.test_session_endpoints.TestSessionEndpoints" name="test_create_session_missing_fields" time="0.115"><failure message="fastapi.exceptions.ResponseValidationError: 4 validation errors:&#10;  {'type': 'string_type', 'loc': ('response', 'id'), 'msg': 'Input should be a valid string', 'input': UUID('1b46dd95-4d1f-4d46-882a-ac414fe99177')}&#10;  {'type': 'string_type', 'loc': ('response', 'user_id'), 'msg': 'Input should be a valid string', 'input': UUID('d4837ac4-8fe3-4980-9c60-893542eb87db')}&#10;  {'type': 'string_type', 'loc': ('response', 'created_at'), 'msg': 'Input should be a valid string', 'input': datetime.datetime(2026, 2, 13, 0, 45, 17, 500857, tzinfo=datetime.timezone.utc)}&#10;  {'type': 'string_type', 'loc': ('response', 'updated_at'), 'msg': 'Input should be a valid string', 'input': datetime.datetime(2026, 2, 13, 0, 45, 17, 500858, tzinfo=datetime.timezone.utc)}&#10;&#10;  File &quot;/app/app/routers/sessions.py&quot;, line 22, in create_session&#10;    POST /api/v1/sessions/">+ Exception Group Traceback (most recent call last):
  |   File "/usr/local/lib/python3.11/site-packages/starlette/_utils.py", line 81, in collapse_excgroups
  |     yield
  |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 192, in __call__
  |     async with anyio.create_task_group() as task_group:
  |   File "/usr/local/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 783, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/usr/local/lib/python3.11/site-packages/_pytest/runner.py", line 341, in from_call
    |     result: Optional[TResult] = func()
    |                                 ^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/_pytest/runner.py", line 262, in &lt;lambda&gt;
    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise
    |             ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/_pytest/runner.py", line 177, in pytest_runtest_call
    |     raise e
    |   File "/usr/local/lib/python3.11/site-packages/_pytest/runner.py", line 169, in pytest_runtest_call
    |     item.runtest()
    |   File "/usr/local/lib/python3.11/site-packages/_pytest/python.py", line 1792, in runtest
    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/_pytest/python.py", line 194, in pytest_pyfunc_call
    |     result = testfunction(**testargs)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/tests/integration/test_session_endpoints.py", line 99, in test_create_session_missing_fields
    |     response = client.post("/api/v1/sessions/", json=session_data)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/testclient.py", line 546, in post
    |     return super().post(
    |            ^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1132, in post
    |     return self.request(
    |            ^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/testclient.py", line 445, in request
    |     return super().request(
    |            ^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 814, in request
    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 901, in send
    |     response = self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 929, in _send_handling_auth
    |     response = self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 966, in _send_handling_redirects
    |     response = self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1002, in _send_single_request
    |     response = transport.handle_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/testclient.py", line 348, in handle_request
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/testclient.py", line 345, in handle_request
    |     portal.call(self.app, scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/anyio/from_thread.py", line 334, in call
    |     return cast(T_Retval, self.start_task_soon(func, *args).result())
    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/concurrent/futures/_base.py", line 456, in result
    |     return self.__get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    |     raise self._exception
    |   File "/usr/local/lib/python3.11/site-packages/anyio/from_thread.py", line 259, in _call_func
    |     retval = await retval_or_awaitable
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1134, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 107, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 186, in __call__
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |   File "/usr/local/lib/python3.11/contextlib.py", line 158, in __exit__
    |     self.gen.throw(typ, value, traceback)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_utils.py", line 87, in collapse_excgroups
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/app/middleware/rate_limiting_middleware.py", line 51, in dispatch
    |     return await call_next(request)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/app/app/middleware/rate_limiting_middleware.py", line 40, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |   File "/usr/local/lib/python3.11/contextlib.py", line 158, in __exit__
    |     self.gen.throw(typ, value, traceback)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_utils.py", line 87, in collapse_excgroups
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/app/main.py", line 179, in logging_middleware
    |     return await log_requests(request, call_next)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/app/middleware/logging_middleware.py", line 29, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |   File "/usr/local/lib/python3.11/contextlib.py", line 158, in __exit__
    |     self.gen.throw(typ, value, traceback)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_utils.py", line 87, in collapse_excgroups
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/app/middleware/security_middleware.py", line 23, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |   File "/usr/local/lib/python3.11/contextlib.py", line 158, in __exit__
    |     self.gen.throw(typ, value, traceback)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_utils.py", line 87, in collapse_excgroups
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/app/middleware/file_upload_middleware.py", line 222, in dispatch
    |     return await call_next(request)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |   File "/usr/local/lib/python3.11/contextlib.py", line 158, in __exit__
    |     self.gen.throw(typ, value, traceback)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_utils.py", line 87, in collapse_excgroups
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/app/middleware/file_upload_middleware.py", line 139, in dispatch
    |     return await call_next(request)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |   File "/usr/local/lib/python3.11/contextlib.py", line 158, in __exit__
    |     self.gen.throw(typ, value, traceback)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_utils.py", line 87, in collapse_excgroups
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/app/middleware/file_upload_middleware.py", line 30, in dispatch
    |     return await call_next(request)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 87, in __call__
    |     await self.app(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 119, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 105, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 446, in app
    |     content = await serialize_response(
    |               ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 284, in serialize_response
    |     raise ResponseValidationError(
    | fastapi.exceptions.ResponseValidationError: 4 validation errors:
    |   {'type': 'string_type', 'loc': ('response', 'id'), 'msg': 'Input should be a valid string', 'input': UUID('1b46dd95-4d1f-4d46-882a-ac414fe99177')}
    |   {'type': 'string_type', 'loc': ('response', 'user_id'), 'msg': 'Input should be a valid string', 'input': UUID('d4837ac4-8fe3-4980-9c60-893542eb87db')}
    |   {'type': 'string_type', 'loc': ('response', 'created_at'), 'msg': 'Input should be a valid string', 'input': datetime.datetime(2026, 2, 13, 0, 45, 17, 500857, tzinfo=datetime.timezone.utc)}
    |   {'type': 'string_type', 'loc': ('response', 'updated_at'), 'msg': 'Input should be a valid string', 'input': datetime.datetime(2026, 2, 13, 0, 45, 17, 500858, tzinfo=datetime.timezone.utc)}
    | 
    |   File "/app/app/routers/sessions.py", line 22, in create_session
    |     POST /api/v1/sessions/
    +------------------------------------

The above exception was the direct cause of the following exception:

self = &lt;tests.integration.test_session_endpoints.TestSessionEndpoints object at 0xffff724fb890&gt;, client = &lt;starlette.testclient.TestClient object at 0xffff6bb56950&gt;
sample_user = &lt;User(id=d4837ac4-8fe3-4980-9c60-893542eb87db, email=test-a98da81f@example.com, name=Test User)&gt;, override_auth = &lt;function override_auth.&lt;locals&gt;._override at 0xffff7063d6c0&gt;

    @pytest.mark.integration
    def test_create_session_missing_fields(self, client, sample_user, override_auth):
        """Test session creation with missing required fields."""
        override_auth({"id": str(sample_user.id), "email": sample_user.email, "is_admin": False})
    
        session_data = {
            "user_id": str(sample_user.id),
            "mode": "interview",
            "role": "Python Developer"
            # Missing job_title and job_description
        }
    
&gt;       response = client.post("/api/v1/sessions/", json=session_data)

tests/integration/test_session_endpoints.py:99: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:546: in post
    return super().post(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:1132: in post
    return self.request(
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:445: in request
    return super().request(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:814: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
/usr/local/lib/python3.11/site-packages/httpx/_client.py:901: in send
    response = self._send_handling_auth(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:929: in _send_handling_auth
    response = self._send_handling_redirects(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:966: in _send_handling_redirects
    response = self._send_single_request(request)
/usr/local/lib/python3.11/site-packages/httpx/_client.py:1002: in _send_single_request
    response = transport.handle_request(request)
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:348: in handle_request
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:345: in handle_request
    portal.call(self.app, scope, receive, send)
/usr/local/lib/python3.11/site-packages/anyio/from_thread.py:334: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
/usr/local/lib/python3.11/concurrent/futures/_base.py:456: in result
    return self.__get_result()
/usr/local/lib/python3.11/concurrent/futures/_base.py:401: in __get_result
    raise self._exception
/usr/local/lib/python3.11/site-packages/anyio/from_thread.py:259: in _call_func
    retval = await retval_or_awaitable
/usr/local/lib/python3.11/site-packages/fastapi/applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/applications.py:107: in __call__
    await self.middleware_stack(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/rate_limiting_middleware.py:51: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
app/middleware/rate_limiting_middleware.py:40: in dispatch
    response = await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/main.py:179: in logging_middleware
    return await log_requests(request, call_next)
app/middleware/logging_middleware.py:29: in log_requests
    response = await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/security_middleware.py:23: in dispatch
    response = await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/file_upload_middleware.py:222: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/file_upload_middleware.py:139: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/file_upload_middleware.py:30: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py:87: in __call__
    await self.app(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:119: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:105: in app
    response = await f(request)
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:446: in app
    content = await serialize_response(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    async def serialize_response(
        *,
        field: ModelField | None = None,
        response_content: Any,
        include: IncEx | None = None,
        exclude: IncEx | None = None,
        by_alias: bool = True,
        exclude_unset: bool = False,
        exclude_defaults: bool = False,
        exclude_none: bool = False,
        is_coroutine: bool = True,
        endpoint_ctx: EndpointContext | None = None,
    ) -&gt; Any:
        if field:
            if is_coroutine:
                value, errors = field.validate(response_content, {}, loc=("response",))
            else:
                value, errors = await run_in_threadpool(
                    field.validate, response_content, {}, loc=("response",)
                )
            if errors:
                ctx = endpoint_ctx or EndpointContext()
&gt;               raise ResponseValidationError(
                    errors=errors,
                    body=response_content,
                    endpoint_ctx=ctx,
                )
E               fastapi.exceptions.ResponseValidationError: 4 validation errors:
E                 {'type': 'string_type', 'loc': ('response', 'id'), 'msg': 'Input should be a valid string', 'input': UUID('1b46dd95-4d1f-4d46-882a-ac414fe99177')}
E                 {'type': 'string_type', 'loc': ('response', 'user_id'), 'msg': 'Input should be a valid string', 'input': UUID('d4837ac4-8fe3-4980-9c60-893542eb87db')}
E                 {'type': 'string_type', 'loc': ('response', 'created_at'), 'msg': 'Input should be a valid string', 'input': datetime.datetime(2026, 2, 13, 0, 45, 17, 500857, tzinfo=datetime.timezone.utc)}
E                 {'type': 'string_type', 'loc': ('response', 'updated_at'), 'msg': 'Input should be a valid string', 'input': datetime.datetime(2026, 2, 13, 0, 45, 17, 500858, tzinfo=datetime.timezone.utc)}
E               
E                 File "/app/app/routers/sessions.py", line 22, in create_session
E                   POST /api/v1/sessions/

/usr/local/lib/python3.11/site-packages/fastapi/routing.py:284: ResponseValidationError</failure></testcase><testcase classname="tests.integration.test_session_endpoints.TestSessionEndpoints" name="test_create_session_empty_fields" time="0.110" /><testcase classname="tests.integration.test_session_endpoints.TestSessionEndpoints" name="test_get_session_success" time="0.125"><failure message="AssertionError: assert 'id' in {'questions': [], 'session': {'created_at': '2026-02-13T00:45:18.075065+00:00', 'id': '609dc804-b298-4bfe-9bd4-9d1fb8dc0dbe', 'job_description': 'Test job description', 'mode': 'interview', ...}}">self = &lt;tests.integration.test_session_endpoints.TestSessionEndpoints object at 0xffff724dc350&gt;, client = &lt;starlette.testclient.TestClient object at 0xffff70134f50&gt;
sample_interview_session = &lt;InterviewSession(id=609dc804-b298-4bfe-9bd4-9d1fb8dc0dbe, user_id=fcc96f20-9dcc-47b7-8209-a169c4ebdb6b, role=Python Developer, status=active)&gt;
sample_user = &lt;User(id=fcc96f20-9dcc-47b7-8209-a169c4ebdb6b, email=test-8e60a3c7@example.com, name=Test User)&gt;, override_auth = &lt;function override_auth.&lt;locals&gt;._override at 0xffff70952700&gt;

    @pytest.mark.integration
    def test_get_session_success(self, client, sample_interview_session, sample_user, override_auth):
        """Test successful session retrieval."""
        override_auth({"id": str(sample_user.id), "email": sample_user.email, "is_admin": False})
    
        response = client.get(f"/api/v1/sessions/{sample_interview_session.id}")
    
        assert response.status_code == 200
        data = response.json()
&gt;       assert "id" in data
E       AssertionError: assert 'id' in {'questions': [], 'session': {'created_at': '2026-02-13T00:45:18.075065+00:00', 'id': '609dc804-b298-4bfe-9bd4-9d1fb8dc0dbe', 'job_description': 'Test job description', 'mode': 'interview', ...}}

tests/integration/test_session_endpoints.py:133: AssertionError</failure></testcase><testcase classname="tests.integration.test_session_endpoints.TestSessionEndpoints" name="test_get_session_not_found" time="0.112" /><testcase classname="tests.integration.test_session_endpoints.TestSessionEndpoints" name="test_get_session_invalid_id" time="0.111"><failure message="assert 404 == 422&#10; +  where 404 = &lt;Response [404 Not Found]&gt;.status_code">self = &lt;tests.integration.test_session_endpoints.TestSessionEndpoints object at 0xffff724dd410&gt;, client = &lt;starlette.testclient.TestClient object at 0xffff701aa410&gt;
sample_user = &lt;User(id=61d54017-9e59-4f84-964d-ae0e1439c3ca, email=test-5b11aead@example.com, name=Test User)&gt;, override_auth = &lt;function override_auth.&lt;locals&gt;._override at 0xffff7063f920&gt;

    @pytest.mark.integration
    def test_get_session_invalid_id(self, client, sample_user, override_auth):
        """Test session retrieval with invalid ID format."""
        override_auth({"id": str(sample_user.id), "email": sample_user.email, "is_admin": False})
    
        invalid_id = "invalid-uuid"
    
        response = client.get(f"/api/v1/sessions/{invalid_id}")
    
&gt;       assert response.status_code == 422
E       assert 404 == 422
E        +  where 404 = &lt;Response [404 Not Found]&gt;.status_code

tests/integration/test_session_endpoints.py:167: AssertionError</failure></testcase><testcase classname="tests.integration.test_session_endpoints.TestSessionEndpoints" name="test_list_sessions_success" time="0.111" /><testcase classname="tests.integration.test_session_endpoints.TestSessionEndpoints" name="test_list_sessions_with_pagination" time="0.110" /><testcase classname="tests.integration.test_session_endpoints.TestSessionEndpoints" name="test_list_sessions_without_auth_returns_401" time="0.008" /><testcase classname="tests.integration.test_session_endpoints.TestSessionEndpoints" name="test_update_session_success" time="0.121" /><testcase classname="tests.integration.test_session_endpoints.TestSessionEndpoints" name="test_update_session_not_found" time="0.111" /><testcase classname="tests.integration.test_session_endpoints.TestSessionEndpoints" name="test_update_session_invalid_id" time="0.110"><failure message="assert 404 == 422&#10; +  where 404 = &lt;Response [404 Not Found]&gt;.status_code">self = &lt;tests.integration.test_session_endpoints.TestSessionEndpoints object at 0xffff724dfb50&gt;, client = &lt;starlette.testclient.TestClient object at 0xffff701342d0&gt;
sample_user = &lt;User(id=fda41aea-2e6f-4002-9d19-d4cb2dd6419b, email=test-46e99155@example.com, name=Test User)&gt;, override_auth = &lt;function override_auth.&lt;locals&gt;._override at 0xffff709cb9c0&gt;

    @pytest.mark.integration
    def test_update_session_invalid_id(self, client, sample_user, override_auth):
        """Test session status update with invalid ID format."""
        override_auth({"id": str(sample_user.id), "email": sample_user.email, "is_admin": False})
    
        invalid_id = "invalid-uuid"
    
        response = client.patch(
            f"/api/v1/sessions/{invalid_id}/status?status=completed"
        )
    
&gt;       assert response.status_code == 422
E       assert 404 == 422
E        +  where 404 = &lt;Response [404 Not Found]&gt;.status_code

tests/integration/test_session_endpoints.py:249: AssertionError</failure></testcase><testcase classname="tests.integration.test_session_endpoints.TestSessionEndpoints" name="test_delete_session_success" time="0.114"><failure message="sqlalchemy.orm.exc.ObjectDeletedError: Instance '&lt;InterviewSession at 0xffff70187510&gt;' has been deleted, or its row is otherwise not present.">self = &lt;tests.integration.test_session_endpoints.TestSessionEndpoints object at 0xffff724dfc10&gt;, client = &lt;starlette.testclient.TestClient object at 0xffff70824350&gt;
sample_interview_session = &lt;[ObjectDeletedError("Instance '&lt;InterviewSession at 0xffff70187510&gt;' has been deleted, or its row is otherwise not present.") raised in repr()] InterviewSession object at 0xffff70187510&gt;
sample_user = &lt;User(id=fd6b0a00-4c2c-4407-b499-762b0412403f, email=test-238d6a9b@example.com, name=Test User)&gt;, override_auth = &lt;function override_auth.&lt;locals&gt;._override at 0xffff709c8680&gt;

    @pytest.mark.integration
    def test_delete_session_success(self, client, sample_interview_session, sample_user, override_auth):
        """Test successful session deletion."""
        override_auth({"id": str(sample_user.id), "email": sample_user.email, "is_admin": False})
    
        response = client.delete(f"/api/v1/sessions/{sample_interview_session.id}")
    
        assert response.status_code == 200
        data = response.json()
        assert "message" in data
    
&gt;       get_response = client.get(f"/api/v1/sessions/{sample_interview_session.id}")

tests/integration/test_session_endpoints.py:264: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py:569: in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py:1096: in get
    value = self._fire_loader_callables(state, key, passive)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py:1126: in _fire_loader_callables
    return state._load_expired(state, passive)
/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state.py:828: in _load_expired
    self.manager.expired_attribute_loader(self, toload, passive)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

mapper = &lt;Mapper at 0xffff93b4fd90; InterviewSession&gt;, state = &lt;sqlalchemy.orm.state.InstanceState object at 0xffff7094a090&gt;
attribute_names = {'analytics_events', 'completed_questions', 'created_at', 'id', 'job_context', 'job_description', ...}, passive = symbol('PASSIVE_OFF')

    def load_scalar_attributes(mapper, state, attribute_names, passive):
        """initiate a column-based attribute refresh operation."""
    
        # assert mapper is _state_mapper(state)
        session = state.session
        if not session:
            raise orm_exc.DetachedInstanceError(
                "Instance %s is not bound to a Session; "
                "attribute refresh operation cannot proceed" % (state_str(state))
            )
    
        no_autoflush = bool(passive &amp; attributes.NO_AUTOFLUSH)
    
        # in the case of inheritance, particularly concrete and abstract
        # concrete inheritance, the class manager might have some keys
        # of attributes on the superclass that we didn't actually map.
        # These could be mapped as "concrete, don't load" or could be completely
        # excluded from the mapping and we know nothing about them.  Filter them
        # here to prevent them from coming through.
        if attribute_names:
            attribute_names = attribute_names.intersection(mapper.attrs.keys())
    
        if mapper.inherits and not mapper.concrete:
            # load based on committed attributes in the object, formed into
            # a truncated SELECT that only includes relevant tables.  does not
            # currently use state.key
            statement = mapper._optimized_get_statement(state, attribute_names)
            if statement is not None:
                # undefer() isn't needed here because statement has the
                # columns needed already, this implicitly undefers that column
                stmt = FromStatement(mapper, statement)
    
                return load_on_ident(
                    session,
                    stmt,
                    None,
                    only_load_props=attribute_names,
                    refresh_state=state,
                    no_autoflush=no_autoflush,
                )
    
        # normal load, use state.key as the identity to SELECT
        has_key = bool(state.key)
    
        if has_key:
            identity_key = state.key
        else:
            # this codepath is rare - only valid when inside a flush, and the
            # object is becoming persistent but hasn't yet been assigned
            # an identity_key.
            # check here to ensure we have the attrs we need.
            pk_attrs = [
                mapper._columntoproperty[col].key for col in mapper.primary_key
            ]
            if state.expired_attributes.intersection(pk_attrs):
                raise sa_exc.InvalidRequestError(
                    "Instance %s cannot be refreshed - it's not "
                    " persistent and does not "
                    "contain a full primary key." % state_str(state)
                )
            identity_key = mapper._identity_key_from_state(state)
    
        if (
            _none_set.issubset(identity_key) and not mapper.allow_partial_pks
        ) or _none_set.issuperset(identity_key):
            util.warn_limited(
                "Instance %s to be refreshed doesn't "
                "contain a full primary key - can't be refreshed "
                "(and shouldn't be expired, either).",
                state_str(state),
            )
            return
    
        result = load_on_ident(
            session,
            select(mapper).set_label_style(LABEL_STYLE_TABLENAME_PLUS_COL),
            identity_key,
            refresh_state=state,
            only_load_props=attribute_names,
            no_autoflush=no_autoflush,
        )
    
        # if instance is pending, a refresh operation
        # may not complete (even if PK attributes are assigned)
        if has_key and result is None:
&gt;           raise orm_exc.ObjectDeletedError(state)
E           sqlalchemy.orm.exc.ObjectDeletedError: Instance '&lt;InterviewSession at 0xffff70187510&gt;' has been deleted, or its row is otherwise not present.

/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/loading.py:1686: ObjectDeletedError</failure></testcase><testcase classname="tests.integration.test_session_endpoints.TestSessionEndpoints" name="test_delete_session_not_found" time="0.112" /><testcase classname="tests.integration.test_session_endpoints.TestSessionEndpoints" name="test_delete_session_invalid_id" time="0.112"><failure message="assert 404 == 422&#10; +  where 404 = &lt;Response [404 Not Found]&gt;.status_code">self = &lt;tests.integration.test_session_endpoints.TestSessionEndpoints object at 0xffff724de490&gt;, client = &lt;starlette.testclient.TestClient object at 0xffff6b7bde90&gt;
sample_user = &lt;User(id=504f0f0f-679e-43c1-9f38-895e2fedaff3, email=test-7b1fb811@example.com, name=Test User)&gt;, override_auth = &lt;function override_auth.&lt;locals&gt;._override at 0xffff7207fce0&gt;

    @pytest.mark.integration
    def test_delete_session_invalid_id(self, client, sample_user, override_auth):
        """Test session deletion with invalid ID format."""
        override_auth({"id": str(sample_user.id), "email": sample_user.email, "is_admin": False})
    
        invalid_id = "invalid-uuid"
    
        response = client.delete(f"/api/v1/sessions/{invalid_id}")
    
&gt;       assert response.status_code == 422
E       assert 404 == 422
E        +  where 404 = &lt;Response [404 Not Found]&gt;.status_code

tests/integration/test_session_endpoints.py:290: AssertionError</failure></testcase><testcase classname="tests.integration.test_session_endpoints.TestSessionEndpoints" name="test_get_session_questions_success" time="0.122" /><testcase classname="tests.integration.test_session_endpoints.TestSessionEndpoints" name="test_get_session_questions_not_found" time="0.106" /><testcase classname="tests.integration.test_session_endpoints.TestSessionEndpoints" name="test_get_session_questions_invalid_id" time="0.111"><failure message="assert 404 == 422&#10; +  where 404 = &lt;Response [404 Not Found]&gt;.status_code">self = &lt;tests.integration.test_session_endpoints.TestSessionEndpoints object at 0xffff724ba110&gt;, client = &lt;starlette.testclient.TestClient object at 0xffff6b892e50&gt;
sample_user = &lt;User(id=ccbd8bc8-d470-48eb-91aa-1989c3b34cb1, email=test-a98843d5@example.com, name=Test User)&gt;, override_auth = &lt;function override_auth.&lt;locals&gt;._override at 0xffff709ca020&gt;

    @pytest.mark.integration
    def test_get_session_questions_invalid_id(self, client, sample_user, override_auth):
        """Test session questions retrieval with invalid ID format."""
        override_auth({"id": str(sample_user.id), "email": sample_user.email, "is_admin": False})
    
        invalid_id = "invalid-uuid"
    
        response = client.get(f"/api/v1/sessions/{invalid_id}/questions")
    
&gt;       assert response.status_code == 422
E       assert 404 == 422
E        +  where 404 = &lt;Response [404 Not Found]&gt;.status_code

tests/integration/test_session_endpoints.py:331: AssertionError</failure></testcase><testcase classname="tests.integration.test_session_endpoints.TestSessionEndpoints" name="test_add_question_to_session_success" time="0.125" /><testcase classname="tests.integration.test_session_endpoints.TestSessionEndpoints" name="test_add_question_to_session_not_found" time="0.111" /><testcase classname="tests.integration.test_session_endpoints.TestSessionEndpoints" name="test_add_question_to_session_invalid_question_id" time="0.125" /><testcase classname="tests.integration.test_session_endpoints.TestSessionEndpoints" name="test_remove_question_from_session_success" time="0.115"><failure message="assert 404 in (200, 204)&#10; +  where 404 = &lt;Response [404 Not Found]&gt;.status_code">self = &lt;tests.integration.test_session_endpoints.TestSessionEndpoints object at 0xffff724bba90&gt;, client = &lt;starlette.testclient.TestClient object at 0xffff6b54f990&gt;
sample_interview_session = &lt;InterviewSession(id=f1ab6a9d-89c7-44d4-9d71-436ea4e2ced7, user_id=d2866500-1406-443c-a6f7-7b67ab80e70c, role=Python Developer, status=active)&gt;
sample_session_question = &lt;SessionQuestion(id=e05f5711-6793-4af8-a2b8-32c94c2eb2d7, session_id=f1ab6a9d-89c7-44d4-9d71-436ea4e2ced7, question_id=b7b41de6-377a-40cb-80eb-7c5e07dd4d1d, order=1)&gt;
sample_user = &lt;User(id=d2866500-1406-443c-a6f7-7b67ab80e70c, email=test-0517b9f9@example.com, name=Test User)&gt;, override_auth = &lt;function override_auth.&lt;locals&gt;._override at 0xffff709cbd80&gt;

    @pytest.mark.integration
    def test_remove_question_from_session_success(
        self, client, sample_interview_session, sample_session_question, sample_user, override_auth
    ):
        """Test successful question removal from session."""
        override_auth({"id": str(sample_user.id), "email": sample_user.email, "is_admin": False})
    
        response = client.delete(
            f"/api/v1/sessions/{sample_interview_session.id}/questions/{sample_session_question.id}"
        )
    
&gt;       assert response.status_code in (200, 204)
E       assert 404 in (200, 204)
E        +  where 404 = &lt;Response [404 Not Found]&gt;.status_code

tests/integration/test_session_endpoints.py:405: AssertionError</failure></testcase><testcase classname="tests.integration.test_session_endpoints.TestSessionEndpoints" name="test_remove_question_from_session_not_found" time="0.112" /><testcase classname="tests.integration.test_session_endpoints.TestSessionEndpoints" name="test_remove_question_from_session_invalid_id" time="0.113"><failure message="assert 404 == 422&#10; +  where 404 = &lt;Response [404 Not Found]&gt;.status_code">self = &lt;tests.integration.test_session_endpoints.TestSessionEndpoints object at 0xffff724b8bd0&gt;, client = &lt;starlette.testclient.TestClient object at 0xffff71dbfb50&gt;
sample_interview_session = &lt;InterviewSession(id=d474d311-eaef-4e47-97e8-5177f5d0aeec, user_id=6d06093c-1b33-4514-8402-4639a249f4dc, role=Python Developer, status=active)&gt;
sample_user = &lt;User(id=6d06093c-1b33-4514-8402-4639a249f4dc, email=test-d99bdaf8@example.com, name=Test User)&gt;, override_auth = &lt;function override_auth.&lt;locals&gt;._override at 0xffff70975b20&gt;

    @pytest.mark.integration
    def test_remove_question_from_session_invalid_id(self, client, sample_interview_session, sample_user, override_auth):
        """Test question removal with invalid ID format."""
        override_auth({"id": str(sample_user.id), "email": sample_user.email, "is_admin": False})
    
        invalid_id = "invalid-uuid"
    
        response = client.delete(
            f"/api/v1/sessions/{sample_interview_session.id}/questions/{invalid_id}"
        )
    
&gt;       assert response.status_code == 422
E       assert 404 == 422
E        +  where 404 = &lt;Response [404 Not Found]&gt;.status_code

tests/integration/test_session_endpoints.py:437: AssertionError</failure></testcase><testcase classname="tests.integration.test_session_endpoints.TestSessionEndpoints" name="test_session_creation_with_ai_service_error" time="0.115"><failure message="fastapi.exceptions.ResponseValidationError: 4 validation errors:&#10;  {'type': 'string_type', 'loc': ('response', 'id'), 'msg': 'Input should be a valid string', 'input': UUID('29efd216-3366-4f5a-90dd-5b9ff68eaa0f')}&#10;  {'type': 'string_type', 'loc': ('response', 'user_id'), 'msg': 'Input should be a valid string', 'input': UUID('01a5e78a-49e1-40e7-af8e-17098c4f77c3')}&#10;  {'type': 'string_type', 'loc': ('response', 'created_at'), 'msg': 'Input should be a valid string', 'input': datetime.datetime(2026, 2, 13, 0, 45, 20, 714183, tzinfo=datetime.timezone.utc)}&#10;  {'type': 'string_type', 'loc': ('response', 'updated_at'), 'msg': 'Input should be a valid string', 'input': datetime.datetime(2026, 2, 13, 0, 45, 20, 714184, tzinfo=datetime.timezone.utc)}&#10;&#10;  File &quot;/app/app/routers/sessions.py&quot;, line 22, in create_session&#10;    POST /api/v1/sessions/">+ Exception Group Traceback (most recent call last):
  |   File "/usr/local/lib/python3.11/site-packages/starlette/_utils.py", line 81, in collapse_excgroups
  |     yield
  |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 192, in __call__
  |     async with anyio.create_task_group() as task_group:
  |   File "/usr/local/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 783, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/usr/local/lib/python3.11/site-packages/_pytest/runner.py", line 341, in from_call
    |     result: Optional[TResult] = func()
    |                                 ^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/_pytest/runner.py", line 262, in &lt;lambda&gt;
    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise
    |             ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/_pytest/runner.py", line 177, in pytest_runtest_call
    |     raise e
    |   File "/usr/local/lib/python3.11/site-packages/_pytest/runner.py", line 169, in pytest_runtest_call
    |     item.runtest()
    |   File "/usr/local/lib/python3.11/site-packages/_pytest/python.py", line 1792, in runtest
    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/_pytest/python.py", line 194, in pytest_pyfunc_call
    |     result = testfunction(**testargs)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/tests/integration/test_session_endpoints.py", line 458, in test_session_creation_with_ai_service_error
    |     response = client.post("/api/v1/sessions/", json=session_data)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/testclient.py", line 546, in post
    |     return super().post(
    |            ^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1132, in post
    |     return self.request(
    |            ^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/testclient.py", line 445, in request
    |     return super().request(
    |            ^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 814, in request
    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 901, in send
    |     response = self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 929, in _send_handling_auth
    |     response = self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 966, in _send_handling_redirects
    |     response = self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1002, in _send_single_request
    |     response = transport.handle_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/testclient.py", line 348, in handle_request
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/testclient.py", line 345, in handle_request
    |     portal.call(self.app, scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/anyio/from_thread.py", line 334, in call
    |     return cast(T_Retval, self.start_task_soon(func, *args).result())
    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/concurrent/futures/_base.py", line 456, in result
    |     return self.__get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    |     raise self._exception
    |   File "/usr/local/lib/python3.11/site-packages/anyio/from_thread.py", line 259, in _call_func
    |     retval = await retval_or_awaitable
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1134, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 107, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 186, in __call__
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |   File "/usr/local/lib/python3.11/contextlib.py", line 158, in __exit__
    |     self.gen.throw(typ, value, traceback)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_utils.py", line 87, in collapse_excgroups
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/app/middleware/rate_limiting_middleware.py", line 51, in dispatch
    |     return await call_next(request)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/app/app/middleware/rate_limiting_middleware.py", line 40, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |   File "/usr/local/lib/python3.11/contextlib.py", line 158, in __exit__
    |     self.gen.throw(typ, value, traceback)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_utils.py", line 87, in collapse_excgroups
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/app/main.py", line 179, in logging_middleware
    |     return await log_requests(request, call_next)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/app/middleware/logging_middleware.py", line 29, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |   File "/usr/local/lib/python3.11/contextlib.py", line 158, in __exit__
    |     self.gen.throw(typ, value, traceback)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_utils.py", line 87, in collapse_excgroups
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/app/middleware/security_middleware.py", line 23, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |   File "/usr/local/lib/python3.11/contextlib.py", line 158, in __exit__
    |     self.gen.throw(typ, value, traceback)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_utils.py", line 87, in collapse_excgroups
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/app/middleware/file_upload_middleware.py", line 222, in dispatch
    |     return await call_next(request)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |   File "/usr/local/lib/python3.11/contextlib.py", line 158, in __exit__
    |     self.gen.throw(typ, value, traceback)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_utils.py", line 87, in collapse_excgroups
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/app/middleware/file_upload_middleware.py", line 139, in dispatch
    |     return await call_next(request)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |   File "/usr/local/lib/python3.11/contextlib.py", line 158, in __exit__
    |     self.gen.throw(typ, value, traceback)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_utils.py", line 87, in collapse_excgroups
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/app/middleware/file_upload_middleware.py", line 30, in dispatch
    |     return await call_next(request)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 87, in __call__
    |     await self.app(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 119, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 105, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 446, in app
    |     content = await serialize_response(
    |               ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 284, in serialize_response
    |     raise ResponseValidationError(
    | fastapi.exceptions.ResponseValidationError: 4 validation errors:
    |   {'type': 'string_type', 'loc': ('response', 'id'), 'msg': 'Input should be a valid string', 'input': UUID('29efd216-3366-4f5a-90dd-5b9ff68eaa0f')}
    |   {'type': 'string_type', 'loc': ('response', 'user_id'), 'msg': 'Input should be a valid string', 'input': UUID('01a5e78a-49e1-40e7-af8e-17098c4f77c3')}
    |   {'type': 'string_type', 'loc': ('response', 'created_at'), 'msg': 'Input should be a valid string', 'input': datetime.datetime(2026, 2, 13, 0, 45, 20, 714183, tzinfo=datetime.timezone.utc)}
    |   {'type': 'string_type', 'loc': ('response', 'updated_at'), 'msg': 'Input should be a valid string', 'input': datetime.datetime(2026, 2, 13, 0, 45, 20, 714184, tzinfo=datetime.timezone.utc)}
    | 
    |   File "/app/app/routers/sessions.py", line 22, in create_session
    |     POST /api/v1/sessions/
    +------------------------------------

The above exception was the direct cause of the following exception:

self = &lt;tests.integration.test_session_endpoints.TestSessionEndpoints object at 0xffff724b91d0&gt;, client = &lt;starlette.testclient.TestClient object at 0xffff6b5d4790&gt;
sample_user = &lt;User(id=01a5e78a-49e1-40e7-af8e-17098c4f77c3, email=test-24eb1a4f@example.com, name=Test User)&gt;, override_auth = &lt;function override_auth.&lt;locals&gt;._override at 0xffff6b940040&gt;
override_ai_client = &lt;function override_ai_client.&lt;locals&gt;._override at 0xffff6b940a40&gt;

    @pytest.mark.integration
    def test_session_creation_with_ai_service_error(self, client, sample_user, override_auth, override_ai_client):
        """Test session creation when AI service fails."""
        override_auth({"id": str(sample_user.id), "email": sample_user.email, "is_admin": False})
    
        mock_ai_client = AsyncMock()
        mock_ai_client.generate_questions.side_effect = Exception("AI service error")
        override_ai_client(mock_ai_client)
    
        session_data = {
            "user_id": str(sample_user.id),
            "mode": "interview",
            "role": "Python Developer",
            "job_title": "Python Developer",
            "job_description": "Looking for Python developer"
        }
    
&gt;       response = client.post("/api/v1/sessions/", json=session_data)

tests/integration/test_session_endpoints.py:458: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:546: in post
    return super().post(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:1132: in post
    return self.request(
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:445: in request
    return super().request(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:814: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
/usr/local/lib/python3.11/site-packages/httpx/_client.py:901: in send
    response = self._send_handling_auth(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:929: in _send_handling_auth
    response = self._send_handling_redirects(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:966: in _send_handling_redirects
    response = self._send_single_request(request)
/usr/local/lib/python3.11/site-packages/httpx/_client.py:1002: in _send_single_request
    response = transport.handle_request(request)
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:348: in handle_request
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:345: in handle_request
    portal.call(self.app, scope, receive, send)
/usr/local/lib/python3.11/site-packages/anyio/from_thread.py:334: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
/usr/local/lib/python3.11/concurrent/futures/_base.py:456: in result
    return self.__get_result()
/usr/local/lib/python3.11/concurrent/futures/_base.py:401: in __get_result
    raise self._exception
/usr/local/lib/python3.11/site-packages/anyio/from_thread.py:259: in _call_func
    retval = await retval_or_awaitable
/usr/local/lib/python3.11/site-packages/fastapi/applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/applications.py:107: in __call__
    await self.middleware_stack(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/rate_limiting_middleware.py:51: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
app/middleware/rate_limiting_middleware.py:40: in dispatch
    response = await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/main.py:179: in logging_middleware
    return await log_requests(request, call_next)
app/middleware/logging_middleware.py:29: in log_requests
    response = await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/security_middleware.py:23: in dispatch
    response = await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/file_upload_middleware.py:222: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/file_upload_middleware.py:139: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/file_upload_middleware.py:30: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py:87: in __call__
    await self.app(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:119: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:105: in app
    response = await f(request)
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:446: in app
    content = await serialize_response(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    async def serialize_response(
        *,
        field: ModelField | None = None,
        response_content: Any,
        include: IncEx | None = None,
        exclude: IncEx | None = None,
        by_alias: bool = True,
        exclude_unset: bool = False,
        exclude_defaults: bool = False,
        exclude_none: bool = False,
        is_coroutine: bool = True,
        endpoint_ctx: EndpointContext | None = None,
    ) -&gt; Any:
        if field:
            if is_coroutine:
                value, errors = field.validate(response_content, {}, loc=("response",))
            else:
                value, errors = await run_in_threadpool(
                    field.validate, response_content, {}, loc=("response",)
                )
            if errors:
                ctx = endpoint_ctx or EndpointContext()
&gt;               raise ResponseValidationError(
                    errors=errors,
                    body=response_content,
                    endpoint_ctx=ctx,
                )
E               fastapi.exceptions.ResponseValidationError: 4 validation errors:
E                 {'type': 'string_type', 'loc': ('response', 'id'), 'msg': 'Input should be a valid string', 'input': UUID('29efd216-3366-4f5a-90dd-5b9ff68eaa0f')}
E                 {'type': 'string_type', 'loc': ('response', 'user_id'), 'msg': 'Input should be a valid string', 'input': UUID('01a5e78a-49e1-40e7-af8e-17098c4f77c3')}
E                 {'type': 'string_type', 'loc': ('response', 'created_at'), 'msg': 'Input should be a valid string', 'input': datetime.datetime(2026, 2, 13, 0, 45, 20, 714183, tzinfo=datetime.timezone.utc)}
E                 {'type': 'string_type', 'loc': ('response', 'updated_at'), 'msg': 'Input should be a valid string', 'input': datetime.datetime(2026, 2, 13, 0, 45, 20, 714184, tzinfo=datetime.timezone.utc)}
E               
E                 File "/app/app/routers/sessions.py", line 22, in create_session
E                   POST /api/v1/sessions/

/usr/local/lib/python3.11/site-packages/fastapi/routing.py:284: ResponseValidationError</failure></testcase><testcase classname="tests.integration.test_session_endpoints.TestSessionEndpoints" name="test_session_creation_with_database_error" time="0.115"><failure message="Exception: Database error">+ Exception Group Traceback (most recent call last):
  |   File "/usr/local/lib/python3.11/site-packages/starlette/_utils.py", line 81, in collapse_excgroups
  |     yield
  |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 192, in __call__
  |     async with anyio.create_task_group() as task_group:
  |   File "/usr/local/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 783, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/usr/local/lib/python3.11/site-packages/_pytest/runner.py", line 341, in from_call
    |     result: Optional[TResult] = func()
    |                                 ^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/_pytest/runner.py", line 262, in &lt;lambda&gt;
    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise
    |             ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/_pytest/runner.py", line 177, in pytest_runtest_call
    |     raise e
    |   File "/usr/local/lib/python3.11/site-packages/_pytest/runner.py", line 169, in pytest_runtest_call
    |     item.runtest()
    |   File "/usr/local/lib/python3.11/site-packages/_pytest/python.py", line 1792, in runtest
    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/_pytest/python.py", line 194, in pytest_pyfunc_call
    |     result = testfunction(**testargs)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/tests/integration/test_session_endpoints.py", line 484, in test_session_creation_with_database_error
    |     response = client.post("/api/v1/sessions/", json=session_data)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/testclient.py", line 546, in post
    |     return super().post(
    |            ^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1132, in post
    |     return self.request(
    |            ^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/testclient.py", line 445, in request
    |     return super().request(
    |            ^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 814, in request
    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 901, in send
    |     response = self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 929, in _send_handling_auth
    |     response = self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 966, in _send_handling_redirects
    |     response = self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/httpx/_client.py", line 1002, in _send_single_request
    |     response = transport.handle_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/testclient.py", line 348, in handle_request
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/testclient.py", line 345, in handle_request
    |     portal.call(self.app, scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/anyio/from_thread.py", line 334, in call
    |     return cast(T_Retval, self.start_task_soon(func, *args).result())
    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/concurrent/futures/_base.py", line 456, in result
    |     return self.__get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    |     raise self._exception
    |   File "/usr/local/lib/python3.11/site-packages/anyio/from_thread.py", line 259, in _call_func
    |     retval = await retval_or_awaitable
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1134, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 107, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 186, in __call__
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |   File "/usr/local/lib/python3.11/contextlib.py", line 158, in __exit__
    |     self.gen.throw(typ, value, traceback)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_utils.py", line 87, in collapse_excgroups
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/app/middleware/rate_limiting_middleware.py", line 51, in dispatch
    |     return await call_next(request)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/app/app/middleware/rate_limiting_middleware.py", line 40, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |   File "/usr/local/lib/python3.11/contextlib.py", line 158, in __exit__
    |     self.gen.throw(typ, value, traceback)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_utils.py", line 87, in collapse_excgroups
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/app/main.py", line 179, in logging_middleware
    |     return await log_requests(request, call_next)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/app/middleware/logging_middleware.py", line 29, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |   File "/usr/local/lib/python3.11/contextlib.py", line 158, in __exit__
    |     self.gen.throw(typ, value, traceback)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_utils.py", line 87, in collapse_excgroups
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/app/middleware/security_middleware.py", line 23, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |   File "/usr/local/lib/python3.11/contextlib.py", line 158, in __exit__
    |     self.gen.throw(typ, value, traceback)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_utils.py", line 87, in collapse_excgroups
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/app/middleware/file_upload_middleware.py", line 222, in dispatch
    |     return await call_next(request)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |   File "/usr/local/lib/python3.11/contextlib.py", line 158, in __exit__
    |     self.gen.throw(typ, value, traceback)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_utils.py", line 87, in collapse_excgroups
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/app/middleware/file_upload_middleware.py", line 139, in dispatch
    |     return await call_next(request)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |   File "/usr/local/lib/python3.11/contextlib.py", line 158, in __exit__
    |     self.gen.throw(typ, value, traceback)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_utils.py", line 87, in collapse_excgroups
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/app/middleware/file_upload_middleware.py", line 30, in dispatch
    |     return await call_next(request)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 87, in __call__
    |     await self.app(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 119, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 105, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 424, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 312, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/app/routers/sessions.py", line 40, in create_session
    |     session = await session_service.create_interview_session(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/unittest/mock.py", line 1124, in __call__
    |     return self._mock_call(*args, **kwargs)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/unittest/mock.py", line 1128, in _mock_call
    |     return self._execute_mock_call(*args, **kwargs)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/unittest/mock.py", line 1183, in _execute_mock_call
    |     raise effect
    | Exception: Database error
    +------------------------------------

The above exception was the direct cause of the following exception:

self = &lt;tests.integration.test_session_endpoints.TestSessionEndpoints object at 0xffff724b9c90&gt;, client = &lt;starlette.testclient.TestClient object at 0xffff6b8a7310&gt;
sample_user = &lt;User(id=dad1f9ca-c74d-4475-b825-3ca5cc0c7df4, email=test-7e51e08a@example.com, name=Test User)&gt;, override_auth = &lt;function override_auth.&lt;locals&gt;._override at 0xffff6b9a3060&gt;
override_ai_client = &lt;function override_ai_client.&lt;locals&gt;._override at 0xffff6b9a2700&gt;, mock_ai_client = &lt;AsyncMock id='281472485981264'&gt;

    @pytest.mark.integration
    def test_session_creation_with_database_error(
        self, client, sample_user, override_auth, override_ai_client, mock_ai_client
    ):
        """Test session creation when database fails."""
        override_auth({"id": str(sample_user.id), "email": sample_user.email, "is_admin": False})
        override_ai_client(mock_ai_client)
    
        session_data = {
            "user_id": str(sample_user.id),
            "mode": "interview",
            "role": "Python Developer",
            "job_title": "Python Developer",
            "job_description": "Looking for Python developer"
        }
    
        with patch("app.routers.sessions.SessionService") as mock_session_service:
            mock_instance = mock_session_service.return_value
            mock_instance.create_interview_session.side_effect = Exception("Database error")
    
&gt;           response = client.post("/api/v1/sessions/", json=session_data)

tests/integration/test_session_endpoints.py:484: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:546: in post
    return super().post(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:1132: in post
    return self.request(
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:445: in request
    return super().request(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:814: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
/usr/local/lib/python3.11/site-packages/httpx/_client.py:901: in send
    response = self._send_handling_auth(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:929: in _send_handling_auth
    response = self._send_handling_redirects(
/usr/local/lib/python3.11/site-packages/httpx/_client.py:966: in _send_handling_redirects
    response = self._send_single_request(request)
/usr/local/lib/python3.11/site-packages/httpx/_client.py:1002: in _send_single_request
    response = transport.handle_request(request)
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:348: in handle_request
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/testclient.py:345: in handle_request
    portal.call(self.app, scope, receive, send)
/usr/local/lib/python3.11/site-packages/anyio/from_thread.py:334: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
/usr/local/lib/python3.11/concurrent/futures/_base.py:456: in result
    return self.__get_result()
/usr/local/lib/python3.11/concurrent/futures/_base.py:401: in __get_result
    raise self._exception
/usr/local/lib/python3.11/site-packages/anyio/from_thread.py:259: in _call_func
    retval = await retval_or_awaitable
/usr/local/lib/python3.11/site-packages/fastapi/applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/applications.py:107: in __call__
    await self.middleware_stack(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/rate_limiting_middleware.py:51: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
app/middleware/rate_limiting_middleware.py:40: in dispatch
    response = await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/main.py:179: in logging_middleware
    return await log_requests(request, call_next)
app/middleware/logging_middleware.py:29: in log_requests
    response = await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/security_middleware.py:23: in dispatch
    response = await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/file_upload_middleware.py:222: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/file_upload_middleware.py:139: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
/usr/local/lib/python3.11/contextlib.py:158: in __exit__
    self.gen.throw(typ, value, traceback)
/usr/local/lib/python3.11/site-packages/starlette/_utils.py:87: in collapse_excgroups
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware/file_upload_middleware.py:30: in dispatch
    return await call_next(request)
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py:87: in __call__
    await self.app(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:119: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:105: in app
    response = await f(request)
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:424: in app
    raw_response = await run_endpoint_function(
/usr/local/lib/python3.11/site-packages/fastapi/routing.py:312: in run_endpoint_function
    return await dependant.call(**values)
app/routers/sessions.py:40: in create_session
    session = await session_service.create_interview_session(
/usr/local/lib/python3.11/unittest/mock.py:1124: in __call__
    return self._mock_call(*args, **kwargs)
/usr/local/lib/python3.11/unittest/mock.py:1128: in _mock_call
    return self._execute_mock_call(*args, **kwargs)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;MagicMock name='SessionService().create_interview_session' id='281472485540688'&gt;, args = ()
kwargs = {'job_description': 'Looking for Python developer', 'job_title': 'Python Developer', 'role': 'Python Developer', 'user_id': 'dad1f9ca-c74d-4475-b825-3ca5cc0c7df4'}
effect = Exception('Database error')

    def _execute_mock_call(self, /, *args, **kwargs):
        # separate from _increment_mock_call so that awaited functions are
        # executed separately from their call, also AsyncMock overrides this method
    
        effect = self.side_effect
        if effect is not None:
            if _is_exception(effect):
&gt;               raise effect
E               Exception: Database error

/usr/local/lib/python3.11/unittest/mock.py:1183: Exception</failure></testcase><testcase classname="tests.integration.test_speech_endpoints" name="test_synthesize_speech_success" time="0.012" /><testcase classname="tests.integration.test_speech_endpoints" name="test_synthesize_speech_rate_limit_error" time="0.011" /><testcase classname="tests.integration.test_speech_endpoints" name="test_synthesize_speech_requires_admin" time="0.009" /><testcase classname="tests.integration.test_tts_fallback.TestTTSFallbackBehavior" name="test_fallback_to_secondary_provider" time="0.008" /><testcase classname="tests.integration.test_tts_fallback.TestTTSFallbackBehavior" name="test_fallback_both_providers_fail" time="0.010" /><testcase classname="tests.integration.test_tts_fallback.TestTTSFallbackBehavior" name="test_circuit_breaker_prevents_execution" time="0.006" /><testcase classname="tests.integration.test_tts_fallback.TestTTSFallbackBehavior" name="test_circuit_breaker_half_open_recovery" time="0.005" /><testcase classname="tests.integration.test_tts_fallback.TestTTSProviderFactoryIntegration" name="test_factory_creates_coqui_provider" time="0.002"><failure message="AssertionError: assert False&#10; +  where False = isinstance(&lt;app.services.tts.coqui.CoquiTTSProvider object at 0xffff6ad3b250&gt;, &lt;class 'abc.ABCMeta'&gt;)&#10; +    where &lt;class 'abc.ABCMeta'&gt; = type(&lt;class 'app.services.tts.coqui.CoquiTTSProvider'&gt;)">self = &lt;tests.integration.test_tts_fallback.TestTTSProviderFactoryIntegration object at 0xffff724ae350&gt;

    @pytest.mark.integration
    def test_factory_creates_coqui_provider(self):
        """Test factory creates Coqui provider with correct config."""
        with patch("app.services.tts.factory.get_settings") as mock_settings:
            mock_settings.return_value.TTS_PROVIDER = "coqui"
            mock_settings.return_value.TTS_DEFAULT_VOICE_ID = "test-voice"
            mock_settings.return_value.TTS_VOICE_VERSION = 1
            mock_settings.return_value.TTS_TIMEOUT = 30
            mock_settings.return_value.ELEVENLABS_API_KEY = ""
            mock_settings.return_value.PLAYHT_API_KEY = ""
            mock_settings.return_value.PLAYHT_USER_ID = ""
    
            provider = TTSProviderFactory.create_provider("coqui")
    
            assert provider is not None
&gt;           assert isinstance(provider, type(TTSProviderFactory.PROVIDER_REGISTRY["coqui"]))
E           AssertionError: assert False
E            +  where False = isinstance(&lt;app.services.tts.coqui.CoquiTTSProvider object at 0xffff6ad3b250&gt;, &lt;class 'abc.ABCMeta'&gt;)
E            +    where &lt;class 'abc.ABCMeta'&gt; = type(&lt;class 'app.services.tts.coqui.CoquiTTSProvider'&gt;)

tests/integration/test_tts_fallback.py:132: AssertionError</failure></testcase><testcase classname="tests.integration.test_tts_fallback.TestTTSProviderFactoryIntegration" name="test_factory_validates_api_keys" time="0.001" /><testcase classname="tests.integration.test_tts_fallback.TestTTSRetryAndFallbackIntegration" name="test_retry_then_fallback" time="0.008" /><testcase classname="tests.integration.test_tts_fallback.TestTTSRetryAndFallbackIntegration" name="test_primary_succeeds_after_retry" time="0.007" /><testcase classname="tests.integration.test_websocket_endpoints.TestWebSocketEndpoints" name="test_websocket_health_endpoint" time="0.009" /><testcase classname="tests.integration.test_websocket_endpoints.TestWebSocketEndpoints" name="test_websocket_connection_establishment" time="0.014" /><testcase classname="tests.integration.test_websocket_endpoints.TestWebSocketEndpoints" name="test_websocket_authentication_required" time="0.007" /><testcase classname="tests.integration.test_websocket_endpoints.TestWebSocketEndpoints" name="test_websocket_ping_pong" time="0.009" /><testcase classname="tests.integration.test_websocket_endpoints.TestWebSocketEndpoints" name="test_websocket_transcript_message" time="0.010" /><testcase classname="tests.integration.test_websocket_endpoints.TestWebSocketEndpoints" name="test_websocket_audio_chunk_message" time="0.010" /><testcase classname="tests.integration.test_websocket_endpoints.TestWebSocketEndpoints" name="test_websocket_binary_audio_data" time="0.009" /><testcase classname="tests.integration.test_websocket_endpoints.TestWebSocketEndpoints" name="test_websocket_metadata_update" time="0.014" /><testcase classname="tests.integration.test_websocket_endpoints.TestWebSocketEndpoints" name="test_websocket_invalid_json" time="0.009" /><testcase classname="tests.integration.test_websocket_endpoints.TestWebSocketEndpoints" name="test_websocket_connection_management" time="0.009" /><testcase classname="tests.integration.test_websocket_endpoints.TestWebSocketEndpoints" name="test_websocket_error_handling" time="0.011" /><testcase classname="tests.integration.test_websocket_endpoints.TestWebSocketEndpoints" name="test_websocket_multiple_messages" time="0.013" /><testcase classname="tests.integration.test_websocket_endpoints.TestWebSocketEndpoints" name="test_websocket_question_id_parameter" time="0.009" /><testcase classname="tests.unit.test_analytics_service.TestScoreExtraction" name="test_extract_score_none" time="0.002" /><testcase classname="tests.unit.test_analytics_service.TestScoreExtraction" name="test_extract_score_float" time="0.002" /><testcase classname="tests.unit.test_analytics_service.TestScoreExtraction" name="test_extract_score_int" time="0.002" /><testcase classname="tests.unit.test_analytics_service.TestScoreExtraction" name="test_extract_score_dict_overall" time="0.002" /><testcase classname="tests.unit.test_analytics_service.TestScoreExtraction" name="test_extract_score_dict_average" time="0.002" /><testcase classname="tests.unit.test_analytics_service.TestScoreExtraction" name="test_extract_score_dict_unknown_keys" time="0.001" /><testcase classname="tests.unit.test_analytics_service.TestScoreExtraction" name="test_extract_dimension_scores" time="0.001" /><testcase classname="tests.unit.test_analytics_service.TestScoreExtraction" name="test_extract_dimension_scores_non_dict" time="0.002" /><testcase classname="tests.unit.test_analytics_service.TestPerformanceMetrics" name="test_no_sessions_returns_empty" time="0.108" /><testcase classname="tests.unit.test_analytics_service.TestPerformanceMetrics" name="test_with_sessions" time="0.111" /><testcase classname="tests.unit.test_analytics_service.TestPerformanceMetrics" name="test_improvement_trend_calculation" time="0.112" /><testcase classname="tests.unit.test_analytics_service.TestTrendAnalysis" name="test_no_sessions" time="0.103" /><testcase classname="tests.unit.test_analytics_service.TestTrendAnalysis" name="test_with_sessions" time="0.112" /><testcase classname="tests.unit.test_analytics_service.TestTrendAnalysis" name="test_completion_rate_metric" time="0.113" /><testcase classname="tests.unit.test_analytics_service.TestTrendAnalysis" name="test_total_sessions_metric" time="0.111" /><testcase classname="tests.unit.test_analytics_service.TestSessionAnalytics" name="test_returns_list" time="0.113" /><testcase classname="tests.unit.test_analytics_service.TestSessionAnalytics" name="test_pagination" time="0.116" /><testcase classname="tests.unit.test_analytics_service.TestSessionAnalytics" name="test_empty_for_unknown_user" time="0.002" /><testcase classname="tests.unit.test_analytics_service.TestAnalyticsSummary" name="test_summary_structure" time="0.125" /><testcase classname="tests.unit.test_analytics_service.TestAnalyticsSummary" name="test_summary_empty_user" time="0.123" /><testcase classname="tests.unit.test_analytics_service.TestPerformanceComparison" name="test_comparison_returns_model" time="0.147" /><testcase classname="tests.unit.test_analytics_service.TestPerformanceComparison" name="test_comparison_no_sessions" time="0.111" /><testcase classname="tests.unit.test_analytics_service.TestDimensionProgress" name="test_dimension_progress" time="0.112" /><testcase classname="tests.unit.test_analytics_service.TestDimensionProgress" name="test_dimension_progress_no_sessions" time="0.104" /><testcase classname="tests.unit.test_analytics_service.TestSessionComparison" name="test_compare_two_sessions" time="0.111" /><testcase classname="tests.unit.test_analytics_service.TestSessionComparison" name="test_compare_sessions_not_found" time="0.106" /><testcase classname="tests.unit.test_analytics_service.TestFilteredSessions" name="test_filter_by_role" time="0.115" /><testcase classname="tests.unit.test_analytics_service.TestFilteredSessions" name="test_filter_by_status" time="0.115" /><testcase classname="tests.unit.test_analytics_service.TestFilteredSessions" name="test_filter_by_score_range" time="0.116" /><testcase classname="tests.unit.test_analytics_service.TestFilteredSessions" name="test_filter_pagination" time="0.117" /><testcase classname="tests.unit.test_analytics_service.TestFilteredSessions" name="test_filters_applied_tracking" time="0.110" /><testcase classname="tests.unit.test_analytics_service.TestPerformanceHeatmap" name="test_heatmap_structure" time="0.110" /><testcase classname="tests.unit.test_analytics_service.TestPerformanceHeatmap" name="test_heatmap_no_sessions" time="0.103" /><testcase classname="tests.unit.test_analytics_service.TestPerformanceHeatmap" name="test_heatmap_cell_fields" time="0.109" /><testcase classname="tests.unit.test_analytics_service.TestReportGeneration" name="test_generate_report" time="0.111" /><testcase classname="tests.unit.test_analytics_service.TestReportGeneration" name="test_generate_csv_report" time="0.110" /><testcase classname="tests.unit.test_analytics_service.TestReportGeneration" name="test_report_with_no_sessions" time="0.112" /><testcase classname="tests.unit.test_analytics_service.TestGoalManagement" name="test_create_goal" time="0.105" /><testcase classname="tests.unit.test_analytics_service.TestGoalManagement" name="test_list_goals" time="0.111" /><testcase classname="tests.unit.test_analytics_service.TestGoalManagement" name="test_list_goals_with_status_filter" time="0.107" /><testcase classname="tests.unit.test_analytics_service.TestGoalManagement" name="test_get_goal" time="0.109" /><testcase classname="tests.unit.test_analytics_service.TestGoalManagement" name="test_get_goal_not_found" time="0.106" /><testcase classname="tests.unit.test_analytics_service.TestGoalManagement" name="test_update_goal" time="0.109" /><testcase classname="tests.unit.test_analytics_service.TestGoalManagement" name="test_update_goal_status" time="0.110" /><testcase classname="tests.unit.test_analytics_service.TestGoalManagement" name="test_delete_goal" time="0.109" /><testcase classname="tests.unit.test_analytics_service.TestGoalManagement" name="test_delete_goal_not_found" time="0.105" /><testcase classname="tests.unit.test_analytics_service.TestGoalManagement" name="test_goal_progress_percentage" time="0.115" /><testcase classname="tests.unit.test_analytics_service.TestGoalManagement" name="test_create_dimension_goal" time="0.110" /><testcase classname="tests.unit.test_analytics_service.TestAnalyticsEventLogging" name="test_log_event_does_not_raise" time="0.104" /><testcase classname="tests.unit.test_analytics_service.TestRecommendations" name="test_low_score_recommendation" time="0.001" /><testcase classname="tests.unit.test_analytics_service.TestRecommendations" name="test_low_completion_recommendation" time="0.001" /><testcase classname="tests.unit.test_analytics_service.TestRecommendations" name="test_few_sessions_recommendation" time="0.001" /><testcase classname="tests.unit.test_analytics_service.TestRecommendations" name="test_good_performance_recommendation" time="0.001" /><testcase classname="tests.unit.test_answer_audio_file_persistence.TestAnswerAudioFilePersistence" name="test_answer_with_audio_file_id" time="0.005" /><testcase classname="tests.unit.test_answer_audio_file_persistence.TestAnswerAudioFilePersistence" name="test_answer_without_audio_file_id" time="0.005" /><testcase classname="tests.unit.test_answer_audio_file_persistence.TestAnswerAudioFilePersistence" name="test_session_question_context_with_audio_file_id" time="0.109" /><testcase classname="tests.unit.test_answer_audio_file_persistence.TestAnswerAudioFilePersistence" name="test_session_question_context_update_audio_file_id" time="0.112" /><testcase classname="tests.unit.test_answer_audio_file_persistence.TestAnswerAudioFilePersistence" name="test_answer_and_session_question_linked_audio_file_id" time="0.111" /><testcase classname="tests.unit.test_dashboard_service.TestDashboardService" name="test_get_dashboard_overview" time="0.107" /><testcase classname="tests.unit.test_dashboard_service.TestDashboardService" name="test_get_dashboard_overview_no_sessions" time="0.108" /><testcase classname="tests.unit.test_dashboard_service.TestDashboardService" name="test_get_user_progress" time="0.105" /><testcase classname="tests.unit.test_dashboard_service.TestDashboardService" name="test_get_analytics_data" time="0.107" /><testcase classname="tests.unit.test_dashboard_service.TestDashboardService" name="test_get_performance_metrics" time="0.105" /><testcase classname="tests.unit.test_dashboard_service.TestDashboardService" name="test_get_performance_trends" time="0.108" /><testcase classname="tests.unit.test_dashboard_service.TestDashboardService" name="test_get_user_insights" time="0.107" /><testcase classname="tests.unit.test_data_aggregator.TestDataAggregator" name="test_get_user_sessions_summary_no_sessions" time="0.104" /><testcase classname="tests.unit.test_data_aggregator.TestDataAggregator" name="test_get_user_sessions_summary_with_sessions" time="0.105" /><testcase classname="tests.unit.test_data_aggregator.TestDataAggregator" name="test_get_user_sessions_summary_with_date_range" time="0.105" /><testcase classname="tests.unit.test_data_aggregator.TestDataAggregator" name="test_get_user_progress_data" time="0.113" /><testcase classname="tests.unit.test_data_aggregator.TestDataAggregator" name="test_get_recent_activity" time="0.108" /><testcase classname="tests.unit.test_data_aggregator.TestDataAggregator" name="test_get_current_streak" time="0.112" /><testcase classname="tests.unit.test_data_aggregator.TestDataAggregator" name="test_get_current_streak_no_activity" time="0.106" /><testcase classname="tests.unit.test_data_aggregator.TestDataAggregator" name="test_get_skill_breakdown" time="0.108" /><testcase classname="tests.unit.test_data_aggregator.TestDataAggregator" name="test_get_performance_metrics_detailed" time="0.106" /><testcase classname="tests.unit.test_data_aggregator.TestDataAggregator" name="test_get_trend_data" time="0.108" /><testcase classname="tests.unit.test_data_aggregator.TestDataAggregator" name="test_get_user_insights" time="0.106" /><testcase classname="tests.unit.test_database_models.TestUserModel" name="test_create_user" time="0.004" /><testcase classname="tests.unit.test_database_models.TestUserModel" name="test_user_email_unique" time="0.004" /><testcase classname="tests.unit.test_database_models.TestUserModel" name="test_user_relationships" time="0.108" /><testcase classname="tests.unit.test_database_models.TestInterviewSessionModel" name="test_create_interview_session" time="0.104" /><testcase classname="tests.unit.test_database_models.TestInterviewSessionModel" name="test_interview_session_user_relationship" time="0.105" /><testcase classname="tests.unit.test_database_models.TestInterviewSessionModel" name="test_interview_session_status_enum" time="0.113" /><testcase classname="tests.unit.test_database_models.TestQuestionModel" name="test_create_question" time="0.004" /><testcase classname="tests.unit.test_database_models.TestQuestionModel" name="test_question_category_required" time="0.003" /><testcase classname="tests.unit.test_database_models.TestQuestionModel" name="test_question_difficulty_levels" time="0.006" /><testcase classname="tests.unit.test_database_models.TestSessionQuestionModel" name="test_create_session_question" time="0.107" /><testcase classname="tests.unit.test_database_models.TestSessionQuestionModel" name="test_session_question_relationships" time="0.112" /><testcase classname="tests.unit.test_database_models.TestSessionQuestionModel" name="test_session_question_cascade_delete" time="0.112" /><testcase classname="tests.unit.test_database_models.TestAnswerModel" name="test_create_answer" time="0.005" /><testcase classname="tests.unit.test_database_models.TestAnswerModel" name="test_answer_question_relationship" time="0.005" /><testcase classname="tests.unit.test_database_models.TestAnswerModel" name="test_answer_cascade_delete" time="0.007" /><testcase classname="tests.unit.test_database_models.TestModelRelationships" name="test_complete_interview_flow" time="0.116" /><testcase classname="tests.unit.test_file_service.TestFileService" name="test_save_file_from_bytes_mp3" time="0.003" /><testcase classname="tests.unit.test_file_service.TestFileService" name="test_save_file_from_bytes_wav" time="0.003" /><testcase classname="tests.unit.test_file_service.TestFileService" name="test_save_file_from_bytes_with_metadata" time="0.003" /><testcase classname="tests.unit.test_file_service.TestFileService" name="test_save_file_from_bytes_auto_filename" time="0.003" /><testcase classname="tests.unit.test_file_service.TestFileService" name="test_save_file_from_bytes_auto_mime_type" time="0.004" /><testcase classname="tests.unit.test_file_service.TestFileService" name="test_get_file_info_with_metadata" time="0.004" /><testcase classname="tests.unit.test_file_service.TestFileService" name="test_get_file_info_without_metadata" time="0.003" /><testcase classname="tests.unit.test_file_service.TestFileService" name="test_find_file_in_flat_structure" time="0.005" /><testcase classname="tests.unit.test_file_service.TestFileService" name="test_find_file_in_nested_structure" time="0.004" /><testcase classname="tests.unit.test_file_service.TestFileService" name="test_get_file_path_nested_structure" time="0.003" /><testcase classname="tests.unit.test_file_service.TestFileService" name="test_get_file_path_flat_structure" time="0.002" /><testcase classname="tests.unit.test_file_service.TestFileService" name="test_should_use_nested_structure" time="0.003" /><testcase classname="tests.unit.test_file_service.TestFileService" name="test_get_file_extension" time="0.003" /><testcase classname="tests.unit.test_file_service.TestFileService" name="test_normalize_audio_filename_and_mime" time="0.003" /><testcase classname="tests.unit.test_file_service.TestFileService" name="test_matches_file_id" time="0.004" /><testcase classname="tests.unit.test_file_service.TestFileService" name="test_save_file_with_metadata" time="0.004" /><testcase classname="tests.unit.test_file_service.TestFileServiceIntegration" name="test_save_retrieve_download_flow" time="0.004" /><testcase classname="tests.unit.test_file_service.TestFileServiceIntegration" name="test_multiple_formats_save_retrieve" time="0.004" /><testcase classname="tests.unit.test_question_bank_service.TestQuestionBankService" name="test_create_question" time="0.005" /><testcase classname="tests.unit.test_question_bank_service.TestQuestionBankService" name="test_create_question_duplicate" time="0.005" /><testcase classname="tests.unit.test_question_bank_service.TestQuestionBankService" name="test_get_question_by_id" time="0.005" /><testcase classname="tests.unit.test_question_bank_service.TestQuestionBankService" name="test_get_question_by_id_not_found" time="0.002" /><testcase classname="tests.unit.test_question_bank_service.TestQuestionBankService" name="test_get_question_by_id_invalid_format" time="0.002" /><testcase classname="tests.unit.test_question_bank_service.TestQuestionBankService" name="test_get_questions" time="0.005" /><testcase classname="tests.unit.test_question_bank_service.TestQuestionBankService" name="test_get_questions_with_category_filter" time="0.004" /><testcase classname="tests.unit.test_question_bank_service.TestQuestionBankService" name="test_get_questions_with_pagination" time="0.006" /><testcase classname="tests.unit.test_question_bank_service.TestQuestionBankService" name="test_search_questions" time="0.004" /><testcase classname="tests.unit.test_question_bank_service.TestQuestionBankService" name="test_update_question" time="0.006" /><testcase classname="tests.unit.test_question_bank_service.TestQuestionBankService" name="test_update_question_not_found" time="0.002" /><testcase classname="tests.unit.test_question_bank_service.TestQuestionBankService" name="test_delete_question" time="0.008" /><testcase classname="tests.unit.test_question_bank_service.TestQuestionBankService" name="test_delete_question_not_found" time="0.002" /><testcase classname="tests.unit.test_question_bank_service.TestQuestionBankService" name="test_get_question_suggestions" time="0.005" /><testcase classname="tests.unit.test_question_bank_service.TestQuestionBankService" name="test_bulk_import_questions" time="0.010" /><testcase classname="tests.unit.test_question_bank_service.TestQuestionBankService" name="test_bulk_import_with_duplicates" time="0.006" /><testcase classname="tests.unit.test_real_time_feedback_service.TestRealTimeFeedbackService" name="test_build_metrics_with_volume" time="0.001" /><testcase classname="tests.unit.test_real_time_feedback_service.TestRealTimeFeedbackService" name="test_build_metrics_without_volume" time="0.001" /><testcase classname="tests.unit.test_real_time_feedback_service.TestRealTimeFeedbackService" name="test_create_error_feedback" time="0.001" /><testcase classname="tests.unit.test_real_time_feedback_service.TestRealTimeFeedbackService" name="test_process_audio_chunk_success" time="0.002" /><testcase classname="tests.unit.test_real_time_feedback_service.TestRealTimeFeedbackService" name="test_process_audio_chunk_error" time="0.002" /><testcase classname="tests.unit.test_real_time_feedback_service.TestRealTimeFeedbackService" name="test_process_transcript_chunk_success" time="0.001" /><testcase classname="tests.unit.test_real_time_feedback_service.TestRealTimeFeedbackService" name="test_process_transcript_chunk_with_ai_feedback" time="0.003" /><testcase classname="tests.unit.test_real_time_feedback_service.TestRealTimeFeedbackService" name="test_process_transcript_chunk_ai_unavailable" time="0.001" /><testcase classname="tests.unit.test_real_time_feedback_service.TestRealTimeFeedbackService" name="test_register_session" time="0.001" /><testcase classname="tests.unit.test_real_time_feedback_service.TestRealTimeFeedbackService" name="test_cleanup_session" time="0.001" /><testcase classname="tests.unit.test_real_time_feedback_service.TestRealTimeFeedbackService" name="test_get_session_info_nonexistent" time="0.000" /><testcase classname="tests.unit.test_real_time_feedback_service.TestRealTimeFeedbackService" name="test_generate_feedback_message_no_suggestions" time="0.001" /><testcase classname="tests.unit.test_real_time_feedback_service.TestRealTimeFeedbackService" name="test_generate_feedback_message_with_suggestions" time="0.001" /><testcase classname="tests.unit.test_scoring_models.TestGradeTier" name="test_grade_tier_values" time="0.000" /><testcase classname="tests.unit.test_scoring_models.TestSubDimensionScore" name="test_create_sub_dimension_score_valid" time="0.000" /><testcase classname="tests.unit.test_scoring_models.TestSubDimensionScore" name="test_sub_dimension_score_validation" time="0.000" /><testcase classname="tests.unit.test_scoring_models.TestSubDimensionScore" name="test_sub_dimension_score_defaults" time="0.000" /><testcase classname="tests.unit.test_scoring_models.TestVerbalCommunicationScores" name="test_create_verbal_communication_scores" time="0.000" /><testcase classname="tests.unit.test_scoring_models.TestVerbalCommunicationScores" name="test_verbal_communication_score_validation" time="0.001" /><testcase classname="tests.unit.test_scoring_models.TestInterviewReadinessScores" name="test_create_interview_readiness_scores" time="0.000" /><testcase classname="tests.unit.test_scoring_models.TestNonVerbalCommunicationScores" name="test_create_non_verbal_scores" time="0.000" /><testcase classname="tests.unit.test_scoring_models.TestAdaptabilityEngagementScores" name="test_create_adaptability_scores" time="0.001" /><testcase classname="tests.unit.test_scoring_models.TestEnhancedScoringRubric" name="test_create_enhanced_rubric" time="0.001" /><testcase classname="tests.unit.test_scoring_models.TestEnhancedScoringRubric" name="test_enhanced_rubric_total_score_validation" time="0.000" /><testcase classname="tests.unit.test_scoring_models.TestAgentScore" name="test_create_agent_score" time="0.000" /><testcase classname="tests.unit.test_scoring_models.TestAgentScore" name="test_agent_score_validation" time="0.000" /><testcase classname="tests.unit.test_scoring_models.TestScoringWeights" name="test_create_scoring_weights" time="0.001" /><testcase classname="tests.unit.test_scoring_models.TestScoringWeights" name="test_scoring_weights_defaults" time="0.001" /><testcase classname="tests.unit.test_scoring_utils.TestGradeTierCalculation" name="test_excellent_tier" time="0.000" /><testcase classname="tests.unit.test_scoring_utils.TestGradeTierCalculation" name="test_strong_tier" time="0.001" /><testcase classname="tests.unit.test_scoring_utils.TestGradeTierCalculation" name="test_average_tier" time="0.000" /><testcase classname="tests.unit.test_scoring_utils.TestGradeTierCalculation" name="test_at_risk_tier" time="0.000" /><testcase classname="tests.unit.test_scoring_utils.TestScoreConversion" name="test_convert_10_to_100" time="0.000" /><testcase classname="tests.unit.test_scoring_utils.TestScoreConversion" name="test_convert_10_to_100_clamping" time="0.000" /><testcase classname="tests.unit.test_scoring_utils.TestScoreConversion" name="test_convert_100_to_10" time="0.000" /><testcase classname="tests.unit.test_scoring_utils.TestScoreConversion" name="test_convert_100_to_10_clamping" time="0.000" /><testcase classname="tests.unit.test_scoring_utils.TestScoreConversion" name="test_conversion_roundtrip" time="0.000" /><testcase classname="tests.unit.test_scoring_utils.TestSubDimensionScore" name="test_create_sub_dimension_score_valid" time="0.001" /><testcase classname="tests.unit.test_scoring_utils.TestSubDimensionScore" name="test_create_sub_dimension_score_clamping" time="0.000" /><testcase classname="tests.unit.test_scoring_utils.TestSubDimensionScore" name="test_create_sub_dimension_score_defaults" time="0.000" /><testcase classname="tests.unit.test_scoring_utils.TestCategoryScoreCalculation" name="test_calculate_category_score" time="0.000" /><testcase classname="tests.unit.test_scoring_utils.TestCategoryScoreCalculation" name="test_calculate_category_score_max_limit" time="0.000" /><testcase classname="tests.unit.test_scoring_utils.TestCategoryScoreCalculation" name="test_calculate_category_score_min_limit" time="0.000" /><testcase classname="tests.unit.test_scoring_utils.TestTotalScoreCalculation" name="test_calculate_total_score" time="0.000" /><testcase classname="tests.unit.test_scoring_utils.TestParseEnhancedRubric" name="test_parse_enhanced_rubric_success" time="0.000" /><testcase classname="tests.unit.test_scoring_utils.TestParseEnhancedRubric" name="test_parse_enhanced_rubric_not_found" time="0.000" /><testcase classname="tests.unit.test_scoring_utils.TestParseEnhancedRubric" name="test_parse_enhanced_rubric_invalid_data" time="0.001" /><testcase classname="tests.unit.test_scoring_utils.TestCreateRubricFromLegacyScores" name="test_create_rubric_from_legacy_scores" time="0.000" /><testcase classname="tests.unit.test_scoring_utils.TestCreateRubricFromLegacyScores" name="test_create_rubric_from_legacy_scores_zero" time="0.000" /><testcase classname="tests.unit.test_scoring_utils.TestCreateRubricFromLegacyScores" name="test_create_rubric_from_legacy_scores_high" time="0.000" /><testcase classname="tests.unit.test_scoring_utils.TestCreateRubricFromLegacyScores" name="test_create_rubric_category_scores" time="0.001" /><testcase classname="tests.unit.test_scoring_utils.TestParseSubDimension" name="test_parse_sub_dimension" time="0.001" /><testcase classname="tests.unit.test_scoring_utils.TestParseSubDimension" name="test_parse_sub_dimension_missing" time="0.001" /><testcase classname="tests.unit.test_scoring_utils.TestParseSubDimension" name="test_parse_sub_dimension_partial" time="0.000" /><testcase classname="tests.unit.test_speech_analyzer.TestSpeechAnalyzer" name="test_analyze_transcript_empty" time="0.000" /><testcase classname="tests.unit.test_speech_analyzer.TestSpeechAnalyzer" name="test_analyze_transcript_basic" time="0.000" /><testcase classname="tests.unit.test_speech_analyzer.TestSpeechAnalyzer" name="test_analyze_transcript_with_filler_words" time="0.001" /><testcase classname="tests.unit.test_speech_analyzer.TestSpeechAnalyzer" name="test_analyze_transcript_pace_calculation" time="0.000" /><testcase classname="tests.unit.test_speech_analyzer.TestSpeechAnalyzer" name="test_analyze_transcript_pauses" time="0.001" /><testcase classname="tests.unit.test_speech_analyzer.TestSpeechAnalyzer" name="test_analyze_audio_chunk_with_transcript" time="0.000" /><testcase classname="tests.unit.test_speech_analyzer.TestSpeechAnalyzer" name="test_analyze_audio_chunk_without_transcript" time="0.001" /><testcase classname="tests.unit.test_speech_analyzer.TestSpeechAnalyzer" name="test_get_realtime_suggestions_slow_pace" time="0.001" /><testcase classname="tests.unit.test_speech_analyzer.TestSpeechAnalyzer" name="test_get_realtime_suggestions_fast_pace" time="0.001" /><testcase classname="tests.unit.test_speech_analyzer.TestSpeechAnalyzer" name="test_get_realtime_suggestions_filler_words" time="0.001" /><testcase classname="tests.unit.test_speech_analyzer.TestSpeechAnalyzer" name="test_get_realtime_suggestions_low_clarity" time="0.001" /><testcase classname="tests.unit.test_speech_analyzer.TestSpeechAnalyzer" name="test_get_realtime_suggestions_optimal" time="0.000" /><testcase classname="tests.unit.test_speech_analyzer.TestSpeechAnalyzer" name="test_reset" time="0.001" /><testcase classname="tests.unit.test_tts_configuration.TestTTSConfigurationSettings" name="test_default_tts_settings" time="0.000" /><testcase classname="tests.unit.test_tts_configuration.TestTTSConfigurationSettings" name="test_tts_settings_from_env" time="0.015" /><testcase classname="tests.unit.test_tts_configuration.TestTTSConfigurationValidation" name="test_valid_coqui_configuration" time="0.016" /><testcase classname="tests.unit.test_tts_configuration.TestTTSConfigurationValidation" name="test_invalid_tts_provider" time="0.016" /><testcase classname="tests.unit.test_tts_configuration.TestTTSConfigurationValidation" name="test_elevenlabs_missing_api_key" time="0.014" /><testcase classname="tests.unit.test_tts_configuration.TestTTSConfigurationValidation" name="test_elevenlabs_with_api_key" time="0.014" /><testcase classname="tests.unit.test_tts_configuration.TestTTSConfigurationValidation" name="test_playht_missing_credentials" time="0.014" /><testcase classname="tests.unit.test_tts_configuration.TestTTSConfigurationValidation" name="test_playht_with_credentials" time="0.014" /><testcase classname="tests.unit.test_tts_configuration.TestTTSConfigurationValidation" name="test_invalid_tts_format" time="0.016" /><testcase classname="tests.unit.test_tts_configuration.TestTTSConfigurationValidation" name="test_invalid_tts_voice_version" time="0.018" /><testcase classname="tests.unit.test_tts_configuration.TestTTSConfigurationValidation" name="test_invalid_tts_timeout" time="0.016" /><testcase classname="tests.unit.test_tts_configuration.TestTTSConfigurationValidation" name="test_invalid_tts_cache_ttl" time="0.014" /><testcase classname="tests.unit.test_tts_configuration.TestTTSConfigurationValidation" name="test_high_cache_ttl_warning" time="0.016" /><testcase classname="tests.unit.test_tts_configuration.TestTTSConfigurationValidation" name="test_unused_vendor_key_warning" time="0.015" /><testcase classname="tests.unit.test_tts_configuration.TestTTSConfigurationValidation" name="test_same_fallback_provider_warning" time="0.015" /><testcase classname="tests.unit.test_tts_configuration.TestTTSConfigurationValidation" name="test_short_api_key_warning" time="0.017" /><testcase classname="tests.unit.test_tts_configuration.TestTTSStartupValidation" name="test_startup_validation_with_valid_config" time="0.018" /><testcase classname="tests.unit.test_tts_configuration.TestTTSStartupValidation" name="test_startup_validation_with_invalid_config" time="0.019" /><testcase classname="tests.unit.test_tts_providers.TestCoquiTTSProvider" name="test_synthesize_success" time="0.005" /><testcase classname="tests.unit.test_tts_providers.TestCoquiTTSProvider" name="test_synthesize_timeout" time="0.004" /><testcase classname="tests.unit.test_tts_providers.TestCoquiTTSProvider" name="test_synthesize_invalid_text" time="0.003" /><testcase classname="tests.unit.test_tts_providers.TestCoquiTTSProvider" name="test_synthesize_invalid_format" time="0.001" /><testcase classname="tests.unit.test_tts_providers.TestCoquiTTSProvider" name="test_health_check_success" time="0.005" /><testcase classname="tests.unit.test_tts_providers.TestCoquiTTSProvider" name="test_health_check_failure" time="0.004" /><testcase classname="tests.unit.test_tts_providers.TestElevenLabsTTSProvider" name="test_synthesize_success" time="0.004" /><testcase classname="tests.unit.test_tts_providers.TestElevenLabsTTSProvider" name="test_synthesize_rate_limit" time="0.004" /><testcase classname="tests.unit.test_tts_providers.TestElevenLabsTTSProvider" name="test_synthesize_invalid_api_key" time="0.005" /><testcase classname="tests.unit.test_tts_providers.TestElevenLabsTTSProvider" name="test_missing_api_key" time="0.001" /><testcase classname="tests.unit.test_tts_providers.TestElevenLabsTTSProvider" name="test_health_check_success" time="0.004" /><testcase classname="tests.unit.test_tts_providers.TestPlayHTTTSProvider" name="test_synthesize_success" time="0.004" /><testcase classname="tests.unit.test_tts_providers.TestPlayHTTTSProvider" name="test_missing_api_key" time="0.001" /><testcase classname="tests.unit.test_tts_providers.TestPlayHTTTSProvider" name="test_missing_user_id" time="0.001" /><testcase classname="tests.unit.test_tts_providers.TestTTSProviderFactory" name="test_create_coqui_provider" time="0.001" /><testcase classname="tests.unit.test_tts_providers.TestTTSProviderFactory" name="test_create_elevenlabs_provider" time="0.001" /><testcase classname="tests.unit.test_tts_providers.TestTTSProviderFactory" name="test_create_elevenlabs_provider_missing_key" time="0.001" /><testcase classname="tests.unit.test_tts_providers.TestTTSProviderFactory" name="test_create_invalid_provider" time="0.001" /><testcase classname="tests.unit.test_tts_providers.TestTTSServiceRetryLogic" name="test_retry_succeeds_on_second_attempt" time="0.005" /><testcase classname="tests.unit.test_tts_providers.TestTTSServiceRetryLogic" name="test_retry_exhausts_all_attempts" time="0.008" /><testcase classname="tests.unit.test_tts_providers.TestTTSServiceRetryLogic" name="test_retry_skips_rate_limit_error" time="0.005"><failure message="app.services.tts.base.TTSProviderError: All TTS providers failed. Primary: elevenlabs, Fallback: none. Last error: Rate limit exceeded">self = &lt;tests.unit.test_tts_providers.TestTTSServiceRetryLogic object at 0xffff7229b710&gt;, mock_tts_settings = &lt;MagicMock name='get_settings()' id='281472562524432'&gt;

    @pytest.mark.unit
    @pytest.mark.asyncio
    async def test_retry_skips_rate_limit_error(self, mock_tts_settings):
        """Test retry logic doesn't retry on rate limit errors."""
        mock_tts_settings.TTS_PROVIDER = "elevenlabs"
        mock_tts_settings.ELEVENLABS_API_KEY = "valid-key-12345678901234567890"  # Required for provider init
    
        mock_provider = AsyncMock()
        mock_provider.synthesize = AsyncMock(
            side_effect=TTSProviderRateLimitError("Rate limit exceeded")
        )
    
        service = TTSService()
        service.primary_provider = mock_provider
        service.primary_provider_name = "elevenlabs"
        service.circuit_breakers["elevenlabs"] = CircuitBreaker()
    
        with pytest.raises(TTSProviderRateLimitError):
&gt;           await service.synthesize("Hello world", use_cache=False)

tests/unit/test_tts_providers.py:395: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/services/tts/service.py:399: in synthesize
    result = await _synthesize_internal()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    async def _synthesize_internal() -&gt; Dict:
        """Internal synthesis function for singleflight pattern."""
        # Try providers in order: primary -&gt; fallback
        providers = [
            (self.primary_provider, self.primary_provider_name, "Primary"),
            (self.fallback_provider, self.fallback_provider_name, "Fallback")
        ]
    
        last_error = None
        for provider, provider_name, provider_type in providers:
            if not provider:
                continue
    
            try:
                if provider_type == "Fallback":
                    logger.info(f"Trying fallback provider: {provider_name}")
    
                # Use _synthesize_with_provider which includes retry logic and circuit breaker
                audio_data = await self._synthesize_with_provider(
                    provider, provider_name, text, voice, audio_format, use_cache, **kwargs
                )
    
                # Return in format expected by voice cache
                return {
                    "audio_data": base64.b64encode(audio_data).decode('utf-8'),
                    "provider": provider_name
                }
            except Exception as e:
                logger.warning(f"{provider_type} provider failed: {e}")
                last_error = e
    
        # All providers failed - raise consistent error message
&gt;       raise TTSProviderError(
            f"All TTS providers failed. Primary: {self.primary_provider_name}, "
            f"Fallback: {self.fallback_provider_name or 'none'}"
            + (f". Last error: {last_error}" if last_error else "")
        )
E       app.services.tts.base.TTSProviderError: All TTS providers failed. Primary: elevenlabs, Fallback: none. Last error: Rate limit exceeded

app/services/tts/service.py:381: TTSProviderError</failure></testcase><testcase classname="tests.unit.test_tts_providers.TestTTSServiceRetryLogic" name="test_retry_exponential_backoff_delays" time="0.006" /><testcase classname="tests.unit.test_tts_providers.TestCircuitBreaker" name="test_circuit_breaker_closed_state" time="0.000" /><testcase classname="tests.unit.test_tts_providers.TestCircuitBreaker" name="test_circuit_breaker_opens_after_threshold" time="0.001" /><testcase classname="tests.unit.test_tts_providers.TestCircuitBreaker" name="test_circuit_breaker_resets_on_success" time="0.000" /><testcase classname="tests.unit.test_tts_providers.TestCircuitBreaker" name="test_circuit_breaker_half_open_state" time="0.001" /><testcase classname="tests.unit.test_voice_cache.TestVoiceCacheService" name="test_settings_hash_generation" time="0.001" /><testcase classname="tests.unit.test_voice_cache.TestVoiceCacheService" name="test_cache_key_generation" time="0.001" /><testcase classname="tests.unit.test_voice_cache.TestVoiceCacheService" name="test_get_cached_voice_miss" time="0.002" /><testcase classname="tests.unit.test_voice_cache.TestVoiceCacheService" name="test_cache_voice_and_get" time="0.001" /><testcase classname="tests.unit.test_voice_cache.TestVoiceCacheService" name="test_cache_with_audio_data" time="0.001" /><testcase classname="tests.unit.test_voice_cache.TestVoiceCacheService" name="test_singleflight_pattern" time="0.103" /><testcase classname="tests.unit.test_voice_cache.TestVoiceCacheService" name="test_singleflight_error_propagation" time="0.004" /><testcase classname="tests.unit.test_voice_cache.TestVoiceCacheService" name="test_cache_statistics" time="0.001" /><testcase classname="tests.unit.test_voice_cache.TestVoiceCacheService" name="test_reset_stats" time="0.002" /><testcase classname="tests.unit.test_voice_cache.TestVoiceCacheService" name="test_cache_disabled" time="0.002" /><testcase classname="tests.unit.test_voice_cache.TestVoiceCacheService" name="test_cache_key_with_hash_helper" time="0.002" /><testcase classname="tests.unit.test_voice_cache.TestVoiceCacheServiceGlobal" name="test_get_voice_cache_service_singleton" time="0.025" /></testsuite></testsuites>